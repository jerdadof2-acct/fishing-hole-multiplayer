<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- SEO Meta Tags -->
    <title>Kitty Creek Fishing Club - Purrfect Cat Fishing Tournaments & Mayhem! üê±üé£</title>
    <meta name="description" content="Kitty Creek Fishing Club - Where cats become legendary anglers! üê±üé£ Join real-time fishing tournaments, compete with hilarious bot cats like 'Sly Sylvester' and 'Whiskers McFluff', catch rare fish, unlock epic gear, and prove you're the purrfect fisher-cat. Free multiplayer mayhem that'll have you hooked!">
    <meta name="keywords" content="Kitty Creek Fishing Club, cat fishing game, multiplayer fishing, online fishing tournament, kitty creek, cat fishing, free fishing game, competitive fishing, cat game, fishing tournaments, legendary fish, purrfect fishing, fisher cats, fishing mayhem">
    <meta name="author" content="Kitty Creek Fishing Club">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph Meta Tags for Social Media -->
    <meta property="og:title" content="Kitty Creek Fishing Club - Purrfect Cat Fishing Tournaments & Mayhem! üê±üé£">
    <meta property="og:description" content="Kitty Creek Fishing Club - The most pawsome fishing tournament game ever! üê±üé£ Battle against legendary fisher-cats like Tommy the Stray and Captain Claw in real-time competitions. Catch legendary fish, unlock purrfect gear, and become the champion of the creek. It's fishing chaos with cats - what's not to love?">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://fishing-hole-multiplayer-production.up.railway.app/">
    <meta property="og:image" content="https://fishing-hole-multiplayer-production.up.railway.app/fishing-game.jpg">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Kitty Creek Fishing Club - Purrfect Cat Fishing Tournaments & Mayhem! üê±üé£">
    <meta name="twitter:description" content="Kitty Creek Fishing Club - Where cats dominate the fishing world! üê±üé£ Real-time tournaments, hilarious bot competitors, legendary catches, and purrfect gear. It's fishing mayhem with cats and it's absolutely pawsome!">
    
    <!-- Additional SEO -->
    <link rel="canonical" href="https://fishing-hole-multiplayer-production.up.railway.app/">
    <meta name="theme-color" content="#2196f3">
    
    <!-- Favicon and PWA -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%2342a5f5;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%232196f3;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Ccircle cx='50' cy='50' r='48' fill='url(%23grad)'/%3E%3Cpath d='M30 25 L45 45 L40 50 L25 30 Z' fill='white' stroke='%230a1628' stroke-width='2'/%3E%3Ccircle cx='45' cy='50' r='12' fill='none' stroke='white' stroke-width='3'/%3E%3Cline x1='45' y1='62' x2='45' y2='75' stroke='white' stroke-width='3' stroke-linecap='round'/%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%2342a5f5;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%232196f3;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Ccircle cx='50' cy='50' r='48' fill='url(%23grad)'/%3E%3Cpath d='M30 25 L45 45 L40 50 L25 30 Z' fill='white' stroke='%230a1628' stroke-width='2'/%3E%3Ccircle cx='45' cy='50' r='12' fill='none' stroke='white' stroke-width='3'/%3E%3Cline x1='45' y1='62' x2='45' y2='75' stroke='white' stroke-width='3' stroke-linecap='round'/%3E%3C/svg%3E">
    <link rel="manifest" href="/manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Kitty Creek">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e0e0e0;
            height: 100vh;
            overflow: hidden;
        }

        .game-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .main-area {
            display: flex;
            flex-direction: column;
            background: rgba(15, 25, 40, 0.95);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 200, 255, 0.2);
        }

        .game-layout {
            display: flex;
            flex: 1;
            gap: 10px;
        }

        .left-sidebar, .right-sidebar {
            width: 250px;
            background: rgba(20, 30, 50, 0.8);
            border-radius: 12px;
            border: 1px solid rgba(100, 200, 255, 0.15);
            padding: 15px;
            overflow-y: auto;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .center-area {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .chat-section {
            background: rgba(20, 30, 50, 0.8);
            border-top: 1px solid rgba(100, 200, 255, 0.2);
            border-radius: 0 0 12px 12px;
            padding: 15px;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.2);
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            padding: 15px;
            text-align: center;
            border-bottom: 2px solid rgba(100, 200, 255, 0.3);
            border-radius: 12px 12px 0 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            color: #ffffff;
            font-size: 1.8rem;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
            font-weight: 700;
            letter-spacing: 1px;
        }

        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .login-box {
            background: linear-gradient(135deg, rgba(30, 60, 114, 0.95) 0%, rgba(42, 82, 152, 0.95) 100%);
            border: 2px solid rgba(100, 200, 255, 0.4);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5), 0 0 30px rgba(100, 200, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .login-box h2 {
            color: #ffffff;
            margin-bottom: 25px;
            font-weight: 700;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
        }

        .login-input {
            background: rgba(15, 25, 40, 0.9);
            border: 2px solid rgba(100, 200, 255, 0.3);
            border-radius: 10px;
            color: #e0e0e0;
            padding: 12px 15px;
            margin: 10px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 16px;
            transition: all 0.3s ease;
            width: 90%;
            max-width: 300px;
        }

        .login-input:focus {
            outline: none;
            border-color: rgba(100, 200, 255, 0.6);
            box-shadow: 0 0 15px rgba(100, 200, 255, 0.3);
        }

        .login-input::placeholder {
            color: rgba(200, 200, 200, 0.5);
        }

        .login-btn {
            background: linear-gradient(135deg, #64b5f6 0%, #42a5f5 100%);
            border: none;
            border-radius: 12px;
            color: #ffffff;
            padding: 14px 30px;
            margin: 15px 10px;
            cursor: pointer;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 16px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(100, 181, 246, 0.4);
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(100, 181, 246, 0.6);
            background: linear-gradient(135deg, #90caf9 0%, #64b5f6 100%);
        }

        .login-btn:active {
            transform: translateY(0);
        }

        .character-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 10px 0;
        }

        .character-option {
            font-size: 40px;
            padding: 12px;
            border: 2px solid rgba(100, 200, 255, 0.3);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(15, 25, 40, 0.8);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .character-option:hover {
            border-color: rgba(100, 200, 255, 0.6);
            background: rgba(30, 50, 80, 0.9);
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(100, 200, 255, 0.4);
        }

        .character-option.selected {
            border-color: rgba(100, 200, 255, 0.8);
            background: rgba(42, 82, 152, 0.6);
            box-shadow: 0 0 20px rgba(100, 200, 255, 0.6);
        }

        .character-selector-small {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            justify-content: center;
            margin: 5px 0;
        }

        .char-part-option {
            font-size: 24px;
            padding: 5px 8px;
            border: 2px solid rgba(100, 200, 255, 0.3);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: rgba(15, 25, 40, 0.9);
            font-size: 18px;
        }

        .char-part-option:hover {
            border-color: rgba(100, 200, 255, 0.5);
            background: rgba(20, 30, 50, 0.8);
            transform: scale(1.1);
        }

        .char-part-option.selected {
            border-color: rgba(100, 200, 255, 0.5);
            background: rgba(42, 82, 152, 0.6);
            box-shadow: 0 0 15px rgba(100, 200, 255, 0.4);
        }

        .char-option-btn {
            padding: 6px 12px;
            border: 2px solid rgba(100, 200, 255, 0.3);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: rgba(15, 25, 40, 0.9);
            color: #64b5f6;
            font-size: 11px;
            font-weight: bold;
        }

        .char-option-btn:hover {
            border-color: rgba(100, 200, 255, 0.5);
            background: rgba(20, 30, 50, 0.8);
            transform: scale(1.05);
        }

        .char-option-btn[data-selected="true"] {
            border-color: rgba(100, 200, 255, 0.5);
            background: rgba(42, 82, 152, 0.6);
            box-shadow: 0 0 12px rgba(100, 200, 255, 0.4);
        }

        .fishing-area {
            flex: 1;
            position: relative;
            background: linear-gradient(135deg, #0a1a2e 0%, #16213e 30%, #0f3460 70%, #1a1a2e 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
            min-height: 0;
            box-shadow: inset 0 0 100px rgba(0, 0, 0, 0.5);
        }

        .fisherman-row {
            display: flex;
            justify-content: space-around;
            width: 100%;
            max-width: 100%;
            margin-bottom: 0;
            padding: 0 20px;
            flex-shrink: 0;
            align-items: flex-end;
        }

        .fishing-lake {
            width: calc(100% - 40px);
            max-width: calc(100vw - 600px);
            height: calc(100vh - 300px);
            min-height: 400px;
            max-height: 600px;
            background: 
                /* Deep beautiful water - vibrant blues */
                radial-gradient(ellipse at center, #1e88e5 0%, #1565c0 30%, #0d47a1 60%, #01579b 100%),
                /* Surface sparkle and light */
                linear-gradient(
                    180deg,
                    rgba(144, 202, 249, 0.4) 0%,
                    rgba(100, 181, 246, 0.3) 8%,
                    rgba(66, 165, 245, 0.2) 15%,
                    rgba(33, 150, 243, 0.15) 25%,
                    transparent 50%
                ),
                /* Animated wave pattern */
                repeating-linear-gradient(
                    0deg,
                    rgba(144, 202, 249, 0.25) 0px,
                    rgba(144, 202, 249, 0.25) 8px,
                    rgba(66, 165, 245, 0.2) 8px,
                    rgba(66, 165, 245, 0.2) 16px
                ),
                /* Depth highlights and light rays */
                radial-gradient(ellipse at 25% 35%, rgba(100, 181, 246, 0.3) 0%, transparent 40%),
                radial-gradient(ellipse at 75% 65%, rgba(66, 165, 245, 0.25) 0%, transparent 45%),
                radial-gradient(ellipse at 50% 80%, rgba(33, 150, 243, 0.2) 0%, transparent 50%);
            border: 3px solid rgba(100, 181, 246, 0.6);
            border-radius: 20px;
            position: relative;
            overflow: visible;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.4),
                0 0 60px rgba(33, 150, 243, 0.5),
                inset 0 0 100px rgba(0, 100, 200, 0.7),
                inset 0 15px 150px rgba(100, 181, 246, 0.5),
                0 0 40px rgba(66, 165, 245, 0.4);
            animation: waterShimmer 4s ease-in-out infinite;
        }

        @keyframes waterShimmer {
            0%, 100% {
                background-position: 0% 0%, 0 0;
            }
            50% {
                background-position: 0% 0%, 0 20px;
            }
        }

        .fisherman {
            width: 60px;
            height: 80px;
            border-radius: 50%;
            border: 2px solid rgba(100, 200, 255, 0.4);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            font-weight: bold;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 50%, #2c3e50 100%);
            color: #64b5f6;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 
                0 4px 20px rgba(33, 150, 243, 0.5),
                0 0 30px rgba(100, 181, 246, 0.4),
                inset 0 0 15px rgba(0, 0, 0, 0.4);
            overflow: visible;
        }
        
        .fisherman-character {
            font-size: 48px;
            line-height: 1;
            margin-bottom: 5px;
        }

        .fisherman-initial {
            display: none; /* Hide initials to show character instead */
        }

        .fisherman-name {
            font-size: 9px;
            margin-top: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 50px;
            position: relative;
            z-index: 10;
            background: rgba(0, 0, 0, 0.95);
            padding: 2px 4px;
            border-radius: 3px;
            border: 1px solid rgba(100, 200, 255, 0.3);
            color: #64b5f6;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(100, 181, 246, 0.8);
            box-shadow: 0 0 8px rgba(100, 181, 246, 0.5);
        }

        .fisherman.you {
            background: linear-gradient(135deg, #64b5f6 0%, #42a5f5 50%, #2196f3 100%);
            color: #000;
            border-color: rgba(100, 200, 255, 0.5);
            box-shadow: 
                0 0 20px rgba(100, 181, 246, 0.6),
                inset 0 0 10px rgba(0, 0, 0, 0.3);
        }

        .fisherman.other {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 50%, #2c3e50 100%);
            color: #64b5f6;
            border-color: rgba(100, 200, 255, 0.5);
        }

        .fisherman.fishing {
            animation: fishingBob 2s ease-in-out infinite;
        }

        @keyframes fishingBob {
            0%, 100% { 
                transform: scale(1) translateY(0px);
            }
            25% { 
                transform: scale(1.05) translateY(-2px);
            }
            50% { 
                transform: scale(1.1) translateY(-3px);
            }
            75% { 
                transform: scale(1.05) translateY(-2px);
            }
        }

        .fishing-line {
            position: absolute;
            width: 2px;
            background: #ffffff;
            z-index: 5;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
        }

        .fishing-line.casting {
            animation: lineCast 2s ease-in-out infinite;
        }

        @keyframes lineCast {
            0% { 
                transform: rotate(-3deg);
                transform-origin: top center;
            }
            50% { 
                transform: rotate(3deg);
                transform-origin: top center;
            }
            100% { 
                transform: rotate(-3deg);
                transform-origin: top center;
            }
        }
        
        @keyframes reelIn {
            0% {
                height: var(--original-height);
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
            100% {
                height: 0px;
                opacity: 0;
            }
        }
        
        @keyframes fishCaught {
            0% {
                transform: scale(0.5) rotate(-10deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.2) rotate(5deg);
                opacity: 1;
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        .hook {
            position: absolute;
            bottom: -12px;
            left: 50%;
            width: 16px;
            height: 20px;
            transform: translateX(-50%);
            /* Classic red and white striped bobber */
            background: 
                repeating-linear-gradient(
                    to bottom,
                    #ff0000 0px,
                    #ff0000 5px,
                    #ffffff 5px,
                    #ffffff 10px,
                    #ff0000 10px,
                    #ff0000 15px,
                    #ffffff 15px,
                    #ffffff 20px
                );
            border-radius: 50% 50% 50% 50% / 70% 70% 50% 50%;
            border: 1px solid #cc0000;
            box-shadow: 
                0 0 3px rgba(255, 255, 255, 0.3),
                inset 0 -5px 5px rgba(0, 0, 0, 0.2);
            position: relative;
        }
        
        .hook::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 6px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.3) 70%);
            border-radius: 50%;
        }

        .fishing-line {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 2px;
            height: 0;
            background: #ffffff;
            transform: translateX(-50%);
            transition: height 0.5s ease;
            z-index: 5;
        }

        .fishing-line.casting {
            height: 100px;
            animation: lineBob 2s ease-in-out infinite;
        }

        @keyframes lineBob {
            0%, 100% { transform: translateX(-50%) rotate(-1deg); }
            50% { transform: translateX(-50%) rotate(1deg); }
        }

        .hook {
            position: absolute;
            bottom: -12px;
            left: 50%;
            width: 14px;
            height: 18px;
            transform: translateX(-50%);
            /* Classic red and white striped bobber */
            background: 
                repeating-linear-gradient(
                    to bottom,
                    #ff0000 0px,
                    #ff0000 4px,
                    #ffffff 4px,
                    #ffffff 8px,
                    #ff0000 8px,
                    #ff0000 12px,
                    #ffffff 12px,
                    #ffffff 18px
                );
            border-radius: 50% 50% 50% 50% / 70% 70% 50% 50%;
            border: 1px solid #cc0000;
            box-shadow: 
                0 0 3px rgba(255, 255, 255, 0.3),
                inset 0 -5px 5px rgba(0, 0, 0, 0.2);
        }
        
        .hook::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 7px;
            height: 5px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.3) 70%);
            border-radius: 50%;
        }

        .hook-splash {
            position: absolute;
            width: 30px;
            height: 30px;
            pointer-events: none;
            transform: translateX(-50%);
            z-index: 5;
        }

        .hook-splash::before,
        .hook-splash::after {
            content: '';
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(135, 206, 250, 0.6) 0%, rgba(135, 206, 250, 0) 70%);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: splashRipple 1.2s infinite ease-out;
        }

        .hook-splash::before {
            width: 15px;
            height: 15px;
            animation-delay: 0s;
        }

        .hook-splash::after {
            width: 25px;
            height: 25px;
            animation-delay: 0.2s;
        }

        .hook-landing-splash {
            position: absolute;
            width: 60px;
            height: 60px;
            pointer-events: none;
            transform: translate(-50%, -50%);
            z-index: 6;
        }

        .hook-landing-splash::before,
        .hook-landing-splash::after {
            content: '';
            position: absolute;
            border-radius: 50%;
            border: 3px solid rgba(200, 230, 255, 0.7);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: landingSplash 1.2s ease-out forwards;
            box-shadow: 0 0 20px rgba(200, 230, 255, 0.5);
        }

        .hook-landing-splash::before {
            width: 30px;
            height: 30px;
            animation-delay: 0s;
        }

        .hook-landing-splash::after {
            width: 50px;
            height: 50px;
            animation-delay: 0.15s;
        }

        .hook-landing-splash .splash-wave {
            position: absolute;
            border-radius: 50%;
            border: 2px solid rgba(200, 230, 255, 0.7);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: landingSplash 1.2s ease-out forwards;
            box-shadow: 0 0 20px rgba(200, 230, 255, 0.5);
            width: 70px;
            height: 70px;
            animation-delay: 0.3s;
        }

        @keyframes landingSplash {
            0% {
                width: 10px;
                height: 10px;
                opacity: 1;
                border-width: 3px;
            }
            50% {
                opacity: 0.7;
                border-width: 2px;
            }
            100% {
                width: 80px;
                height: 80px;
                opacity: 0;
                border-width: 0px;
            }
        }

        @keyframes splashRipple {
            0% {
                width: 8px;
                height: 8px;
                opacity: 0.8;
            }
            30% {
                opacity: 0.6;
            }
            100% {
                width: 35px;
                height: 35px;
                opacity: 0;
            }
        }

        .ripples {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }

        .ripple {
            position: absolute;
            border: 2px solid rgba(135, 206, 250, 0.4);
            border-radius: 50%;
            animation: ripple 4s ease-in-out infinite;
            box-shadow: 0 0 10px rgba(135, 206, 250, 0.3);
        }

        .mouse-ripple {
            position: absolute;
            border: 3px solid rgba(200, 230, 255, 0.6);
            border-radius: 50%;
            pointer-events: none;
            animation: mouseRipple 1.5s ease-out forwards;
            box-shadow: 0 0 15px rgba(200, 230, 255, 0.5);
        }

        @keyframes ripple {
            0% {
                transform: scale(0);
                opacity: 0.8;
                border-width: 2px;
            }
            50% {
                opacity: 0.4;
                border-width: 1px;
            }
            100% {
                transform: scale(2.5);
                opacity: 0;
                border-width: 0px;
            }
        }

        @keyframes mouseRipple {
            0% {
                transform: scale(0);
                opacity: 0.8;
                border-width: 3px;
            }
            50% {
                opacity: 0.5;
                border-width: 2px;
            }
            100% {
                transform: scale(3);
                opacity: 0;
                border-width: 0px;
            }
        }

        .chat-banner {
            position: fixed;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(15, 25, 40, 0.95);
            border: 2px solid rgba(100, 200, 255, 0.5);
            border-radius: 8px;
            padding: 8px 16px;
            color: #64b5f6;
            font-size: 13px;
            font-weight: 600;
            z-index: 999;
            max-width: 90%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .chat-banner.show {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .chat-banner {
                bottom: 140px; /* Above mobile controls */
                font-size: 11px;
                padding: 6px 12px;
                max-width: 95%;
            }
        }

        .controls {
            background: rgba(20, 30, 50, 0.8);
            padding: 15px;
            text-align: center;
            border-top: 2px solid rgba(100, 200, 255, 0.4);
            flex-shrink: 0; /* Prevent controls from shrinking */
            z-index: 10; /* Ensure controls stay visible */
        }

        .btn {
            background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%);
            border: none;
            border-radius: 8px;
            color: #ffffff;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 3px 10px rgba(33, 150, 243, 0.3);
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.5);
            background: linear-gradient(135deg, #64b5f6 0%, #42a5f5 100%);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn.casting {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }


        .section {
            margin-bottom: 20px;
            border: 1px solid rgba(100, 200, 255, 0.2);
            border-radius: 10px;
            padding: 15px;
            background: rgba(15, 25, 40, 0.6);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .section h3 {
            color: #ffffff;
            margin-bottom: 12px;
            text-align: center;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .player-info {
            font-size: 16px;
            background: linear-gradient(135deg, rgba(30, 60, 114, 0.9) 0%, rgba(42, 82, 152, 0.9) 100%);
            padding: 18px;
            border: 2px solid rgba(100, 200, 255, 0.4);
            border-radius: 12px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3), 0 0 20px rgba(100, 200, 255, 0.2);
        }

        .stat-line {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 8px 0;
            border-bottom: 1px solid rgba(100, 200, 255, 0.2);
            font-weight: 600;
            color: #e0e0e0;
        }

        .stat-line:last-child {
            border-bottom: none;
        }

        .stat-line span {
            color: #ffffff;
            font-weight: 700;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 50%;
        }

        .player-stats {
            background: linear-gradient(135deg, rgba(30, 60, 114, 0.9) 0%, rgba(42, 82, 152, 0.9) 100%);
            padding: 18px;
            border: 2px solid rgba(100, 200, 255, 0.4);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            margin-bottom: 15px;
            box-shadow: 0 0 10px rgba(100, 181, 246, 0.3);
        }

        .player-stats .stat-line {
            margin: 6px 0;
            padding: 4px 0;
        }

        .player-stats .stat-line span {
            color: #ffff00;
            font-weight: bold;
        }

        .achievements {
            background: rgba(20, 30, 50, 0.8);
            padding: 10px;
            border: 2px solid rgba(100, 200, 255, 0.4);
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 0 10px rgba(100, 181, 246, 0.3);
            max-height: 200px;
            overflow-y: auto;
        }

        .achievement-item {
            margin: 5px 0;
            padding: 10px;
            background: rgba(30, 60, 114, 0.6);
            border: 1px solid rgba(100, 200, 255, 0.3);
            border-radius: 8px;
            font-size: 12px;
            color: #e0e0e0;
            transition: all 0.3s ease;
        }

        .achievement-item.locked {
            opacity: 0.4;
            color: #888;
            filter: grayscale(50%);
        }

        .leaderboard {
            background: rgba(20, 30, 50, 0.8);
            padding: 15px;
            border: 2px solid rgba(100, 200, 255, 0.3);
            border-radius: 12px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .leaderboard-category {
            margin-bottom: 12px;
        }

        .leaderboard-category:last-child {
            margin-bottom: 0;
        }

        .leaderboard-category h4 {
            color: #ffffff;
            margin: 0 0 10px 0;
            font-size: 14px;
            text-align: center;
            border-bottom: 2px solid rgba(100, 200, 255, 0.3);
            padding-bottom: 8px;
            font-weight: 700;
        }

        .leaderboard-list {
            min-height: 60px;
            /* No max-height - let it size dynamically based on content */
            overflow-y: visible;
        }

        .leaderboard-item {
            margin: 4px 0;
            padding: 8px 12px;
            border-bottom: 1px solid rgba(100, 200, 255, 0.15);
            font-size: 12px;
            background: rgba(15, 25, 40, 0.6);
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
            overflow: hidden;
            min-width: 0;
        }
        
        .leaderboard-item .player-name {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex: 1;
            min-width: 0;
        }
        
        .leaderboard-item .weight {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex-shrink: 0;
            margin-left: 5px;
        }

        .leaderboard-item:hover {
            background: rgba(30, 50, 80, 0.8);
            transform: translateX(3px);
        }

        .leaderboard-item:first-child {
            color: #ffd700;
            font-weight: bold;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 193, 7, 0.2) 100%);
            border: 1px solid rgba(255, 215, 0, 0.4);
        }

        .leaderboard-item:nth-child(2) {
            color: #c0c0c0;
        }

        .leaderboard-item:nth-child(3) {
            color: #cd7f32;
        }

        .leaderboard-item .rank {
            background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%);
            color: #000;
            padding: 1px 4px;
            border-radius: 2px;
            font-weight: bold;
            font-size: 9px;
            margin-right: 6px;
        }

        .leaderboard-item .player-name {
            flex: 1;
            color: #64b5f6;
        }

        .leaderboard-item .weight {
            color: #ffff00;
            font-weight: bold;
        }

        .tournament-info {
            background: rgba(20, 30, 50, 0.8);
            padding: 15px;
            border: 2px solid rgba(100, 200, 255, 0.4);
            border-radius: 8px;
            margin-bottom: 10px;
            margin-top: 10px;
            min-height: 80px;
            box-shadow: 0 0 10px rgba(100, 181, 246, 0.3);
        }

        .inventory-tabs {
            display: flex;
            margin-bottom: 20px;
        }

        .inventory-tabs .tab-btn {
            flex: 1;
            padding: 10px;
            background: rgba(30, 50, 80, 0.8);
            border: 1px solid rgba(100, 200, 255, 0.3);
            color: #64b5f6;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .inventory-tabs .tab-btn:first-child {
            border-radius: 4px 0 0 4px;
        }

        .inventory-tabs .tab-btn:last-child {
            border-radius: 0 4px 4px 0;
        }

        .inventory-tabs .tab-btn.active {
            background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%);
            color: #000;
        }

        .catch-item {
            background: rgba(30, 50, 80, 0.8);
            border: 1px solid rgba(100, 200, 255, 0.3);
            border-radius: 4px;
            padding: 10px;
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .fish-name {
            font-weight: bold;
            color: #64b5f6;
            font-size: 16px;
        }

        .fish-details {
            display: flex;
            gap: 15px;
            font-size: 12px;
        }

        .fish-details span {
            color: #64b5f6;
        }

        .weight {
            color: #ffff00 !important;
        }

        .value {
            color: #64b5f6 !important;
        }

        .location {
            color: #00ffff !important;
        }

        .time {
            color: #888 !important;
        }

        .rank {
            background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%);
            color: #000;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            margin-right: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-item {
            background: rgba(30, 50, 80, 0.8);
            border: 1px solid rgba(100, 200, 255, 0.3);
            border-radius: 4px;
            padding: 15px;
            text-align: center;
        }

        .stat-label {
            color: #64b5f6;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .stat-value {
            color: #64b5f6;
            font-size: 18px;
            font-weight: bold;
        }

        .no-data {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }

        .game-status {
            background: rgba(20, 30, 50, 0.8);
            padding: 15px;
            border: 2px solid rgba(100, 200, 255, 0.4);
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 0 10px rgba(100, 181, 246, 0.3);
        }

        .status-item {
            margin: 6px 0;
            padding: 4px 0;
            border-bottom: 1px solid rgba(100, 181, 246, 0.2);
            font-size: 12px;
        }

        .status-item span {
            color: #64b5f6;
            font-weight: bold;
        }

        .online-players {
            max-height: 150px;
            overflow-y: auto;
        }

        .player-item {
            padding: 2px 5px;
            margin: 2px 0;
            background: rgba(20, 30, 50, 0.8);
            border-left: 3px solid rgba(100, 200, 255, 0.5);
        }

        .player-item.fishing {
            border-left-color: rgba(100, 181, 246, 0.6);
        }

        .chat-area {
            height: 200px;
            overflow-y: auto;
            background: rgba(15, 25, 40, 0.8);
            border: 1px solid rgba(100, 200, 255, 0.3);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .chat-message {
            margin: 6px 0;
            overflow: hidden;
            text-overflow: ellipsis;
            word-wrap: break-word;
            max-width: 100%;
            padding: 8px 10px;
            font-size: 12px;
            border-radius: 8px;
            background: rgba(20, 30, 50, 0.5);
        }

        .chat-message.system {
            color: #ffd700;
            background: rgba(255, 215, 0, 0.1);
        }

        .chat-message.own {
            color: #64b5f6;
            background: rgba(100, 181, 246, 0.15);
        }

        .chat-message.other {
            color: #81c784;
            background: rgba(129, 199, 132, 0.1);
        }

        .chat-message.legendary {
            color: #ff00ff;
            font-weight: bold;
            text-shadow: 0 0 5px #ff00ff;
            animation: legendaryGlow 2s infinite;
        }

        .chat-message.rare {
            color: #64b5f6;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(100, 181, 246, 0.8);
        }

        .chat-message.huge {
            color: #ffff00;
            font-weight: bold;
            text-shadow: 0 0 5px #ffff00;
        }

        @keyframes legendaryGlow {
            0%, 100% { text-shadow: 0 0 5px #ff00ff; }
            50% { text-shadow: 0 0 15px #ff00ff, 0 0 25px #ff00ff; }
        }

        .chat-input {
            width: 100%;
            background: rgba(15, 25, 40, 0.9);
            border: 2px solid rgba(100, 200, 255, 0.3);
            border-radius: 8px;
            color: #e0e0e0;
            padding: 10px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 13px;
            transition: all 0.3s ease;
        }

        .chat-input:focus {
            outline: none;
            border-color: rgba(100, 200, 255, 0.6);
            box-shadow: 0 0 10px rgba(100, 200, 255, 0.3);
        }

        .tournament-info {
            background: rgba(20, 30, 50, 0.8);
            border: 1px solid #ffff00;
            padding: 10px;
            margin-bottom: 10px;
        }

        .tournament-info h4 {
            color: #ffff00;
            text-align: center;
            margin-bottom: 5px;
        }

        .tournament-timer {
            text-align: center;
            font-size: 14px;
            color: #ffff00;
        }

        .leaderboard {
            max-height: 200px;
            overflow-y: auto;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            padding: 2px 5px;
            margin: 1px 0;
            background: rgba(20, 30, 50, 0.8);
        }

        .leaderboard-item.current {
            background: rgba(15, 25, 40, 0.6);
        }

        .catch-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(15, 25, 40, 0.95);
            border: 2px solid rgba(100, 200, 255, 0.4);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            z-index: 10000;
            display: none;
            box-shadow: 0 0 30px rgba(100, 200, 255, 0.6), 0 8px 32px rgba(0, 0, 0, 0.5);
            color: #ffffff;
            font-weight: 700;
            font-size: 18px;
            pointer-events: none;
        }

        .catch-message.show {
            display: block !important;
            animation: flash 0.5s ease-out;
        }

        @keyframes flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .hidden {
            display: none;
        }


        .location-selector {
            position: absolute;
            top: 10px;
            right: 10px;
        }

        .location-btn {
            background: rgba(15, 25, 40, 0.9);
            border: 1px solid rgba(100, 200, 255, 0.3);
            color: #64b5f6;
            padding: 5px 10px;
            margin: 2px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 10px;
        }

        .location-btn:hover {
            background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%);
            color: #000;
        }

        .location-btn.active {
            background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%);
            color: #000;
        }

        .location-btn.locked {
            background: #333;
            color: #666;
            cursor: not-allowed;
        }

        .location-dropdown {
            margin: 15px 0;
            padding: 10px;
            background: rgba(20, 30, 50, 0.8);
            border: 2px solid rgba(100, 200, 255, 0.4);
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(100, 181, 246, 0.3);
        }

        .location-dropdown select {
            width: 100%;
            padding: 12px;
            background: rgba(15, 25, 40, 0.9);
            color: #64b5f6;
            border: 2px solid rgba(100, 200, 255, 0.4);
            border-radius: 4px;
            font-size: 16px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            text-align: center;
        }

        .location-dropdown select:hover {
            background: rgba(20, 30, 50, 0.8);
            box-shadow: 0 0 10px rgba(100, 181, 246, 0.5);
        }

        .location-dropdown select option {
            background: rgba(20, 30, 50, 0.8);
            color: #64b5f6;
            padding: 8px;
            font-size: 14px;
        }

        .location-dropdown select option:disabled {
            color: #666;
            background: #222;
            font-style: italic;
        }

        /* Tackle Shop Modal */
        .modal {
            display: none;
            position: fixed !important;
            z-index: 99999 !important; /* Highest priority - always on top */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(30, 60, 114, 0.98) 0%, rgba(42, 82, 152, 0.98) 100%);
            margin: 5% auto;
            padding: 0;
            border: 2px solid rgba(100, 200, 255, 0.4);
            border-radius: 16px;
            width: 80%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.6);
            position: relative;
            z-index: 10002; /* Higher than modal background */
        }

        .modal-header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            padding: 20px;
            border-bottom: 2px solid rgba(100, 200, 255, 0.3);
            border-radius: 16px 16px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            color: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-weight: 700;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            color: #ffffff;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .modal-body {
            padding: 20px;
        }

        .shop-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(100, 200, 255, 0.3);
        }

        .tab-btn {
            background: rgba(20, 30, 50, 0.6);
            color: #e0e0e0;
            border: 2px solid rgba(100, 200, 255, 0.3);
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            padding: 12px 24px;
            cursor: pointer;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 5px;
        }

        .tab-btn:hover {
            background: rgba(30, 50, 80, 0.8);
            color: #ffffff;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%);
            color: #ffffff;
            border-color: rgba(100, 200, 255, 0.6);
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.4);
        }

        .shop-content {
            min-height: 300px;
        }

        .tackle-item {
            background: rgba(20, 30, 50, 0.8);
            border: 2px solid rgba(100, 200, 255, 0.3);
            margin: 12px 0;
            padding: 18px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .tackle-item.equipped {
            border-color: #ffff00;
            background: rgba(30, 50, 80, 0.8);
        }

        .tackle-item.locked {
            border-color: #666;
            background: #333;
            color: #666;
        }

        .tackle-info {
            flex: 1;
        }

        .tackle-name {
            font-weight: bold;
            color: #64b5f6;
            margin-bottom: 5px;
        }

        .tackle-item.locked .tackle-name {
            color: #666;
        }

        .tackle-stats {
            font-size: 12px;
            color: #ccc;
            margin-bottom: 5px;
        }

        .tackle-description {
            font-size: 11px;
            color: #999;
            font-style: italic;
        }

        .tackle-actions {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .tackle-btn {
            background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%);
            color: #000;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            font-weight: bold;
        }

        .tackle-btn:hover {
            background: #ffff00;
        }

        .tackle-btn:disabled {
            background: #666;
            color: #999;
            cursor: not-allowed;
        }

        .tackle-btn.equip {
            background: #ffff00;
            color: #000;
        }

        .tackle-btn.buy {
            background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%);
            color: #000;
        }

        /* Banner Ad Containers */
        .ad-container {
            background: rgba(20, 30, 50, 0.6);
            border: 1px dashed rgba(100, 200, 255, 0.3);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            color: rgba(200, 200, 200, 0.5);
            font-size: 12px;
            min-height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px 0;
        }
        
        .ad-container-desktop {
            width: 100%;
            max-width: 728px;
            margin: 10px auto;
        }
        
        .ad-container-mobile {
            width: 100%;
            height: 50px;
            margin: 8px 0;
        }

        /* Help Modal */
        .help-content {
            padding: 20px;
            line-height: 1.6;
            color: #e0e0e0;
        }
        
        .help-content h3 {
            color: #64b5f6;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .help-content h4 {
            color: #90caf9;
            margin-top: 15px;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .help-content ul, .help-content ol {
            margin-left: 20px;
            margin-bottom: 15px;
        }
        
        .help-content li {
            margin: 5px 0;
        }
        
        .help-content code {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #90caf9;
        }
        
        .help-shortcuts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .shortcut-item {
            background: rgba(15, 25, 40, 0.6);
            padding: 10px;
            border-radius: 6px;
            border-left: 3px solid rgba(100, 200, 255, 0.5);
        }
        
        .shortcut-key {
            font-weight: bold;
            color: #90caf9;
            font-family: 'Courier New', monospace;
        }

        /* Responsive Design */
        @media (max-width: 1400px) {
            .fishing-lake {
                max-width: calc(100vw - 550px);
            }
        }

        @media (max-width: 1200px) {
            .left-sidebar, .right-sidebar {
                width: 200px;
            }
            
            .fishing-lake {
                max-width: calc(100vw - 450px);
            }
        }

        @media (max-width: 992px) {
            .game-layout {
                flex-direction: column;
            }
            
            .left-sidebar, .right-sidebar {
                width: 100%;
                max-height: 200px;
            }
            
            .fishing-lake {
                max-width: 100%;
                width: calc(100% - 40px);
            }
        }

        @media (max-height: 800px) {
            .fishing-lake {
                height: calc(100vh - 250px);
                min-height: 300px;
            }
        }

        /* Mobile Layout - Completely Different */
        @media (max-width: 768px) {
            /* Hide desktop layout completely */
            .game-layout {
                display: none !important;
            }

            /* Show mobile layout */
            .mobile-game-layout {
                display: flex !important;
            }

            /* Hide header on mobile since we have mobile header */
            .header {
                display: none;
            }

            /* Hide desktop chat section on mobile */
            .chat-section {
                display: none !important;
            }

            /* Ensure catch message is visible on mobile */
            .catch-message {
                z-index: 10000 !important;
                font-size: 16px;
                padding: 15px;
                max-width: 90%;
                border-radius: 10px;
                display: none !important;
            }
            
            .catch-message.show {
                display: block !important;
            }

            /* Mobile-specific simplified layout */
            .mobile-game-layout {
                display: flex;
                flex-direction: column;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                height: 100vh;
                overflow-y: auto;
                overflow-x: hidden;
                z-index: 1; /* Low z-index so modals appear above */
            }

            .mobile-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 8px;
                background: rgba(20, 30, 50, 0.8);
                border-bottom: 2px solid rgba(100, 200, 255, 0.4);
                flex-shrink: 0;
                position: sticky;
                top: 72px;
                z-index: 99;
            }

            .mobile-header-left {
                display: flex;
                flex-direction: column;
                gap: 4px;
            }

            .mobile-header-name {
                font-size: 14px;
                font-weight: bold;
                word-wrap: break-word;
                max-width: 120px;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .mobile-header-stats {
                font-size: 10px;
                color: #64b5f6;
            }

            .mobile-header-right {
                display: flex;
                flex-direction: column;
                gap: 4px;
                text-align: right;
            }

            .mobile-game-area {
                flex: 1;
                display: flex;
                flex-direction: column;
                overflow-y: auto;
            }

            .mobile-fisherman-row {
                display: flex;
                justify-content: space-around;
                width: 100%;
                margin-bottom: 10px;
            }

            .mobile-fisherman {
                width: 40px;
                height: 50px;
                font-size: 28px;
                border-radius: 50%;
                border: 2px solid rgba(100, 200, 255, 0.4);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                background: linear-gradient(135deg, #2c3e50 0%, #34495e 50%, #2c3e50 100%);
            }

            .mobile-fisherman-character {
                font-size: 30px;
                line-height: 1;
            }

            .mobile-fisherman-name {
                font-size: 6px;
                margin-top: 2px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                max-width: 35px;
                background: rgba(0, 0, 0, 0.95);
                padding: 1px 3px;
                border-radius: 2px;
                border: 1px solid rgba(100, 200, 255, 0.3);
                color: #64b5f6;
                font-weight: bold;
            }

            .mobile-fishing-lake {
                width: 100%;
                height: calc(100vh - 550px); /* Adjust for header (~60px), tabs (~40px), fisherman row (~30px), location dropdown (~70px), controls (~64px), ad (~66px), padding (~20px) */
                min-height: 120px;
                max-height: calc(100vh - 550px);
                background: linear-gradient(135deg, #1e3a5f 0%, #4a90e2 50%, #1e3a5f 100%);
                border-radius: 15px;
                border: 2px solid rgba(100, 200, 255, 0.4);
                position: relative;
                overflow: visible;
                z-index: 1; /* Low z-index so modals appear above */
                box-shadow: 
                    0 0 30px rgba(100, 181, 246, 0.3),
                    inset 0 0 50px rgba(0, 0, 0, 0.2);
            }

            .mobile-fishing-lake .fishing-line {
                position: absolute;
                width: 2px;
                background: #ffffff;
                z-index: 5;
            }

            .mobile-fishing-lake .hook {
                position: absolute;
                bottom: -12px;
                left: 50%;
                width: 16px;
                height: 20px;
                background: repeating-linear-gradient(
                    45deg,
                    #ff0000 0px,
                    #ff0000 3px,
                    #ffffff 3px,
                    #ffffff 6px
                );
                border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
                border: 1px solid #cc0000;
                box-shadow: 
                    0 0 5px rgba(0, 0, 0, 0.3),
                    inset 0 2px 5px rgba(255, 255, 255, 0.3);
                transform: translateX(-50%);
            }

            .mobile-fishing-lake .hook::before {
                content: '';
                position: absolute;
                top: 3px;
                left: 30%;
                width: 40%;
                height: 30%;
                background: rgba(255, 255, 255, 0.6);
                border-radius: 50%;
            }

            .mobile-controls {
                position: fixed;
                bottom: 100px; /* Above the ad bar with more space (50px ad + 16px padding + 34px buffer) */
                left: 0;
                right: 0;
                display: grid;
                grid-template-columns: 1fr 1fr 1fr;
                gap: 4px;
                padding: 8px;
                background: rgba(15, 25, 40, 0.95);
                border-top: 1px solid rgba(100, 200, 255, 0.3);
                z-index: 1000; /* Higher than ad bar (999) to ensure visibility */
                box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.3);
            }
            
            .mobile-sound-toggle {
                transition: all 0.3s ease;
            }
            
            .mobile-sound-toggle:active {
                transform: scale(0.9);
                background: rgba(100, 200, 255, 0.4) !important;
            }

            .mobile-btn {
                padding: 10px 4px;
                background: rgba(20, 30, 50, 0.8);
                border: 2px solid rgba(100, 200, 255, 0.4);
                color: #64b5f6;
                font-size: 10px;
                font-weight: bold;
                cursor: pointer;
                border-radius: 6px;
                transition: all 0.3s ease;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                min-width: 0;
                text-align: center;
            }

            .mobile-btn:active {
                background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%);
                color: #000;
            }

            .mobile-info-panels {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }

            .mobile-panel {
                background: rgba(20, 30, 50, 0.8);
                border: 2px solid rgba(100, 200, 255, 0.4);
                border-radius: 8px;
                padding: 10px;
            }

            .mobile-panel h4 {
                font-size: 12px;
                margin-bottom: 8px;
                color: #64b5f6;
                border-bottom: 1px solid rgba(100, 200, 255, 0.3);
                padding-bottom: 4px;
            }

            .mobile-stats-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 5px;
                font-size: 10px;
            }

            .mobile-chat-section {
                position: fixed;
                bottom: 60px;
                left: 0;
                right: 0;
                background: rgba(0, 0, 0, 0.95);
                border-top: 2px solid rgba(100, 200, 255, 0.4);
                padding: 5px;
                max-height: 100px;
                display: flex;
                flex-direction: column;
            }

            .mobile-chat-input {
                display: flex;
                gap: 5px;
            }

            .mobile-chat-input input {
                flex: 1;
                padding: 6px;
                background: rgba(15, 25, 40, 0.9);
                border: 1px solid rgba(100, 200, 255, 0.3);
                color: #64b5f6;
                font-size: 12px;
            }

            .mobile-menu-bar {
                position: fixed !important;
                bottom: 0 !important;
                left: 0 !important;
                right: 0 !important;
                display: flex;
                background: rgba(15, 25, 40, 0.95);
                border-top: 1px solid rgba(100, 200, 255, 0.3);
                padding: 8px;
                flex-shrink: 0;
                z-index: 999 !important; /* Static ad bar, never changes */
                pointer-events: none; /* Allow clicks to pass through to content below */
            }
            
            .mobile-menu-bar .ad-container {
                pointer-events: auto; /* But allow clicks on the ad itself */
            }

            .mobile-menu-btn {
                flex: 1;
                padding: 10px;
                background: rgba(20, 30, 50, 0.8);
                border: 2px solid rgba(100, 200, 255, 0.4);
                color: #64b5f6;
                font-size: 11px;
                font-weight: bold;
                cursor: pointer;
                border-radius: 5px;
            }

            .mobile-menu-btn:active {
                background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%);
                color: #000;
            }

            /* Mobile Title */
            .mobile-title {
                padding: 8px;
                background: rgba(20, 30, 50, 0.8);
                border-bottom: 2px solid rgba(100, 200, 255, 0.4);
                text-align: center;
                font-size: 14px;
                font-weight: bold;
                color: #64b5f6;
                flex-shrink: 0;
                position: sticky;
                top: 0;
                z-index: 101;
            }

            /* Mobile Tabs */
            .mobile-tabs {
                display: flex;
                background: rgba(20, 30, 50, 0.8);
                border-bottom: 2px solid rgba(100, 200, 255, 0.4);
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                flex-shrink: 0;
                position: sticky;
                top: 32px;
                z-index: 100;
            }

            .mobile-tab-btn {
                flex: 1;
                padding: 8px 4px;
                background: rgba(20, 30, 50, 0.8);
                border: none;
                border-right: 1px solid rgba(100, 200, 255, 0.3);
                color: #64b5f6;
                font-size: 9px;
                font-weight: bold;
                cursor: pointer;
                white-space: nowrap;
            }

            .mobile-tab-btn:last-child {
                border-right: none;
            }

            .mobile-tab-btn.active {
                background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%);
                color: #000;
            }

            .mobile-tab-btn:active {
                background: #00aa00;
            }

            .mobile-tab-content {
                flex: 1;
                overflow-y: auto;
                overflow-x: hidden;
                padding: 10px;
                min-height: 0;
                padding-bottom: 180px; /* Space for location dropdown (~60px) + controls (~64px) + ad (~66px) */
                margin-bottom: 0;
                position: relative;
                z-index: 1; /* Ensure tab content stays below modals */
            }

            .mobile-tab-panel {
                display: none;
            }

            .mobile-tab-panel.active {
                display: block;
            }

            .mobile-fishing-area {
                margin-bottom: 0;
                display: flex;
                flex-direction: column;
                gap: 10px;
            }
            
            .mobile-fishing-area .location-dropdown {
                margin: 0;
                padding: 8px;
                order: 3; /* Location dropdown after lake */
                position: relative;
                z-index: 2; /* Above lake but below controls */
            }

            .mobile-controls {
                grid-template-columns: 1fr 1fr 1fr;
            }

            /* Fix shop tabs on mobile */
            .shop-tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: thin;
            }

            .shop-tabs::-webkit-scrollbar {
                height: 5px;
            }

            .shop-tabs::-webkit-scrollbar-track {
                background: rgba(20, 30, 50, 0.8);
            }

            .shop-tabs::-webkit-scrollbar-thumb {
                background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%);
                border-radius: 5px;
            }

            .tab-btn {
                flex-shrink: 0;
                padding: 8px 10px;
                font-size: 10px;
                white-space: nowrap;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="main-area">
            <div class="header">
                <h1>KITTY CREEK FISHING CLUB</h1>
            </div>

            <div class="game-layout">
                <!-- Left Sidebar -->
                <div class="left-sidebar">
                    <div class="section">
                        <h3>PLAYER INFO</h3>
                        <div class="player-info" id="player-info">
                            <div class="stat-line">Name: <span id="player-name">Guest</span></div>
                            <div class="stat-line">Level: <span id="player-level">1</span></div>
                            <div class="stat-line">Exp: <span id="player-exp">0</span> / <span id="next-level-exp">100</span></div>
                            <div class="stat-line">Money: $<span id="player-money">100</span></div>
                            <div class="stat-line">Fish: <span id="fish-caught">0</span></div>
                            <div class="stat-line">Weight: <span id="total-weight">0</span> lbs</div>
                        </div>
                    </div>

                    <div class="section">
                        <h3>PLAYER STATS</h3>
                        <div class="player-stats" id="player-stats">
                            <div class="stat-line">Accuracy: <span id="stat-accuracy">50</span>/100</div>
                            <div class="stat-line">Luck: <span id="stat-luck">50</span>/100</div>
                            <div class="stat-line">Patience: <span id="stat-patience">50</span>/100</div>
                            <div class="stat-line">Strength: <span id="stat-strength">50</span>/100</div>
                        </div>
                    </div>

                    <div class="section">
                        <h3>ACHIEVEMENTS</h3>
                        <div class="achievements" id="achievements">
                            <div class="achievement-item">üé£ Novice Angler</div>
                            <div class="achievement-item locked">üêü Big Fish Hunter</div>
                            <div class="achievement-item locked">üíé Rare Collector</div>
                        </div>
                    </div>
                </div>

                <!-- Center Game Area -->
                <div class="center-area">
                    <div class="fishing-area">
                        <div class="fisherman-row" id="fisherman-row">
                            <!-- Fishermen will be added here -->
                        </div>
                        <div class="fishing-lake" id="fishing-lake">
                            <div class="ripples" id="ripples"></div>
                        </div>

                        <div class="location-dropdown">
                            <select id="location-select" onchange="game.changeLocation(this.value)">
                                <!-- Locations will be dynamically added here -->
                            </select>
                        </div>
                    </div>

                    <div class="controls">
                        <button class="btn" id="cast-btn">CAST LINE</button>
                        <button class="btn" id="shop-btn">TACKLE SHOP</button>
                        <button class="btn" id="tournament-btn">TOURNAMENT</button>
                        <button class="btn" id="inventory-btn">INVENTORY</button>
                        <button class="btn" id="help-btn">‚ùì HELP</button>
                        <button class="btn" id="sound-btn">üîä SOUND ON</button>
                    </div>
                    
                    <!-- Banner Ad - Desktop Bottom -->
                    <div class="ad-container ad-container-desktop" id="desktop-ad-bottom">
                        <!-- Ad will be loaded here -->
                        <div>Advertisement</div>
                    </div>
                </div>

                <!-- Right Sidebar -->
                <div class="right-sidebar">
                    <div class="section">
                        <h3>ONLINE PLAYERS</h3>
                        <div class="online-players" id="online-players">
                            <!-- Players will be added here -->
                        </div>
                    </div>

                    <div class="section">
                        <h3>LEADERBOARD</h3>
                        <div class="leaderboard" id="leaderboard">
                            <div class="leaderboard-category">
                                <h4>üèÜ BIGGEST FISH</h4>
                                <div class="leaderboard-list" id="biggest-fish-leaderboard">
                                    <div class="leaderboard-item">Loading...</div>
                                </div>
                            </div>
                            <div class="leaderboard-category">
                                <h4>üé£ BIGGEST BAGS</h4>
                                <div class="leaderboard-list" id="biggest-bags-leaderboard">
                                    <div class="leaderboard-item">Loading...</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3>TOURNAMENT INFO</h3>
                        <div class="tournament-info" id="tournament-info">
                            <div>No active tournament</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Section -->
            <div class="chat-section">
                <div class="section">
                    <h3>CHAT</h3>
                    <div class="chat-area" id="chat-area">
                        <div class="chat-message system">Welcome to Kitty Creek Fishing Club! üê±üé£</div>
                    </div>
                    <div class="chat-input-container">
                        <input type="text" id="chat-input" placeholder="Type a message...">
                    </div>
                </div>
                <div class="section">
                    <h3>GAME STATUS</h3>
                    <div class="game-status" id="game-status">
                        <div class="status-item">Auto-save: <span id="auto-save-status">Active</span></div>
                        <div class="status-item">Last Save: <span id="last-save-time">Never</span></div>
                        <div class="status-item">Data Size: <span id="data-size">0 KB</span></div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Catch message (must be outside both layouts to work on mobile) -->
        <div class="catch-message" id="catch-message">
            <div id="catch-text"></div>
        </div>

        <!-- Mobile Layout (hidden by default, shown on mobile via CSS) -->
        <div class="mobile-game-layout" id="mobile-game-layout" style="display: none;">
        <!-- Game Title - At the very top -->
        <div class="mobile-title">
            üê± KITTY CREEK FISHING CLUB üé£
        </div>
        
        <!-- Mobile Tab Navigation -->
        <div class="mobile-tabs">
            <button class="mobile-tab-btn active" data-tab="gameplay">üé£ FISH</button>
            <button class="mobile-tab-btn" data-tab="chat">üí¨ CHAT</button>
            <button class="mobile-tab-btn" data-tab="stats">üìä STATS</button>
            <button class="mobile-tab-btn" data-tab="inventory">üéí INV</button>
            <button class="mobile-tab-btn" data-tab="leaderboard">üèÜ LEADER</button>
        </div>

        <div class="mobile-header">
            <div class="mobile-header-left">
                <div class="mobile-header-name" id="mobile-player-name">Guest</div>
                <div class="mobile-header-stats">Level <span id="mobile-player-level">1</span> | $<span id="mobile-player-money">100</span></div>
            </div>
            <div class="mobile-header-right">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <button class="mobile-sound-toggle" id="mobile-sound-btn" style="background: rgba(100, 200, 255, 0.2); border: 1px solid rgba(100, 200, 255, 0.4); border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 16px; padding: 0;">üîä</button>
                    <div style="display: flex; flex-direction: column; gap: 2px;">
                        <div>Exp: <span id="mobile-player-exp">0</span>/<span id="mobile-next-exp">100</span></div>
                        <div><span id="mobile-fish-count">0</span> fish | <span id="mobile-total-weight">0</span> lbs</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile Tab Content -->
        <div class="mobile-tab-content">
            <!-- Gameplay Tab -->
            <div class="mobile-tab-panel active" id="mobile-tab-gameplay">
                <div class="mobile-fishing-area">
                    <div class="mobile-fisherman-row" id="mobile-fisherman-row">
                        <!-- Fishermen will be added here -->
                    </div>
                    <div class="mobile-fishing-lake" id="mobile-fishing-lake">
                        <div class="ripples" id="mobile-ripples"></div>
                    </div>
                    <div class="location-dropdown" style="background: rgba(20, 30, 50, 0.95); border: 2px solid rgba(100, 200, 255, 0.4); border-radius: 8px; padding: 8px; margin-top: 8px;">
                        <select id="mobile-location-select" onchange="game.changeLocation(this.value)" style="width: 100%; padding: 10px; background: rgba(15, 25, 40, 0.9); color: #64b5f6; border: 2px solid rgba(100, 200, 255, 0.4); border-radius: 6px; font-size: 12px;">
                            <!-- Locations will be dynamically added here -->
                        </select>
                    </div>
                </div>

                <!-- Tournament Timer Banner (shown during active tournaments) -->
                <div id="mobile-tournament-banner" style="display: none; background: rgba(100,200,255,0.2); border: 2px solid rgba(100,200,255,0.4); border-radius: 12px; padding: 12px; margin: 10px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.3);">
                    <div style="color: #ffffff; font-weight: bold; font-size: 14px; text-shadow: 0 2px 4px rgba(0,0,0,0.5);">üê± TOURNAMENT ACTIVE</div>
                    <div id="mobile-tournament-timer" style="font-size: 18px; font-weight: bold; color: #ffff00; margin-top: 5px;">0:00</div>
                </div>

                <div class="mobile-controls">
                    <button class="mobile-btn" id="mobile-cast-btn">CAST</button>
                    <button class="mobile-btn" id="mobile-shop-btn">SHOP</button>
                    <button class="mobile-btn" id="mobile-tournament-btn">TOURNY</button>
                </div>
            </div>

            <!-- Chat Tab -->
            <div class="mobile-tab-panel" id="mobile-tab-chat">
                <div class="chat-area" id="mobile-chat-area" style="font-size: 11px; max-height: calc(100vh - 230px); overflow-y: auto; padding: 10px; margin-bottom: 10px;"></div>
                <div class="mobile-chat-input" style="display: flex; gap: 8px; padding: 8px; background: rgba(20, 30, 50, 0.8); border-radius: 8px; margin-bottom: 10px;">
                    <input type="text" id="mobile-chat-input" placeholder="Type a message..." style="flex: 1; padding: 10px; background: rgba(15, 25, 40, 0.9); color: #64b5f6; border: 2px solid rgba(100, 200, 255, 0.4); border-radius: 6px; font-size: 12px;">
                    <button class="mobile-btn" id="mobile-send-btn" style="padding: 10px 16px; font-size: 12px;">Send</button>
                </div>
                <div class="mobile-panel" style="margin-top: 0;">
                    <button class="mobile-btn" id="mobile-help-btn" style="width: 100%; padding: 12px; font-size: 14px;">‚ùì HELP & GUIDE</button>
                </div>
            </div>

            <!-- Stats Tab -->
            <div class="mobile-tab-panel" id="mobile-tab-stats">
                <div class="mobile-panel">
                    <h4>PLAYER STATS</h4>
                    <div class="mobile-stats-grid">
                        <div>Accuracy: <span id="mobile-stat-accuracy">50</span></div>
                        <div>Luck: <span id="mobile-stat-luck">50</span></div>
                        <div>Patience: <span id="mobile-stat-patience">50</span></div>
                        <div>Strength: <span id="mobile-stat-strength">50</span></div>
                    </div>
                </div>
                <div class="mobile-panel">
                    <h4>ACHIEVEMENTS</h4>
                    <div class="achievements" id="mobile-achievements"></div>
                </div>
                <div class="mobile-panel">
                    <h4>CHARACTER INFO</h4>
                    <div style="font-size: 10px; margin: 10px 0;">
                        <div style="text-align: center; margin-bottom: 10px;">
                            <img id="mobile-character-display-img" src="" alt="Character" style="width: 60px; height: 60px; border-radius: 50%; border: 2px solid rgba(100,200,255,0.5); box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                        </div>
                        <div style="display: flex; gap: 5px; flex-direction: column; margin-top: 10px;">
                            <button class="mobile-btn" onclick="game.changeCharacter()" style="background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%); border-color: rgba(100,200,255,0.5); color: #ffffff; font-size: 10px; padding: 8px; border-radius: 8px; box-shadow: 0 2px 8px rgba(33,150,243,0.3);">üê± CHANGE CHARACTER</button>
                            <button class="mobile-btn" onclick="game.resetCharacter()" style="background: #330000; border-color: #ff0000; color: #ff0000; font-size: 10px; padding: 8px;">RESET CHARACTER</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Inventory Tab -->
            <div class="mobile-tab-panel" id="mobile-tab-inventory">
                <div class="mobile-panel">
                    <h4>EQUIPPED GEAR</h4>
                    <div id="mobile-equipped-gear" style="font-size: 11px; line-height: 1.6;"></div>
                </div>
                <div class="mobile-panel" style="margin-top: 15px;">
                    <h4>RECENT CATCHES</h4>
                    <div id="mobile-recent-catches" style="font-size: 10px;"></div>
                </div>
            </div>

            <!-- Leaderboard Tab -->
            <div class="mobile-tab-panel" id="mobile-tab-leaderboard">
                <div class="mobile-panel">
                    <h4>BIGGEST FISH</h4>
                    <div id="mobile-biggest-fish-leaderboard" style="font-size: 10px;"></div>
                </div>
                <div class="mobile-panel">
                    <h4>BIGGEST BAGS</h4>
                    <div id="mobile-biggest-bags-leaderboard" style="font-size: 10px;"></div>
                </div>
                <div class="mobile-panel">
                    <h4>TOURNAMENT STATS</h4>
                    <div id="mobile-tournament-stats" style="font-size: 10px;"></div>
                </div>
            </div>
        </div>

        <!-- Mobile Ad Bar (replaces old menu bar) -->
        <div class="mobile-menu-bar" style="padding: 8px;">
            <div class="ad-container ad-container-mobile" id="mobile-ad-bottom" style="margin: 0; height: 50px;">
                <!-- Ad will be loaded here -->
                <div>Advertisement</div>
            </div>
        </div>
        </div>

        <!-- Modals - Outside mobile-game-layout to ensure proper z-index stacking -->
        <!-- Tackle Shop Modal -->
        <div class="modal" id="tackle-shop-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üé£ TACKLE SHOP</h2>
                    <button class="close-btn" id="close-shop">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="shop-tabs">
                        <button class="tab-btn active" data-tab="rods">RODS</button>
                        <button class="tab-btn" data-tab="reels">REELS</button>
                        <button class="tab-btn" data-tab="lines">LINES</button>
                        <button class="tab-btn" data-tab="hooks">HOOKS</button>
                        <button class="tab-btn" data-tab="baits">BAITS</button>
                    </div>
                    <div class="shop-content" id="shop-content"></div>
                </div>
            </div>
        </div>

        <!-- Inventory Modal -->
        <div class="modal" id="inventory-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üéí INVENTORY</h2>
                    <button class="close-btn" id="close-inventory">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="inventory-tabs">
                        <button class="tab-btn active" data-tab="recent">RECENT CATCHES</button>
                        <button class="tab-btn" data-tab="top10">TOP 10 BIGGEST</button>
                        <button class="tab-btn" data-tab="gear">EQUIPPED GEAR</button>
                    </div>
                    <div id="inventory-content"></div>
                </div>
            </div>
        </div>

        <!-- Help Modal -->
        <div class="modal" id="help-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>‚ùì HELP & GUIDE</h2>
                    <button class="close-btn" id="close-help">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="help-content">
                        <h3>üê± Welcome to Kitty Creek Fishing Club!</h3>
                        <p>Compete with other fisher-cats in real-time tournaments, catch legendary fish, and become the purrfect angler!</p>
                        
                        <h3>üéÆ How to Play</h3>
                        <ol>
                            <li><strong>Cast Your Line:</strong> Click the CAST button or press Spacebar to throw your line into the water</li>
                            <li><strong>Wait for a Bite:</strong> Watch the water for ripples - when you see movement, reel in quickly!</li>
                            <li><strong>Catch Fish:</strong> Reel in before the fish gets away</li>
                            <li><strong>Upgrade Gear:</strong> Visit the Shop to buy better rods, reels, and tackle</li>
                            <li><strong>Level Up:</strong> Gain experience to unlock new locations and tackle</li>
                            <li><strong>Join Tournaments:</strong> Compete with other players for prizes!</li>
                        </ol>
                        
                        <h3>‚å®Ô∏è Keyboard Shortcuts</h3>
                        <div class="help-shortcuts">
                            <div class="shortcut-item">
                                <span class="shortcut-key">Space</span> - Cast line / Reel in
                            </div>
                            <div class="shortcut-item">
                                <span class="shortcut-key">S</span> - Open Tackle Shop
                            </div>
                            <div class="shortcut-item">
                                <span class="shortcut-key">T</span> - Join Tournament
                            </div>
                            <div class="shortcut-item">
                                <span class="shortcut-key">I</span> - View Inventory
                            </div>
                            <div class="shortcut-item">
                                <span class="shortcut-key">H</span> - Open Help
                            </div>
                        </div>
                        
                        <h3>üí° Tips & Hints</h3>
                        <ul>
                            <li><strong>Better Gear = Better Fish:</strong> Upgrade your rod, reel, and tackle to catch rare fish</li>
                            <li><strong>Location Matters:</strong> Different locations have different fish types and rarities</li>
                            <li><strong>Tournament Strategy:</strong> Fish as fast as possible during tournaments - biggest total weight wins!</li>
                            <li><strong>Auto-Save:</strong> The game automatically saves your progress every 30 seconds</li>
                            <li><strong>Big Catches:</strong> Rare, Huge, Legendary, and Trophy fish broadcast to all players!</li>
                        </ul>
                        
                        <h3>üèÜ Tournament Rules</h3>
                        <ul>
                            <li>Tournaments run for a set time period</li>
                            <li>Total weight of all catches determines the winner</li>
                            <li>Bigger fish = more weight = better chance to win!</li>
                            <li>Check the leaderboard to see how you rank</li>
                        </ul>
                        
                        <h3>üêü Fish Rarities</h3>
                        <ul>
                            <li><strong>Common:</strong> Easy to catch, lower value</li>
                            <li><strong>Uncommon:</strong> Regular fish, moderate value</li>
                            <li><strong>Rare:</strong> Special fish with higher value</li>
                            <li><strong>Huge:</strong> Large fish, excellent weight</li>
                            <li><strong>Legendary:</strong> Extremely rare catches!</li>
                            <li><strong>Trophy:</strong> The ultimate prize fish!</li>
                        </ul>
                        
                        <h3>üí¨ Chat Rules</h3>
                        <ul>
                            <li>Be respectful to other players</li>
                            <li>No spamming or inappropriate content</li>
                            <li>Have fun and happy fishing!</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div class="login-screen" id="login-screen">
        <div class="login-box">
            <h2>KITTY CREEK FISHING CLUB</h2>
            <input type="text" class="login-input" id="player-name-input" placeholder="Enter your username..." value="">
            <br>
            <div style="margin: 15px 0;">
                <label style="color: #ffffff; display: block; margin-bottom: 8px; font-weight: 600;">Customize Your Character:</label>
                
                <!-- Character Preview -->
                <div style="text-align: center; margin: 15px 0; min-height: 120px; background: rgba(20,30,50,0.8); border: 2px solid rgba(100,200,255,0.4); border-radius: 12px; padding: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.3);">
                    <img id="character-preview-avatar" src="https://robohash.org/cat-1?set=set4&size=200x200" alt="Cat Avatar" style="width: 100px; height: 100px; border-radius: 50%; border: 2px solid rgba(100,200,255,0.5); box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                    <div style="color: #ffffff; font-size: 11px; margin-top: 8px; font-weight: 600;">Your Fishing Cat üê±</div>
                </div>
                
                <!-- Cat Selector -->
                <div style="margin-bottom: 10px;">
                    <label style="color: #ffffff; font-size: 12px; display: block; margin-bottom: 8px; font-weight: 600;">Choose Your Fishing Cat:</label>
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button id="random-cat-btn" style="background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%); color: #ffffff; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 14px; box-shadow: 0 3px 10px rgba(33,150,243,0.3); transition: all 0.3s ease;">üé≤ Random Cat</button>
                        <button id="prev-cat-btn" style="background: #666; color: #fff; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 14px; display: none;">‚óÄ Previous</button>
                    </div>
                </div>
                
            </div>
            <button class="login-btn" id="login-btn">JOIN THE CLUB!</button>
        </div>
    </div>

    <!-- Welcome Back Screen -->
    <div class="login-screen" id="welcome-screen" style="display: none;">
        <div class="login-box">
            <h2 style="color: #00ff00;">üê± WELCOME BACK TO KITTY CREEK! üé£</h2>
            <div style="text-align: center; margin: 30px 0;">
                <img id="welcome-avatar" src="" alt="Your Cat" style="width: 150px; height: 150px; border-radius: 50%; border: 3px solid #00ff00; margin: 20px auto;">
                <div style="color: #00ff00; font-size: 24px; font-weight: bold; margin-top: 20px;" id="welcome-name">Loading...</div>
                <div style="color: #aaa; font-size: 14px; margin-top: 10px;">Loading Kitty Creek...</div>
            </div>
        </div>
    </div>

    <!-- Socket.io Client Library -->
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    
    <script>
        class FishingHoleMultiplayer {
            constructor() {
                // WebSocket connection for multiplayer
                this.socket = null;
                this.serverUrl = window.location.origin; // Will connect to Railway server
                this.connected = false;
                this.player = {
                    name: 'Guest',
                    character: 'https://api.dicebear.com/7.x/avataaars/svg?seed=default', // Default avatar URL
                    avatarOptions: { style: 'male', hairColor: 'Brown', facialHair: 'none', accessories: 'none' }, // Avatar customization options
                    level: 1,
                    money: 100,
                    experience: 0,
                    totalCaught: 0,
                    totalWeight: 0,
                    biggestCatch: 0,
                    locationUnlocks: [0, 1], // Start with first two locations unlocked
                    tackleUnlocks: {
                        rods: [0], // Basic Rod unlocked
                        reels: [0], // Basic Reel unlocked
                        lines: [0], // Basic Line unlocked
                        hooks: [0], // Basic Hook unlocked
                        baits: [0]  // Basic Bait unlocked
                    },
                    gear: {
                        rod: 'Basic Rod',
                        reel: 'Basic Reel',
                        line: 'Monofilament',
                        hook: 'Basic Hook',
                        bait: 'Basic Bait'
                    },
                    stats: {
                        accuracy: 50,
                        luck: 50,
                        patience: 50,
                        strength: 50
                    },
                    achievements: [],
                    recentCatches: [],
                    top10BiggestFish: [], // Always keep track of top 10 biggest fish ever caught
                    seasonalCatches: {
                        spring: { caught: 0, biggest: 0 },
                        summer: { caught: 0, biggest: 0 },
                        fall: { caught: 0, biggest: 0 },
                        winter: { caught: 0, biggest: 0 }
                    },
                    tournamentStats: {
                        tournamentsPlayed: 0,
                        tournamentsWon: 0,
                        biggestTournamentFish: 0,
                        biggestTournamentBag: 0,
                        totalTournamentWeight: 0,
                        totalTournamentFish: 0
                    }
                };

                this.locations = [
                    // Freshwater Locations
                    { name: 'Lake Shore', difficulty: 'Easy', fish: [0, 1, 2], cost: 0, unlockLevel: 1, description: 'Perfect for beginners' },
                    { name: 'River Bend', difficulty: 'Easy', fish: [0, 1, 2, 3], cost: 0, unlockLevel: 2, description: 'Gentle flowing waters' },
                    { name: 'Deep Lake', difficulty: 'Medium', fish: [2, 3, 4, 5], cost: 50, unlockLevel: 3, description: 'Deep waters with bigger fish' },
                    { name: 'Mountain Stream', difficulty: 'Medium', fish: [3, 4, 5, 6], cost: 75, unlockLevel: 5, description: 'Cold mountain waters' },
                    { name: 'Secret Pond', difficulty: 'Hard', fish: [4, 5, 6, 7], cost: 150, unlockLevel: 8, description: 'Hidden treasure spot' },
                    { name: 'Legendary Waters', difficulty: 'Expert', fish: [6, 7, 8, 9], cost: 300, unlockLevel: 12, description: 'Where legends are born' },
                    
                    // Saltwater Locations
                    { name: 'Ocean Pier', difficulty: 'Medium', fish: [10, 11, 12], cost: 100, unlockLevel: 6, description: 'Saltwater fishing spot' },
                    { name: 'Deep Sea', difficulty: 'Hard', fish: [12, 13, 14], cost: 250, unlockLevel: 10, description: 'Deep ocean fishing' },
                    { name: 'Trophy Waters', difficulty: 'Expert', fish: [25, 26, 27, 28, 29, 30, 31, 32], cost: 500, unlockLevel: 15, description: 'Trophy fish paradise' },
                    
                    // Special Locations
                    { name: 'Crystal Lake', difficulty: 'Hard', fish: [15, 16, 17, 18], cost: 200, unlockLevel: 9, description: 'Magical crystal-clear waters' },
                    { name: 'Abyss', difficulty: 'Expert', fish: [19, 20, 21, 22, 23], cost: 400, unlockLevel: 14, description: 'Bottomless depths' },
                    { name: 'Fishing Tournament', difficulty: 'Tournament', fish: [24, 25, 26, 27, 28], cost: 100, unlockLevel: 10, description: 'Competitive fishing event' }
                ];

                this.currentLocation = 0;
                this.isCasting = false;
                this.otherPlayers = [];
                this.tournament = null;
                this.leaderboardData = {
                    biggestFish: [],
                    biggestBags: []
                };

                // Sound system
                this.audioContext = null;
                this.sounds = {};
                this.soundEnabled = true;
                this.initAudio();

                this.fishTypes = [
                    // Common Fish (0-4)
                    { name: 'Minnow', rarity: 'Common', minWeight: 0.1, maxWeight: 0.5, value: 5, experience: 1, season: 'All' },
                    { name: 'Sunfish', rarity: 'Common', minWeight: 0.3, maxWeight: 1.2, value: 8, experience: 2, season: 'All' },
                    { name: 'Bass', rarity: 'Common', minWeight: 1.0, maxWeight: 5.0, value: 15, experience: 5, season: 'All' },
                    { name: 'Perch', rarity: 'Common', minWeight: 0.5, maxWeight: 2.0, value: 12, experience: 3, season: 'All' },
                    { name: 'Crappie', rarity: 'Common', minWeight: 0.8, maxWeight: 3.0, value: 18, experience: 4, season: 'All' },
                    
                    // Uncommon Fish (5-9)
                    { name: 'Trout', rarity: 'Uncommon', minWeight: 0.5, maxWeight: 3.0, value: 25, experience: 10, season: 'Spring/Fall' },
                    { name: 'Pike', rarity: 'Uncommon', minWeight: 2.0, maxWeight: 8.0, value: 40, experience: 15, season: 'All' },
                    { name: 'Walleye', rarity: 'Uncommon', minWeight: 1.5, maxWeight: 6.0, value: 35, experience: 12, season: 'Spring/Fall' },
                    { name: 'Muskie', rarity: 'Uncommon', minWeight: 5.0, maxWeight: 15.0, value: 60, experience: 20, season: 'All' },
                    { name: 'Carp', rarity: 'Uncommon', minWeight: 3.0, maxWeight: 20.0, value: 30, experience: 8, season: 'All' },
                    
                    // Rare Fish (10-14)
                    { name: 'Salmon', rarity: 'Rare', minWeight: 8.0, maxWeight: 25.0, value: 80, experience: 25, season: 'Fall' },
                    { name: 'Catfish', rarity: 'Rare', minWeight: 5.0, maxWeight: 30.0, value: 70, experience: 22, season: 'All' },
                    { name: 'Sturgeon', rarity: 'Rare', minWeight: 20.0, maxWeight: 50.0, value: 120, experience: 35, season: 'All' },
                    { name: 'Marlin', rarity: 'Rare', minWeight: 50.0, maxWeight: 200.0, value: 200, experience: 50, season: 'All' },
                    { name: 'Tuna', rarity: 'Rare', minWeight: 30.0, maxWeight: 150.0, value: 150, experience: 40, season: 'All' },
                    
                    // Epic Fish (15-19)
                    { name: 'Crystal Bass', rarity: 'Epic', minWeight: 10.0, maxWeight: 35.0, value: 300, experience: 60, season: 'All' },
                    { name: 'Golden Trout', rarity: 'Epic', minWeight: 5.0, maxWeight: 20.0, value: 250, experience: 55, season: 'Spring' },
                    { name: 'Ice Pike', rarity: 'Epic', minWeight: 15.0, maxWeight: 40.0, value: 350, experience: 65, season: 'Winter' },
                    { name: 'Shadow Catfish', rarity: 'Epic', minWeight: 25.0, maxWeight: 60.0, value: 400, experience: 70, season: 'All' },
                    { name: 'Abyssal Eel', rarity: 'Epic', minWeight: 30.0, maxWeight: 80.0, value: 500, experience: 80, season: 'All' },
                    
                    // Legendary Fish (20-24)
                    { name: 'Ancient Sturgeon', rarity: 'Legendary', minWeight: 100.0, maxWeight: 300.0, value: 1000, experience: 150, season: 'All' },
                    { name: 'Leviathan', rarity: 'Legendary', minWeight: 200.0, maxWeight: 500.0, value: 2000, experience: 200, season: 'All' },
                    { name: 'Phoenix Fish', rarity: 'Legendary', minWeight: 50.0, maxWeight: 150.0, value: 1500, experience: 180, season: 'All' },
                    { name: 'Dragon Carp', rarity: 'Legendary', minWeight: 80.0, maxWeight: 200.0, value: 1800, experience: 190, season: 'All' },
                    { name: 'Tournament King', rarity: 'Legendary', minWeight: 60.0, maxWeight: 120.0, value: 1200, experience: 160, season: 'All' },
                    
                    // Trophy Fish (25-32)
                    { name: 'Trophy Bass', rarity: 'Trophy', minWeight: 20.0, maxWeight: 50.0, value: 500, experience: 100, season: 'All' },
                    { name: 'Trophy Pike', rarity: 'Trophy', minWeight: 30.0, maxWeight: 70.0, value: 600, experience: 110, season: 'All' },
                    { name: 'Trophy Salmon', rarity: 'Trophy', minWeight: 40.0, maxWeight: 80.0, value: 700, experience: 120, season: 'Fall' },
                    { name: 'Trophy Marlin', rarity: 'Trophy', minWeight: 100.0, maxWeight: 300.0, value: 1000, experience: 150, season: 'All' },
                    { name: 'Trophy Tuna', rarity: 'Trophy', minWeight: 80.0, maxWeight: 200.0, value: 800, experience: 130, season: 'All' },
                    { name: 'Trophy Sturgeon', rarity: 'Trophy', minWeight: 150.0, maxWeight: 400.0, value: 1200, experience: 170, season: 'All' },
                    { name: 'Trophy Catfish', rarity: 'Trophy', minWeight: 60.0, maxWeight: 150.0, value: 900, experience: 140, season: 'All' },
                    { name: 'Trophy King', rarity: 'Trophy', minWeight: 200.0, maxWeight: 500.0, value: 1500, experience: 200, season: 'All' }
                ];

                // Complete tackle system
                this.tackle = {
                    rods: [
                        { name: 'Basic Rod', cost: 0, catchBonus: 0, strength: 10, description: 'Starting rod', unlockLevel: 1 },
                        { name: 'Fiberglass Rod', cost: 100, catchBonus: 5, strength: 15, description: 'Better durability', unlockLevel: 3 },
                        { name: 'Carbon Fiber Rod', cost: 300, catchBonus: 10, strength: 20, description: 'Lightweight and strong', unlockLevel: 6 },
                        { name: 'Pro Rod', cost: 600, catchBonus: 15, strength: 25, description: 'Professional grade', unlockLevel: 9 },
                        { name: 'Master Rod', cost: 1000, catchBonus: 20, strength: 30, description: 'Master angler equipment', unlockLevel: 12 },
                        { name: 'Legendary Rod', cost: 2000, catchBonus: 25, strength: 40, description: 'Legendary craftsmanship', unlockLevel: 15 },
                        { name: 'Trophy Rod', cost: 5000, catchBonus: 30, strength: 50, description: 'Trophy fishing specialist', unlockLevel: 18 }
                    ],
                    reels: [
                        { name: 'Basic Reel', cost: 0, speedBonus: 0, smoothness: 10, description: 'Simple reel', unlockLevel: 1 },
                        { name: 'Spinning Reel', cost: 75, speedBonus: 5, smoothness: 15, description: 'Smooth retrieval', unlockLevel: 4 },
                        { name: 'Baitcasting Reel', cost: 200, speedBonus: 10, smoothness: 20, description: 'Precision casting', unlockLevel: 7 },
                        { name: 'Fly Reel', cost: 400, speedBonus: 15, smoothness: 25, description: 'Fly fishing specialist', unlockLevel: 10 },
                        { name: 'Big Game Reel', cost: 800, speedBonus: 20, smoothness: 30, description: 'Heavy duty fishing', unlockLevel: 13 },
                        { name: 'Trophy Reel', cost: 1500, speedBonus: 25, smoothness: 40, description: 'Trophy fishing specialist', unlockLevel: 16 }
                    ],
                    lines: [
                        { name: 'Monofilament', cost: 0, strength: 10, visibility: 5, description: 'Basic fishing line', unlockLevel: 1 },
                        { name: 'Braided Line', cost: 50, strength: 15, visibility: 3, description: 'Strong and thin', unlockLevel: 5 },
                        { name: 'Fluorocarbon', cost: 100, strength: 12, visibility: 1, description: 'Nearly invisible', unlockLevel: 8 },
                        { name: 'Wire Line', cost: 200, strength: 25, visibility: 8, description: 'Heavy duty fishing', unlockLevel: 12 },
                        { name: 'Titanium Line', cost: 500, strength: 35, visibility: 2, description: 'Ultimate strength', unlockLevel: 16 }
                    ],
                    hooks: [
                        { name: 'Basic Hook', cost: 0, catchBonus: 0, size: 8, description: 'Standard hook', unlockLevel: 1 },
                        { name: 'Barbed Hook', cost: 25, catchBonus: 5, size: 8, description: 'Better fish retention', unlockLevel: 3 },
                        { name: 'Circle Hook', cost: 50, catchBonus: 3, size: 6, description: 'Fish-friendly design', unlockLevel: 5 },
                        { name: 'Treble Hook', cost: 75, catchBonus: 8, size: 6, description: 'Triple hook design', unlockLevel: 7 },
                        { name: 'Jig Hook', cost: 100, catchBonus: 10, size: 4, description: 'Jig fishing specialist', unlockLevel: 10 },
                        { name: 'Trophy Hook', cost: 200, catchBonus: 15, size: 2, description: 'Trophy fish specialist', unlockLevel: 15 }
                    ],
                    baits: [
                        { name: 'Basic Bait', cost: 0, catchBonus: 0, durability: 10, description: 'Simple worm bait', unlockLevel: 1 },
                        { name: 'Live Bait', cost: 20, catchBonus: 8, durability: 15, description: 'Live worm', unlockLevel: 2 },
                        { name: 'Artificial Lure', cost: 50, catchBonus: 5, durability: 25, description: 'Reusable lure', unlockLevel: 4 },
                        { name: 'Premium Bait', cost: 100, catchBonus: 12, durability: 20, description: 'High-quality bait', unlockLevel: 6 },
                        { name: 'Specialty Bait', cost: 200, catchBonus: 18, durability: 15, description: 'Rare fish attractant', unlockLevel: 10 },
                        { name: 'Trophy Bait', cost: 500, catchBonus: 25, durability: 10, description: 'Trophy fish magnet', unlockLevel: 15 }
                    ]
                };

                this.init();
            }

            init() {
                this.loadGameData();
                
                // Check if player has saved data (has played before)
                const savedData = localStorage.getItem('fishingHoleGame');
                const loginScreen = document.getElementById('login-screen');
                const welcomeScreen = document.getElementById('welcome-screen');
                
                if (savedData) {
                    const gameData = JSON.parse(savedData);
                    // If player has a name and character saved, show welcome screen then auto-login
                    if (gameData.player && gameData.player.name && gameData.player.name !== 'Guest' && gameData.player.character) {
                        // Hide login screen (only shown for new players)
                        if (loginScreen) {
                            loginScreen.classList.add('hidden');
                        }
                        
                        // Set player data from saved game
                        this.player.name = gameData.player.name;
                        this.player.character = gameData.player.character;
                        this.player.avatarOptions = gameData.player.avatarOptions || { type: 'cat', url: gameData.player.character };
                        
                        // Show welcome screen
                        if (welcomeScreen) {
                            welcomeScreen.style.display = 'flex';
                            const welcomeName = document.getElementById('welcome-name');
                            const welcomeAvatar = document.getElementById('welcome-avatar');
                            if (welcomeName) welcomeName.textContent = this.player.name;
                            if (welcomeAvatar) welcomeAvatar.src = this.player.character;
                            
                            // Hide welcome screen after 2 seconds and start game
                            setTimeout(() => {
                                if (welcomeScreen) welcomeScreen.style.display = 'none';
                                this.addChatMessage('system', `${this.player.name} joined Kitty Creek Fishing Club! üê±`);
                                this.positionPlayers();
                                this.joinGame();
                            }, 2000);
                        } else {
                            // If welcome screen doesn't exist, just start game
                            this.addChatMessage('system', `${this.player.name} joined Kitty Creek Fishing Club! üê±`);
                            this.positionPlayers();
                            this.joinGame();
                        }
                    } else {
                        // Player has data but no character - show login to create character
                        if (loginScreen) {
                            loginScreen.classList.remove('hidden');
                        }
                    }
                } else {
                    // New player - show login screen to create character
                    if (loginScreen) {
                        loginScreen.classList.remove('hidden');
                    }
                }
                
                this.connectToServer(); // Connect to Railway server
                this.setupEventListeners();
                if (!this.player.name || this.player.name === 'Guest') {
                    // Only position players if not auto-logged in
                    this.positionPlayers();
                }
                this.simulateMultiplayer();
                this.updateDisplay();
                this.updateAchievementsDisplay();
                this.updateLeaderboard();
                this.createAnimatedRipples();
                this.startAutoSave(); // Start auto-save
            }

            connectToServer() {
                try {
                    this.socket = io(this.serverUrl, {
                        transports: ['websocket', 'polling']
                    });

                    this.socket.on('connect', () => {
                        console.log('Connected to server');
                        this.connected = true;
                        this.addChatMessage('system', 'Connected to multiplayer server!');
                        
                        // Join game after login
                        if (this.player.name !== 'Guest') {
                            this.joinGame();
                        }
                    });

                    this.socket.on('disconnect', () => {
                        console.log('Disconnected from server');
                        this.connected = false;
                        this.addChatMessage('system', 'Disconnected from server');
                    });

                    this.socket.on('player-joined', (data) => {
                        this.addChatMessage('other', `${data.name} joined the game!`);
                        this.showGlobalAnnouncement(`üëã ${data.name} joined Kitty Creek! üê±`, '#00ffff');
                        this.updateOnlinePlayers();
                    });

                    this.socket.on('player-left', (data) => {
                        this.addChatMessage('other', `${data.name} left the game`);
                        this.updateOnlinePlayers();
                        
                        // Remove fishing lines for the player who left - use player name to avoid index issues
                        const lake = document.getElementById('fishing-lake');
                        const mobileLake = document.getElementById('mobile-fishing-lake');
                        
                        if (lake) {
                            // Remove lines by player name (more reliable than index)
                            lake.querySelectorAll('.fishing-line').forEach(line => {
                                if (line.dataset.playerName && line.dataset.playerName.includes(data.name)) {
                                    line.remove();
                                }
                            });
                            // Also remove any orphaned hooks
                            lake.querySelectorAll('.hook').forEach(hook => {
                                const parentLine = hook.closest('.fishing-line');
                                if (!parentLine || (parentLine.dataset.playerName && parentLine.dataset.playerName.includes(data.name))) {
                                    hook.remove();
                                }
                            });
                        }
                        
                        if (mobileLake) {
                            // Remove lines by player name
                            mobileLake.querySelectorAll('.fishing-line').forEach(line => {
                                if (line.dataset.playerName && line.dataset.playerName.includes(data.name)) {
                                    line.remove();
                                }
                            });
                            // Also remove any orphaned hooks
                            mobileLake.querySelectorAll('.hook').forEach(hook => {
                                const parentLine = hook.closest('.fishing-line');
                                if (!parentLine || (parentLine.dataset.playerName && parentLine.dataset.playerName.includes(data.name))) {
                                    hook.remove();
                                }
                            });
                        }
                        
                        // Reposition players to clean up empty spots
                        this.positionPlayers();
                    });

                    this.socket.on('player-list', (players) => {
                        // Separate real players from simulated ones
                        // players is now an array of objects with {name, level}
                        const realPlayerData = players.filter(p => p.name !== this.player.name);
                        const simulatedPlayers = this.otherPlayers.filter(p => p.isSimulated);
                        
                        // Map real players with their actual levels and characters
                        const realPlayers = realPlayerData.map(playerData => ({
                            name: playerData.name,
                            level: playerData.level || 1,
                            character: playerData.character || `https://robohash.org/cat-${playerData.name}?set=set4&size=200x200`, // Use received character
                            fishing: false,
                            catches: 0,
                            isCasting: false,
                            biggestCatch: 0,
                            recentCatches: [],
                            isSimulated: false // Mark as real player
                        }));
                        
                        // Combine real players with simulated ones
                        this.otherPlayers = [...realPlayers, ...simulatedPlayers];
                        this.updateOnlinePlayers();
                        this.positionPlayers(); // Update visual positioning
                    });

                    this.socket.on('fish-caught', (data) => {
                        // Only show chat message if not marked as silent (tournament catches are silent)
                        if (!data.silent) {
                            this.addChatMessage('other', `${data.player} caught a ${data.fish.name} (${data.weight.toFixed(1)} lbs)!`);
                        }
                        
                        // Update tournament scores if this is a tournament catch
                        if (data.tournamentId && this.tournament && this.tournament.tournamentId === data.tournamentId) {
                            if (!this.tournament.scores[data.player]) {
                                this.tournament.scores[data.player] = {
                                    totalWeight: 0,
                                    fishCount: 0,
                                    biggestCatch: 0
                                };
                                this.tournament.catches[data.player] = [];
                            }
                            
                            this.tournament.scores[data.player].totalWeight += data.weight;
                            this.tournament.scores[data.player].fishCount++;
                            if (data.weight > this.tournament.scores[data.player].biggestCatch) {
                                this.tournament.scores[data.player].biggestCatch = data.weight;
                            }
                            
                            this.tournament.catches[data.player].push({
                                fish: data.fish.name,
                                weight: data.weight,
                                timestamp: Date.now()
                            });
                            
                            // Update tournament display if active
                            if (this.tournament.phase === 'active') {
                                this.updateTournamentDisplay();
                            }
                        }
                    });

                    this.socket.on('special-catch', (data) => {
                        // Show special catch announcements to ALL players, including the one who caught it
                        const fishName = data.fish.name;
                        const weight = data.weight;
                        const value = data.value;
                        const isRare = data.isRare || false;
                        const isHuge = data.isHuge || false;
                        const isLegendary = data.isLegendary || false;
                        const isTrophy = data.isTrophy || false;
                        
                        // Only show for other players (not the one who caught it)
                        if (data.player !== this.player.name) {
                            if (isLegendary || isTrophy) {
                                this.addChatMessage('legendary', `üèÜ LEGENDARY CATCH! ${data.player} caught a ${fishName}! ${weight.toFixed(1)}lbs, +$${value} üèÜ`);
                                this.showGlobalAnnouncement(`üèÜ LEGENDARY CATCH! ${data.player} caught a ${fishName}! ${weight.toFixed(1)}lbs üèÜ`, '#ff00ff');
                            } else if (isRare) {
                                this.addChatMessage('rare', `üíé RARE CATCH! ${data.player} caught a ${fishName}! ${weight.toFixed(1)}lbs, +$${value} üíé`);
                                this.showGlobalAnnouncement(`üíé RARE CATCH! ${data.player} caught a ${fishName}! ${weight.toFixed(1)}lbs üíé`, '#00ffff');
                            } else if (isHuge) {
                                this.addChatMessage('huge', `üêü HUGE FISH! ${data.player} caught a massive ${fishName}! ${weight.toFixed(1)}lbs, +$${value} üêü`);
                                this.showGlobalAnnouncement(`üêü HUGE FISH! ${data.player} caught a massive ${fishName}! ${weight.toFixed(1)}lbs üêü`, '#ffff00');
                            }
                        }
                    });

                    this.socket.on('chat-message', (data) => {
                        this.addChatMessage('other', `${data.player}: ${data.message}`);
                        // Show message in banner above buttons
                        this.showChatBanner(`${data.player}: ${data.message}`);
                    });

                    this.socket.on('game-saved', () => {
                        console.log('Game saved to server');
                    });

                    this.socket.on('error', (error) => {
                        console.error('Server error:', error);
                        this.addChatMessage('system', `Error: ${error.message}`);
                    });

                    this.socket.on('tournament-start', (data) => {
                        // Only create tournament for other players (not if we already have one)
                        if (!this.tournament) {
                            // Create a read-only tournament instance for viewing
                            // Use the same startTime so countdown matches
                            this.tournament = {
                                active: true,
                                phase: 'joining',
                                participants: data.participants || [],
                                startTime: Date.now() - (data.elapsedTime || 0), // Match the host's countdown
                                duration: 5 * 60 * 1000, // 5 minutes
                                joinPeriod: 60 * 1000, // 60 seconds to join
                                scores: {},
                                tournamentId: data.tournamentId,
                                catches: {},
                                isViewer: true // Mark as viewer-only (not participant)
                            };
                            
                            // Initialize scores for all participants
                            this.tournament.participants.forEach(name => {
                                this.tournament.scores[name] = {
                                    totalWeight: 0,
                                    fishCount: 0,
                                    biggestCatch: 0
                                };
                                this.tournament.catches[name] = [];
                            });
                            
                            this.updateTournamentDisplay();
                            this.showGlobalAnnouncement('üê± KITTY CREEK TOURNAMENT STARTING! üé£', '#ffff00');
                            this.addChatMessage('system', 'üê± A tournament is starting! Join by clicking TOURNAMENT button!');
                        }
                    });

                    this.socket.on('tournament-countdown', (data) => {
                        // Show countdown for viewers
                        if (this.tournament && this.tournament.isViewer) {
                            this.showGlobalAnnouncement(`üê± TOURNAMENT STARTS IN ${data.seconds} SECONDS! üé£`, '#ff00ff');
                            this.addChatMessage('system', `Tournament starts in ${data.seconds} seconds!`);
                            this.updateTournamentDisplay(); // Update the display
                        }
                    });

                    this.socket.on('tournament-active', (data) => {
                        // Switch to active phase for viewers
                        if (this.tournament && this.tournament.isViewer && this.tournament.tournamentId === data.tournamentId) {
                            this.tournament.phase = 'active';
                            this.tournament.startTime = Date.now();
                            this.updateTournamentDisplay();
                            this.showGlobalAnnouncement('üê± KITTY CREEK TOURNAMENT HAS BEGUN! üé£', '#00ff00');
                            this.addChatMessage('system', 'üê± TOURNAMENT FISHING HAS BEGUN! Good luck, furriend!');
                        }
                    });

                    this.socket.on('tournament-end', (data) => {
                        // Update tournament scores and show results for viewers
                        if (this.tournament && this.tournament.tournamentId === data.tournamentId) {
                            this.tournament.scores = data.scores;
                            this.tournament.catches = data.catches;
                            this.tournament.phase = 'ended';
                            
                            // Award prize money if this player won
                            if (data.winner === this.player.name && data.prizeAmount > 0) {
                                this.player.money += data.prizeAmount;
                                this.addChatMessage('system', `üèÜ Congratulations! You won $${data.prizeAmount} prize money!`);
                                this.showMessage(`üèÜ Tournament Win: +$${data.prizeAmount}!`, '#ffd700');
                                this.saveGameData();
                            }
                            
                            // Show results
                            this.showTournamentResults();
                            this.addChatMessage('system', `Tournament ended! Winner: ${data.winner} with ${Math.max(...Object.values(data.scores).map(s => s.totalWeight)).toFixed(2)} lbs!`);
                            
                            // Clear tournament after showing results
                            setTimeout(() => {
                                this.tournament = null;
                                this.updateTournamentDisplay();
                            }, 10000);
                        }
                    });

                    this.socket.on('player-casting', (data) => {
                        // Find player and show their casting animation
                        const playerIndex = this.otherPlayers.findIndex(p => p.name === data.name);
                        if (playerIndex !== -1) {
                            this.otherPlayers[playerIndex].isCasting = true;
                            this.addFishingLine(playerIndex + 1, true); // +1 because index 0 is current player
                            
                            // Auto-reel after a delay (simulated)
                            setTimeout(() => {
                                if (this.otherPlayers[playerIndex]) {
                                    this.otherPlayers[playerIndex].isCasting = false;
                                    const lines = document.querySelectorAll('.fishing-line');
                                    lines.forEach(line => {
                                        if (line.dataset.playerIndex == (playerIndex + 1).toString()) {
                                            line.remove();
                                        }
                                    });
                                }
                            }, 3000 + Math.random() * 2000);
                        }
                    });
                } catch (error) {
                    console.error('Failed to connect to server:', error);
                    this.addChatMessage('system', 'Multiplayer unavailable - playing offline');
                }
            }

            joinGame() {
                if (this.socket && this.connected) {
                    this.socket.emit('join-game', {
                        name: this.player.name,
                        level: this.player.level,
                        money: this.player.money,
                        experience: this.player.experience,
                        locationUnlocks: this.player.locationUnlocks,
                        tackleUnlocks: this.player.tackleUnlocks,
                        gear: this.player.gear,
                        stats: this.player.stats,
                        character: this.player.character // Send selected avatar
                    });
                }
            }

            initAudio() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    this.createSounds();
                } catch (error) {
                    console.log('Web Audio API not supported, sounds disabled');
                }
            }

            createSounds() {
                if (!this.audioContext) return;

                // Casting sound - whoosh with line release
                this.sounds.cast = () => {
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(200, this.audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(50, this.audioContext.currentTime + 0.3);
                    
                    gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.3);
                    
                    oscillator.start();
                    oscillator.stop(this.audioContext.currentTime + 0.3);
                };

                // Reeling sound - mechanical whirring
                this.sounds.reel = () => {
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    const filter = this.audioContext.createBiquadFilter();
                    
                    oscillator.connect(filter);
                    filter.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);
                    
                    oscillator.type = 'sawtooth';
                    oscillator.frequency.setValueAtTime(80, this.audioContext.currentTime);
                    oscillator.frequency.linearRampToValueAtTime(120, this.audioContext.currentTime + 0.5);
                    
                    filter.type = 'lowpass';
                    filter.frequency.setValueAtTime(200, this.audioContext.currentTime);
                    
                    gainNode.gain.setValueAtTime(0.2, this.audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.5);
                    
                    oscillator.start();
                    oscillator.stop(this.audioContext.currentTime + 0.5);
                };

                // Cat meow sound generator
                this.sounds.catMeow = (pitch = 400, duration = 0.3) => {
                    const osc1 = this.audioContext.createOscillator();
                    const osc2 = this.audioContext.createOscillator();
                    const gain = this.audioContext.createGain();
                    const filter = this.audioContext.createBiquadFilter();
                    
                    osc1.type = 'sine';
                    osc2.type = 'triangle';
                    
                    // Create meow shape: start high, dip down, go back up
                    osc1.frequency.setValueAtTime(pitch * 1.5, this.audioContext.currentTime);
                    osc1.frequency.exponentialRampToValueAtTime(pitch * 0.7, this.audioContext.currentTime + duration * 0.4);
                    osc1.frequency.exponentialRampToValueAtTime(pitch * 1.2, this.audioContext.currentTime + duration);
                    
                    osc2.frequency.setValueAtTime(pitch * 1.3, this.audioContext.currentTime);
                    osc2.frequency.exponentialRampToValueAtTime(pitch * 0.8, this.audioContext.currentTime + duration * 0.4);
                    osc2.frequency.exponentialRampToValueAtTime(pitch * 1.1, this.audioContext.currentTime + duration);
                    
                    filter.type = 'bandpass';
                    filter.frequency.setValueAtTime(pitch, this.audioContext.currentTime);
                    filter.Q.setValueAtTime(3, this.audioContext.currentTime);
                    
                    osc1.connect(filter);
                    osc2.connect(filter);
                    filter.connect(gain);
                    gain.connect(this.audioContext.destination);
                    
                    gain.gain.setValueAtTime(0.25, this.audioContext.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);
                    
                    osc1.start();
                    osc2.start();
                    osc1.stop(this.audioContext.currentTime + duration);
                    osc2.stop(this.audioContext.currentTime + duration);
                };

                // Cat purr sound
                this.sounds.catPurr = () => {
                    const osc = this.audioContext.createOscillator();
                    const gain = this.audioContext.createGain();
                    const filter = this.audioContext.createBiquadFilter();
                    
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(120, this.audioContext.currentTime);
                    osc.frequency.setValueAtTime(115, this.audioContext.currentTime + 0.1);
                    osc.frequency.setValueAtTime(125, this.audioContext.currentTime + 0.2);
                    osc.frequency.setValueAtTime(120, this.audioContext.currentTime + 0.3);
                    
                    filter.type = 'lowpass';
                    filter.frequency.setValueAtTime(300, this.audioContext.currentTime);
                    
                    osc.connect(filter);
                    filter.connect(gain);
                    gain.connect(this.audioContext.destination);
                    
                    gain.gain.setValueAtTime(0.15, this.audioContext.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.5);
                    
                    osc.start();
                    osc.stop(this.audioContext.currentTime + 0.5);
                };

                // Fish caught sound - splash and cat meow!
                this.sounds.catch = () => {
                    // Splash sound
                    const splashOsc = this.audioContext.createOscillator();
                    const splashGain = this.audioContext.createGain();
                    const splashFilter = this.audioContext.createBiquadFilter();
                    
                    splashOsc.connect(splashFilter);
                    splashFilter.connect(splashGain);
                    splashGain.connect(this.audioContext.destination);
                    
                    splashOsc.type = 'sawtooth';
                    splashFilter.type = 'bandpass';
                    splashFilter.frequency.setValueAtTime(800, this.audioContext.currentTime);
                    splashFilter.Q.setValueAtTime(1, this.audioContext.currentTime);
                    
                    splashGain.gain.setValueAtTime(0.3, this.audioContext.currentTime);
                    splashGain.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.2);
                    
                    splashOsc.start();
                    splashOsc.stop(this.audioContext.currentTime + 0.2);
                    
                    // Cat meow for success!
                    setTimeout(() => {
                        this.sounds.catMeow(450, 0.3);
                    }, 150);
                };

                // Big fish caught - deeper splash and excited cat meows!
                this.sounds.bigCatch = () => {
                    // Big splash
                    const bigSplashOsc = this.audioContext.createOscillator();
                    const bigSplashGain = this.audioContext.createGain();
                    const bigSplashFilter = this.audioContext.createBiquadFilter();
                    
                    bigSplashOsc.connect(bigSplashFilter);
                    bigSplashFilter.connect(bigSplashGain);
                    bigSplashGain.connect(this.audioContext.destination);
                    
                    bigSplashOsc.type = 'sawtooth';
                    bigSplashFilter.type = 'bandpass';
                    bigSplashFilter.frequency.setValueAtTime(400, this.audioContext.currentTime);
                    bigSplashFilter.Q.setValueAtTime(0.5, this.audioContext.currentTime);
                    
                    bigSplashGain.gain.setValueAtTime(0.4, this.audioContext.currentTime);
                    bigSplashGain.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.4);
                    
                    bigSplashOsc.start();
                    bigSplashOsc.stop(this.audioContext.currentTime + 0.4);
                    
                    // Excited cat meows (higher pitch, more energetic)
                    setTimeout(() => {
                        this.sounds.catMeow(550, 0.25); // First excited meow
                        setTimeout(() => {
                            this.sounds.catMeow(600, 0.3); // Second higher meow
                        }, 200);
                    }, 250);
                };

                // Level up celebration - cat purr and happy meows!
                this.sounds.levelUp = () => {
                    // Cat purr for level up happiness
                    this.sounds.catPurr();
                    
                    // Happy meows after purr
                    setTimeout(() => {
                        this.sounds.catMeow(500, 0.35); // Happy meow
                        setTimeout(() => {
                            this.sounds.catMeow(550, 0.3); // Excited follow-up
                        }, 300);
                    }, 400);
                };
            }

            playFanfare() {
                const notes = [523, 659, 784, 1047]; // C, E, G, C (octave)
                notes.forEach((freq, index) => {
                    setTimeout(() => {
                        const osc = this.audioContext.createOscillator();
                        const gain = this.audioContext.createGain();
                        
                        osc.connect(gain);
                        gain.connect(this.audioContext.destination);
                        
                        osc.frequency.setValueAtTime(freq, this.audioContext.currentTime);
                        gain.gain.setValueAtTime(0.15, this.audioContext.currentTime);
                        gain.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.3);
                        
                        osc.start();
                        osc.stop(this.audioContext.currentTime + 0.3);
                    }, index * 100);
                });
            }

            playFireworks() {
                // Multiple firework bursts
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => {
                        const osc = this.audioContext.createOscillator();
                        const gain = this.audioContext.createGain();
                        const filter = this.audioContext.createBiquadFilter();
                        
                        osc.connect(filter);
                        filter.connect(gain);
                        gain.connect(this.audioContext.destination);
                        
                        osc.type = 'sawtooth';
                        osc.frequency.setValueAtTime(200 + Math.random() * 200, this.audioContext.currentTime);
                        osc.frequency.exponentialRampToValueAtTime(50, this.audioContext.currentTime + 0.5);
                        
                        filter.type = 'lowpass';
                        filter.frequency.setValueAtTime(1000, this.audioContext.currentTime);
                        filter.frequency.exponentialRampToValueAtTime(100, this.audioContext.currentTime + 0.5);
                        
                        gain.gain.setValueAtTime(0.3, this.audioContext.currentTime);
                        gain.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.5);
                        
                        osc.start();
                        osc.stop(this.audioContext.currentTime + 0.5);
                    }, i * 200);
                }
            }

            playSound(soundName) {
                if (this.soundEnabled && this.audioContext && this.sounds[soundName]) {
                    // Resume audio context if suspended (required by some browsers)
                    if (this.audioContext.state === 'suspended') {
                        this.audioContext.resume();
                    }
                    this.sounds[soundName]();
                }
            }

            toggleSound() {
                this.soundEnabled = !this.soundEnabled;
                const soundBtn = document.getElementById('sound-btn');
                const mobileSoundBtn = document.getElementById('mobile-sound-btn');
                
                if (soundBtn) {
                    soundBtn.textContent = this.soundEnabled ? 'üîä SOUND ON' : 'üîá SOUND OFF';
                }
                
                if (mobileSoundBtn) {
                    mobileSoundBtn.textContent = this.soundEnabled ? 'üîä' : 'üîá';
                }
                
                if (this.soundEnabled) {
                    this.addChatMessage('system', 'Sound effects enabled!');
                } else {
                    this.addChatMessage('system', 'Sound effects disabled!');
                }
            }

            showCongratulationsPopup(type, items) {
                const level = this.player.level;
                let title = '';
                let itemList = '';
                
                if (type === 'location') {
                    title = `Congratulations on reaching Level ${level}!`;
                    itemList = `You have unlocked new fishing locations:\n‚Ä¢ ${items.join('\n‚Ä¢ ')}`;
                } else if (type === 'tackle') {
                    title = `Congratulations on reaching Level ${level}!`;
                    itemList = `You have unlocked new tackle:\n‚Ä¢ ${items.join('\n‚Ä¢ ')}`;
                }
                
                // Create popup modal
                const popup = document.createElement('div');
                popup.className = 'congratulations-popup';
                popup.innerHTML = `
                    <div class="congratulations-content">
                        <div class="congratulations-header">
                            <h2>üéâ ${title} üéâ</h2>
                        </div>
                        <div class="congratulations-body">
                            <p>${itemList}</p>
                        </div>
                        <div class="congratulations-footer">
                            <button class="btn" onclick="this.parentElement.parentElement.parentElement.remove()">Awesome!</button>
                        </div>
                    </div>
                `;
                
                // Add CSS for the popup
                popup.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.8);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                    animation: fadeIn 0.5s ease-out;
                `;
                
                // Add CSS for the content
                const style = document.createElement('style');
                style.textContent = `
                    .congratulations-content {
                        background: linear-gradient(135deg, #001100, #003300);
                        border: 2px solid rgba(100, 200, 255, 0.4);
                        border-radius: 15px;
                        padding: 30px;
                        max-width: 500px;
                        text-align: center;
                        box-shadow: 0 0 30px rgba(100, 181, 246, 0.5);
                        animation: slideIn 0.5s ease-out;
                    }
                    
                    .congratulations-header h2 {
                        color: #ffff00;
                        margin: 0 0 20px 0;
                        font-size: 24px;
                        text-shadow: 0 0 10px rgba(255, 255, 0, 0.5);
                    }
                    
                    .congratulations-body {
                        color: #64b5f6;
                        font-size: 16px;
                        line-height: 1.6;
                        margin-bottom: 25px;
                        white-space: pre-line;
                    }
                    
                    .congratulations-footer .btn {
                        background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%);
                        color: #000;
                        border: none;
                        padding: 12px 30px;
                        font-size: 16px;
                        font-weight: bold;
                        border-radius: 8px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    }
                    
                    .congratulations-footer .btn:hover {
                        background: #00cc00;
                        transform: scale(1.05);
                    }
                    
                    @keyframes fadeIn {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }
                    
                    @keyframes slideIn {
                        from { transform: translateY(-50px); opacity: 0; }
                        to { transform: translateY(0); opacity: 1; }
                    }
                `;
                
                document.head.appendChild(style);
                document.body.appendChild(popup);
                
                // Auto-remove after 10 seconds
                setTimeout(() => {
                    if (popup.parentElement) {
                        popup.remove();
                        style.remove();
                    }
                }, 10000);
            }

            setupEventListeners() {
                document.getElementById('cast-btn').addEventListener('click', () => this.castLine());
                document.getElementById('shop-btn').addEventListener('click', () => this.openShop());
                document.getElementById('tournament-btn').addEventListener('click', () => this.toggleTournament());
                document.getElementById('inventory-btn').addEventListener('click', () => this.openInventory());
                document.getElementById('help-btn').addEventListener('click', () => this.openHelp());
                document.getElementById('close-help').addEventListener('click', () => this.closeHelp());
                document.getElementById('sound-btn').addEventListener('click', () => this.toggleSound());

                // Login button
                document.getElementById('login-btn').addEventListener('click', () => this.login());

                // Cat avatar selection system
                window.selectedCat = null;
                window.previousCat = null;
                window.catSeedCounter = 1;
                
                // Generate cat avatar URL using RoboHash set4 (cats)
                const generateCatUrl = (seed) => {
                    return `https://robohash.org/${seed}?set=set4&size=200x200`;
                };
                
                // Get random cat
                const getRandomCat = () => {
                    const seed = `cat-${Date.now()}-${Math.random().toString(36).substring(7)}`;
                    return generateCatUrl(seed);
                };
                
                // Update preview with cat
                const updateCatPreview = (catUrl) => {
                    const previewImg = document.getElementById('character-preview-avatar');
                    if (previewImg) {
                        previewImg.src = catUrl;
                        window.selectedCat = catUrl;
                        
                        // Show previous button if we have a previous cat
                        const prevBtn = document.getElementById('prev-cat-btn');
                        if (prevBtn && window.previousCat) {
                            prevBtn.style.display = 'block';
                        }
                    }
                };
                
                // Random cat button
                document.getElementById('random-cat-btn').addEventListener('click', () => {
                    // Save current as previous before generating new one
                    if (window.selectedCat) {
                        window.previousCat = window.selectedCat;
                    }
                    const newCat = getRandomCat();
                    updateCatPreview(newCat);
                });
                
                // Previous cat button
                document.getElementById('prev-cat-btn').addEventListener('click', () => {
                    if (window.previousCat) {
                        const temp = window.selectedCat;
                        updateCatPreview(window.previousCat);
                        window.previousCat = temp;
                    }
                });
                
                // Initialize with first cat
                updateCatPreview(generateCatUrl('cat-initial'));

                // Inventory tab buttons
                document.querySelectorAll('.inventory-tabs .tab-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const tabName = e.currentTarget.dataset.tab || e.target.closest('.tab-btn')?.dataset.tab;
                        if (tabName) {
                            this.switchInventoryTab(tabName);
                        }
                    });
                });

                // Tackle shop buttons (delegated event listener)
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('tackle-btn')) {
                        const action = e.target.dataset.action;
                        const category = e.target.dataset.category;
                        const index = parseInt(e.target.dataset.index);
                        
                        if (action === 'buy') {
                            this.buyTackle(category, index);
                        } else if (action === 'equip') {
                            this.equipTackle(category, index);
                        }
                    }
                });

                // Keyboard controls
                document.addEventListener('keydown', (e) => {
                    // Spacebar to cast (only when not in input fields)
                    if (e.code === 'Space' && !['INPUT', 'TEXTAREA'].includes(e.target.tagName)) {
                        e.preventDefault();
                        if (!this.isCasting) {
                            this.castLine();
                        }
                    }
                });

                // Mouse interaction with water
                this.setupWaterInteractions();

                // Tackle shop modal events
                document.getElementById('close-shop').addEventListener('click', () => this.closeShop());

                // Mobile button handlers
                const mobileCastBtn = document.getElementById('mobile-cast-btn');
                const mobileShopBtn = document.getElementById('mobile-shop-btn');
                const mobileTournamentBtn = document.getElementById('mobile-tournament-btn');
                const mobileInventoryBtn = document.getElementById('mobile-inventory-btn');
                const mobileSaveBtn = document.getElementById('mobile-save-btn');
                const mobileExportBtn = document.getElementById('mobile-export-btn');
                const mobileSoundBtn = document.getElementById('mobile-sound-btn');
                const mobileHelpBtn = document.getElementById('mobile-help-btn');
                const mobileSendBtn = document.getElementById('mobile-send-btn');
                const mobileChatInput = document.getElementById('mobile-chat-input');

                if (mobileCastBtn) mobileCastBtn.addEventListener('click', () => this.castLine());
                if (mobileShopBtn) mobileShopBtn.addEventListener('click', () => this.openShop());
                if (mobileTournamentBtn) mobileTournamentBtn.addEventListener('click', () => this.toggleTournament());
                if (mobileInventoryBtn) mobileInventoryBtn.addEventListener('click', () => this.openInventory());
                if (mobileSaveBtn) mobileSaveBtn.addEventListener('click', () => this.manualSave());
                if (mobileExportBtn) mobileExportBtn.addEventListener('click', () => this.exportGameData());
                if (mobileSoundBtn) mobileSoundBtn.addEventListener('click', () => this.toggleSound());
                if (mobileHelpBtn) mobileHelpBtn.addEventListener('click', () => this.openHelp());
                
                if (mobileSendBtn) {
                    mobileSendBtn.addEventListener('click', () => {
                        if (mobileChatInput && mobileChatInput.value.trim()) {
                            this.sendMessage(mobileChatInput.value);
                            mobileChatInput.value = '';
                        }
                    });
                }

                if (mobileChatInput) {
                    mobileChatInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter' && mobileChatInput.value.trim()) {
                            this.sendMessage(mobileChatInput.value);
                            mobileChatInput.value = '';
                        }
                    });
                }

                // Mobile tab switching
                document.querySelectorAll('.mobile-tab-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const tabName = btn.dataset.tab;
                        
                        // Remove active class from all tabs and panels
                        document.querySelectorAll('.mobile-tab-btn').forEach(b => b.classList.remove('active'));
                        document.querySelectorAll('.mobile-tab-panel').forEach(p => p.classList.remove('active'));
                        
                        // Add active class to clicked tab and corresponding panel
                        btn.classList.add('active');
                        const panel = document.getElementById(`mobile-tab-${tabName}`);
                        if (panel) panel.classList.add('active');
                        
                        // Update inventory display when switching to inventory tab
                        if (tabName === 'inventory') {
                            this.updateMobileInventory();
                        }
                    });
                });

                document.getElementById('tackle-shop-modal').addEventListener('click', (e) => {
                    if (e.target.id === 'tackle-shop-modal') {
                        this.closeShop();
                    }
                });

                // Inventory modal events
                document.getElementById('close-inventory').addEventListener('click', () => this.closeInventory());
                document.getElementById('inventory-modal').addEventListener('click', (e) => {
                    if (e.target.id === 'inventory-modal') {
                        this.closeInventory();
                    }
                });

                // Shop tab events (only for tackle shop tabs)
                document.querySelectorAll('#tackle-shop-modal .tab-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => this.switchShopTab(e.target.dataset.tab));
                });

                document.getElementById('chat-input').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && e.target.value.trim()) {
                        this.sendMessage(e.target.value);
                        e.target.value = '';
                    }
                });
                
                // Help modal events
                document.getElementById('help-modal').addEventListener('click', (e) => {
                    if (e.target.id === 'help-modal') {
                        this.closeHelp();
                    }
                });
                
                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    // Don't trigger shortcuts when typing in inputs
                    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
                    
                    if (e.key === ' ' || e.key === 'Spacebar') {
                        e.preventDefault();
                        this.castLine();
                    } else if (e.key === 's' || e.key === 'S') {
                        e.preventDefault();
                        this.openShop();
                    } else if (e.key === 't' || e.key === 'T') {
                        e.preventDefault();
                        this.toggleTournament();
                    } else if (e.key === 'i' || e.key === 'I') {
                        e.preventDefault();
                        this.openInventory();
                    } else if (e.key === 'h' || e.key === 'H') {
                        e.preventDefault();
                        this.openHelp();
                    }
                });
            }

            login() {
                const name = document.getElementById('player-name-input').value.trim();
                if (!name) {
                    alert('Please enter your name!');
                    return;
                }

                this.player.name = name;
                
                // Get selected cat avatar
                const selectedCatUrl = window.selectedCat || 'https://robohash.org/cat-default?set=set4&size=200x200';
                this.player.character = selectedCatUrl;
                this.player.avatarOptions = { type: 'cat', url: selectedCatUrl };
                document.getElementById('login-screen').classList.add('hidden');
                this.addChatMessage('system', `${name} joined Kitty Creek Fishing Club! üê±`);
                this.positionPlayers(); // Reposition players with new name
                
                // Join multiplayer game
                this.joinGame();
                this.updateDisplay();
                this.saveGameData(); // Save character selection
            }


            positionPlayers() {
                const fishermanRow = document.getElementById('fisherman-row');
                const lake = document.getElementById('fishing-lake');
                const mobileFishermanRow = document.getElementById('mobile-fisherman-row');
                const mobileLake = document.getElementById('mobile-fishing-lake');
                
                // Clear existing fishermen and lines (including hooks) - comprehensive cleanup
                if (fishermanRow) fishermanRow.innerHTML = '';
                if (lake) {
                    // Remove all fishing lines and hooks
                    lake.querySelectorAll('.fishing-line').forEach(l => l.remove());
                    lake.querySelectorAll('.hook').forEach(h => h.remove());
                    // Also remove any orphaned splashes
                    lake.querySelectorAll('.hook-splash, .hook-landing-splash').forEach(s => s.remove());
                }
                if (mobileFishermanRow) mobileFishermanRow.innerHTML = '';
                if (mobileLake) {
                    // Remove all fishing lines and hooks
                    mobileLake.querySelectorAll('.fishing-line').forEach(l => l.remove());
                    mobileLake.querySelectorAll('.hook').forEach(h => h.remove());
                    // Also remove any orphaned splashes
                    mobileLake.querySelectorAll('.hook-splash, .hook-landing-splash').forEach(s => s.remove());
                }
                
                // Add current player
                const playerFisher = document.createElement('div');
                playerFisher.className = 'fisherman you';
                playerFisher.id = 'player-fisher';
                
                // Check if character is an image URL or emoji
                const isImageUrl = this.player.character && (this.player.character.startsWith('http') || this.player.character.startsWith('data:'));
                
                if (isImageUrl) {
                    playerFisher.innerHTML = `
                        <img src="${this.player.character}" alt="${this.player.name}" class="fisherman-avatar" style="width: 40px; height: 40px; border-radius: 50%;">
                        <div class="fisherman-name">${this.player.name}</div>
                    `;
                } else {
                    playerFisher.innerHTML = `
                        <div class="fisherman-character">${this.player.character || 'üë®'}</div>
                        <div class="fisherman-name">${this.player.name}</div>
                    `;
                }
                if (fishermanRow) fishermanRow.appendChild(playerFisher);

                // Add mobile player
                const mobilePlayerFisher = document.createElement('div');
                mobilePlayerFisher.className = 'mobile-fisherman';
                mobilePlayerFisher.id = 'mobile-player-fisher';
                
                if (isImageUrl) {
                    mobilePlayerFisher.innerHTML = `
                        <img src="${this.player.character}" alt="${this.player.name}" class="mobile-fisherman-avatar" style="width: 30px; height: 30px; border-radius: 50%;">
                        <div class="mobile-fisherman-name">${this.player.name}</div>
                    `;
                } else {
                    mobilePlayerFisher.innerHTML = `
                        <div class="mobile-fisherman-character">${this.player.character || 'üë®'}</div>
                        <div class="mobile-fisherman-name">${this.player.name}</div>
                    `;
                }
                if (mobileFishermanRow) mobileFishermanRow.appendChild(mobilePlayerFisher);
                
                // Add other players (all cats now!)
                this.otherPlayers.forEach((player, index) => {
                    // Generate or use stored cat avatar for each player
                    if (!player.character) {
                        // Generate a unique cat based on player name
                        const catSeed = `cat-${player.name}-${index}`;
                        player.character = `https://robohash.org/${catSeed}?set=set4&size=200x200`;
                    }
                    
                    const fisher = document.createElement('div');
                    fisher.className = 'fisherman other';
                    
                    // Check if character is an image URL (cat) or emoji
                    const isImageUrl = player.character && (player.character.startsWith('http') || player.character.startsWith('data:'));
                    
                    if (isImageUrl) {
                        fisher.innerHTML = `
                            <img src="${player.character}" alt="${player.name}" class="fisherman-avatar" style="width: 40px; height: 40px; border-radius: 50%;">
                            <div class="fisherman-name">${player.name}</div>
                        `;
                    } else {
                        fisher.innerHTML = `
                            <div class="fisherman-character">${player.character || 'üê±'}</div>
                            <div class="fisherman-name">${player.name}</div>
                        `;
                    }
                    fisher.title = `${player.name} - Level ${player.level}`;
                    if (fishermanRow) fishermanRow.appendChild(fisher);

                    // Add mobile other players
                    const mobileFisher = document.createElement('div');
                    mobileFisher.className = 'mobile-fisherman';
                    
                    if (isImageUrl) {
                        mobileFisher.innerHTML = `
                            <img src="${player.character}" alt="${player.name}" class="mobile-fisherman-avatar" style="width: 30px; height: 30px; border-radius: 50%;">
                            <div class="mobile-fisherman-name">${player.name}</div>
                        `;
                    } else {
                        mobileFisher.innerHTML = `
                            <div class="mobile-fisherman-character">${player.character || 'üê±'}</div>
                            <div class="mobile-fisherman-name">${player.name}</div>
                        `;
                    }
                    if (mobileFishermanRow) mobileFishermanRow.appendChild(mobileFisher);
                });
            }

            createAnimatedRipples() {
                const ripplesContainer = document.getElementById('ripples');
                const mobileRipplesContainer = document.getElementById('mobile-ripples');
                
                // Create multiple ripples at random positions
                for (let i = 0; i < 8; i++) {
                    setTimeout(() => {
                        if (ripplesContainer) this.createRipple(ripplesContainer);
                        if (mobileRipplesContainer) this.createRipple(mobileRipplesContainer);
                    }, i * 500); // Stagger the creation
                }
                
                // Continue creating ripples periodically
                setInterval(() => {
                    if (ripplesContainer) this.createRipple(ripplesContainer);
                    if (mobileRipplesContainer) this.createRipple(mobileRipplesContainer);
                }, 2000);
            }

            createRipple(container) {
                const ripple = document.createElement('div');
                ripple.className = 'ripple';
                
                // Random position within the lake
                const x = Math.random() * 80 + 10; // 10% to 90% of width
                const y = Math.random() * 80 + 10; // 10% to 90% of height
                const size = Math.random() * 30 + 20; // 20px to 50px
                
                ripple.style.left = x + '%';
                ripple.style.top = y + '%';
                ripple.style.width = size + 'px';
                ripple.style.height = size + 'px';
                
                // Random animation delay
                ripple.style.animationDelay = Math.random() * 2 + 's';
                
                container.appendChild(ripple);
                
                // Remove ripple after animation completes
                setTimeout(() => {
                    if (ripple.parentNode) {
                        ripple.parentNode.removeChild(ripple);
                    }
                }, 4000);
            }

            setupWaterInteractions() {
                const lake = document.getElementById('fishing-lake');
                let isDragging = false;
                let lastRippleTime = 0;
                const rippleThrottle = 100; // Minimum ms between ripples when dragging

                // Click on water
                lake.addEventListener('click', (e) => {
                    this.createMouseRipple(e, lake);
                });

                // Mouse down - start dragging
                lake.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    this.createMouseRipple(e, lake);
                });

                // Mouse move while dragging - create ripples
                lake.addEventListener('mousemove', (e) => {
                    if (isDragging) {
                        const now = Date.now();
                        if (now - lastRippleTime > rippleThrottle) {
                            this.createMouseRipple(e, lake);
                            lastRippleTime = now;
                        }
                    }
                });

                // Mouse up - stop dragging
                lake.addEventListener('mouseup', () => {
                    isDragging = false;
                });

                // Mouse leave - stop dragging
                lake.addEventListener('mouseleave', () => {
                    isDragging = false;
                });

                // Touch support for mobile
                lake.addEventListener('touchstart', (e) => {
                    isDragging = true;
                    const touch = e.touches[0];
                    this.createMouseRipple({ clientX: touch.clientX, clientY: touch.clientY }, lake);
                }, { passive: true });

                lake.addEventListener('touchmove', (e) => {
                    if (isDragging) {
                        e.preventDefault();
                        const touch = e.touches[0];
                        const now = Date.now();
                        if (now - lastRippleTime > rippleThrottle) {
                            this.createMouseRipple({ clientX: touch.clientX, clientY: touch.clientY }, lake);
                            lastRippleTime = now;
                        }
                    }
                }, { passive: false }); // Must be non-passive because we use preventDefault()

                lake.addEventListener('touchend', () => {
                    isDragging = false;
                }, { passive: true });
            }

            createMouseRipple(e, lake) {
                const ripple = document.createElement('div');
                ripple.className = 'mouse-ripple';
                
                // Get position relative to lake
                const rect = lake.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                // Set position
                ripple.style.left = x + 'px';
                ripple.style.top = y + 'px';
                ripple.style.width = '20px';
                ripple.style.height = '20px';
                ripple.style.transform = 'translate(-50%, -50%)';
                
                // Add to lake
                lake.appendChild(ripple);
                
                // Remove after animation
                setTimeout(() => {
                    if (ripple.parentNode) {
                        ripple.remove();
                    }
                }, 1500);
            }

            castLine() {
                if (this.isCasting) return;

                this.isCasting = true;
                const castBtn = document.getElementById('cast-btn');
                const mobileCastBtn = document.getElementById('mobile-cast-btn');
                
                if (castBtn) {
                    castBtn.textContent = 'REELING...';
                    castBtn.classList.add('casting');
                    castBtn.disabled = true;
                }
                
                if (mobileCastBtn) {
                    mobileCastBtn.textContent = 'REELING...';
                    mobileCastBtn.classList.add('casting');
                    mobileCastBtn.disabled = true;
                }

                // Add fishing line for current player
                this.addFishingLine(0, true);
                this.playSound('cast'); // Casting sound
                
                // Notify server
                if (this.socket && this.connected) {
                    this.socket.emit('cast-line');
                }
                
                const ripples = document.getElementById('ripples');
                ripples.classList.add('active');

                // Calculate catch chance
                const catchChance = this.calculateCatchChance();
                
                setTimeout(() => {
                    this.reelIn(catchChance);
                }, 2000 + Math.random() * 3000);
            }

            addFishingLine(playerIndex, isCasting = false) {
                const fishermanRow = document.getElementById('fisherman-row');
                const lake = document.getElementById('fishing-lake');
                const mobileFishermanRow = document.getElementById('mobile-fisherman-row');
                const mobileLake = document.getElementById('mobile-fishing-lake');
                
                // Detect if we're on mobile by checking screen width
                const isMobile = window.innerWidth <= 768;
                
                // Use mobile elements if we're on mobile, otherwise use desktop
                const activeFishermanRow = isMobile ? mobileFishermanRow : fishermanRow;
                const activeLake = isMobile ? mobileLake : lake;
                
                if (!activeFishermanRow || !activeLake) return null;
                
                const fishermen = activeFishermanRow.querySelectorAll('.fisherman, .mobile-fisherman');
                
                if (playerIndex >= fishermen.length) return null;
                
                const fisherman = fishermen[playerIndex];
                
                // CRITICAL: Check if fisherman is actually visible on screen
                // If fisherman has zero width/height or is not displayed, don't create a line
                const fishermanRect = fisherman.getBoundingClientRect();
                if (fishermanRect.width === 0 || fishermanRect.height === 0) {
                    // Fisherman is not visible, don't create a fishing line
                    return null;
                }
                
                // Check if fisherman is actually in the viewport (not hidden by CSS)
                const computedStyle = window.getComputedStyle(fisherman);
                if (computedStyle.display === 'none' || computedStyle.visibility === 'hidden' || computedStyle.opacity === '0') {
                    return null;
                }
                
                const lakeRect = activeLake.getBoundingClientRect();
                
                const line = document.createElement('div');
                line.className = 'fishing-line';
                line.dataset.playerIndex = playerIndex.toString();
                // Store player name for better cleanup tracking
                const playerName = fisherman.textContent.trim().split('\n')[0];
                line.dataset.playerName = playerName;
                if (isCasting) line.classList.add('casting');
                
                // Position line from fisherman to lake
                const fishermanCenterX = fishermanRect.left + fishermanRect.width / 2;
                const fishermanBottom = fishermanRect.bottom;
                const lakeTop = lakeRect.top;
                const lakeHeight = lakeRect.height;
                
                // Calculate responsive cast distance based on lake size
                // Cast further on larger screens, less on smaller screens
                const screenWidth = window.innerWidth;
                const screenHeight = window.innerHeight;
                
                // Base distance calculation - proportion of lake height
                let castDistance = lakeHeight * 0.5; // Cast halfway into lake by default
                
                // Adjust based on screen size
                if (screenWidth >= 1400 && screenHeight >= 800) {
                    // Large screens - cast much further
                    castDistance = lakeHeight * 0.7; // 70% of lake height
                } else if (screenWidth >= 1200 && screenHeight >= 700) {
                    // Medium screens - cast moderately
                    castDistance = lakeHeight * 0.6; // 60% of lake height
                } else if (screenWidth >= 992 && screenHeight >= 600) {
                    // Small screens - cast less
                    castDistance = lakeHeight * 0.5; // 50% of lake height
                } else {
                    // Very small screens - cast minimally
                    castDistance = lakeHeight * 0.4; // 40% of lake height
                }
                
                // Ensure minimum cast distance
                const minCast = 80;
                const maxCast = lakeHeight * 0.8; // Never more than 80% of lake
                castDistance = Math.max(minCast, Math.min(castDistance, maxCast));
                
                const lineLength = lakeTop - fishermanBottom + castDistance;
                
                line.style.left = (fishermanCenterX - lakeRect.left) + 'px';
                line.style.top = '0px';
                line.style.height = lineLength + 'px';
                
                const hook = document.createElement('div');
                hook.className = 'hook';
                line.appendChild(hook);
                
                // Add splash animation at the hook (bottom of the line)
                const splash = document.createElement('div');
                splash.className = 'hook-splash';
                splash.style.left = line.style.left;
                splash.style.top = lineLength + 'px'; // Position at bottom of line where hook is
                activeLake.appendChild(splash);
                
                // Store splash reference on line for cleanup
                line.dataset.splashId = splash.id || `splash-${Date.now()}-${Math.random()}`;
                splash.id = line.dataset.splashId;
                
                activeLake.appendChild(line);
                
                // Create landing splash effect when hook hits water (after line extends)
                setTimeout(() => {
                    this.createHookLandingSplash(line.style.left, lineLength, activeLake);
                }, 300); // Small delay to simulate hook reaching water
                
                return line;
            }

            createHookLandingSplash(left, top, lake) {
                const landingSplash = document.createElement('div');
                landingSplash.className = 'hook-landing-splash';
                
                // Parse left position (could be "123px" or a number)
                const leftValue = typeof left === 'string' ? parseFloat(left) : left;
                landingSplash.style.left = leftValue + 'px';
                landingSplash.style.top = top + 'px';
                
                // Add third splash wave element
                const splashWave = document.createElement('div');
                splashWave.className = 'splash-wave';
                landingSplash.appendChild(splashWave);
                
                // Add to lake
                lake.appendChild(landingSplash);
                
                // Remove after animation completes
                setTimeout(() => {
                    if (landingSplash.parentNode) {
                        landingSplash.remove();
                    }
                }, 1500);
            }

            calculateCatchChance() {
                // During tournaments, everyone has equal chance (level playing field)
                if (this.tournament && this.tournament.phase === 'active') {
                    // Equal base chance for all players regardless of equipment/stats
                    return 0.7; // 70% base chance, same for everyone
                }
                
                // Normal fishing uses player equipment and stats
                let chance = 0.8; // 80% base chance for easier progression
                
                const location = this.locations[this.currentLocation];
                
                // Progressive difficulty based on location difficulty
                // Harder locations are harder to catch at, but have better fish
                if (location.difficulty === 'Easy') {
                    chance += 0.05; // Easy locations: +5% catch rate
                } else if (location.difficulty === 'Medium') {
                    chance -= 0.05; // Medium locations: -5% catch rate
                } else if (location.difficulty === 'Hard') {
                    chance -= 0.15; // Hard locations: -15% catch rate
                } else if (location.difficulty === 'Expert') {
                    chance -= 0.25; // Expert locations: -25% catch rate (makes it challenging!)
                }
                
                // Add tackle bonuses - BETTER gear significantly improves your chances
                // Check both plural and singular keys for compatibility
                const rodName = this.player.gear?.rods || this.player.gear?.rod;
                const reelName = this.player.gear?.reels || this.player.gear?.reel;
                const lineName = this.player.gear?.lines || this.player.gear?.line;
                const hookName = this.player.gear?.hooks || this.player.gear?.hook;
                const baitName = this.player.gear?.baits || this.player.gear?.bait;
                
                const rod = rodName ? this.tackle.rods.find(r => r.name === rodName) : null;
                const reel = reelName ? this.tackle.reels.find(r => r.name === reelName) : null;
                const line = lineName ? this.tackle.lines.find(l => l.name === lineName) : null;
                const hook = hookName ? this.tackle.hooks.find(h => h.name === hookName) : null;
                const bait = baitName ? this.tackle.baits.find(b => b.name === baitName) : null;
                
                if (rod) chance += rod.catchBonus / 80; // Better rods significantly help
                if (reel) chance += reel.speedBonus / 150; // Reels help a bit
                if (line) chance += line.strength / 800; // Lines help slightly
                if (hook) chance += hook.catchBonus / 80; // Better hooks significantly help
                if (bait) chance += bait.catchBonus / 80; // Better bait significantly helps
                
                // Add player stats bonuses
                const accuracyBonus = (this.player.stats.accuracy - 50) * 0.0015; // Accuracy matters more
                const luckBonus = (this.player.stats.luck - 50) * 0.002; // Luck helps
                const patienceBonus = (this.player.stats.patience - 50) * 0.0008; // Patience helps
                const strengthBonus = (this.player.stats.strength - 50) * 0.001; // Strength helps
                
                chance += accuracyBonus + luckBonus + patienceBonus + strengthBonus;
                
                // Add level bonus - higher level helps, but equipment matters more
                chance += (this.player.level - 1) * 0.015;
                
                return Math.min(0.92, Math.max(0.15, chance)); // Cap between 15% and 92%
            }

            reelIn(catchChance) {
                this.isCasting = false;
                this.playSound('reel'); // Reeling sound
                
                // Animate reeling in with smooth animation
                const lake = document.getElementById('fishing-lake');
                const mobileLake = document.getElementById('mobile-fishing-lake');
                
                // Detect if we're on mobile by checking screen width
                const isMobile = window.innerWidth <= 768;
                const activeLake = isMobile ? mobileLake : lake;
                
                if (!activeLake) return;
                
                // Only remove lines for the current player (playerIndex 0)
                const lines = activeLake.querySelectorAll('.fishing-line');
                lines.forEach(line => {
                    // Only process lines that belong to the current player (playerIndex 0)
                    if (line.dataset.playerIndex === '0') {
                        // Store original height for animation
                        const originalHeight = line.offsetHeight;
                        line.style.setProperty('--original-height', originalHeight + 'px');
                        
                        // Ensure height is set for animation
                        line.style.height = originalHeight + 'px';
                        
                        // Add reel animation that shrinks height upward (transform-origin top)
                        line.style.animation = 'reelIn 0.8s ease-out forwards';
                        line.style.transformOrigin = 'top center';
                        
                        // Remove associated splash
                        const splashId = line.dataset.splashId;
                        if (splashId) {
                            const splash = document.getElementById(splashId);
                            if (splash) {
                                splash.style.animation = 'reelIn 0.8s ease-out forwards';
                                setTimeout(() => splash.remove(), 800);
                            }
                        }
                        
                        // Remove line after animation
                        setTimeout(() => line.remove(), 800);
                    }
                });
                
                // Clean up splashes associated with current player's line
                // Splashes are removed by their associated line above, but clean up any orphaned ones
                const currentPlayerSplash = activeLake.querySelector(`#splash-0, [data-splash-for="0"]`);
                if (currentPlayerSplash) {
                    currentPlayerSplash.style.animation = 'reelIn 0.8s ease-out forwards';
                    setTimeout(() => currentPlayerSplash.remove(), 800);
                }
                
                const ripples = document.getElementById('ripples');
                const mobileRipples = document.getElementById('mobile-ripples');
                if (ripples) ripples.classList.remove('active');
                if (mobileRipples) mobileRipples.classList.remove('active');
                
                const castBtn = document.getElementById('cast-btn');
                const mobileCastBtn = document.getElementById('mobile-cast-btn');
                
                if (castBtn) {
                    castBtn.textContent = 'CAST LINE';
                    castBtn.classList.remove('casting');
                    castBtn.disabled = false;
                }
                
                if (mobileCastBtn) {
                    mobileCastBtn.textContent = 'CAST LINE';
                    mobileCastBtn.classList.remove('casting');
                    mobileCastBtn.disabled = false;
                }

                const caughtFish = Math.random() < catchChance;
                
                // Delay catch/no-catch message slightly to sync with animation
                setTimeout(() => {
                    if (caughtFish) {
                        this.catchRandomFish();
                    } else {
                        // Show humorous "no catch" messages
                        const noCatchMessages = [
                            "That fish was too quick for your paws! üêæ",
                            "The fish saw you coming and said 'NOPE!' üòπ",
                            "Just a nibble... your whiskers need more practice!",
                            "Fish are gossiping about your casting technique! üò∏",
                            "They're doing cat yoga down there! üßò‚Äç‚ôÄÔ∏è",
                            "Fish are on their meow-ning break! ‚òï",
                            "A ghost fish stole your bait and laughed! üëªüòπ",
                            "Fish are watching cat videos... but not yours! üì∫",
                            "They swam away purring at your attempt!",
                            "Your bait was too fancy for fish who prefer cat food! üêü",
                            "Fish are playing hide and seek... you're 'it'!",
                            "Maybe try a different spot, furriend?",
                            "That fish said 'meow-bee next time!' üò∏",
                            "Fish are having a catnip party without you! üéâüåø",
                            "Just a friendly turtle saying 'meow-lo!' üê¢",
                            "The fish are playing tag... and you're still it!",
                            "Your hook came back empty... like a cat's food bowl at 3am!",
                            "Fish saw your cat avatar and got jealous! üòº",
                            "They're busy practicing their fin-ishing moves!",
                            "Fish are playing poker... and winning! üÉè",
                            "Your bait was too spicy for their delicate palates! üå∂Ô∏è",
                            "Fish are on vacation... to avoid cats! üèñÔ∏è",
                            "They're writing their memoirs... 'My Life as Cat Bait' üìù",
                            "Fish are doing karaoke... 'Don't Stop Belly-in!' üé§",
                            "Just a crab waving hello with claws! ü¶Ä",
                            "Fish are practicing social distancing... from cats!",
                            "They're having a business meeting... about avoiding cats! üíº",
                            "Fish are doing homework... 'How to Avoid Being Caught 101' üìö",
                            "That fish escaped faster than you run from the vacuum! üèÉ",
                            "Your purr-suasion skills need work! üò∏"
                        ];
                        const randomMessage = noCatchMessages[Math.floor(Math.random() * noCatchMessages.length)];
                        this.showMessage(randomMessage, '#ffff00');
                    }
                }, 400);
            }

            catchRandomFish() {
                const location = this.locations[this.currentLocation];
                const availableFish = location.fish;
                
                // Progressive fish selection based on level and equipment
                // Higher level locations have better fish, but you need better gear to catch them
                let selectedFishIndex;
                
                // Determine difficulty modifier based on location difficulty
                let difficultyModifier = 0;
                if (location.difficulty === 'Easy') difficultyModifier = 0;
                else if (location.difficulty === 'Medium') difficultyModifier = 1;
                else if (location.difficulty === 'Hard') difficultyModifier = 2;
                else if (location.difficulty === 'Expert') difficultyModifier = 3;
                
                // Calculate player's fishing power based on equipment and level
                const rod = this.tackle.rods.find(r => r.name === this.player.gear.rod);
                const reel = this.tackle.reels.find(r => r.name === this.player.gear.reel);
                const hook = this.tackle.hooks.find(h => h.name === this.player.gear.hook);
                const bait = this.tackle.baits.find(b => b.name === this.player.gear.bait);
                
                let fishingPower = 0;
                if (rod) fishingPower += rod.catchBonus;
                if (reel) fishingPower += reel.speedBonus;
                if (hook) fishingPower += hook.catchBonus;
                if (bait) fishingPower += bait.catchBonus;
                fishingPower += this.player.level * 5; // Level adds to fishing power
                
                // Calculate chance to catch better fish
                // Higher difficulty locations have rare/epic/legendary fish at the end of the array
                const maxFishIndex = availableFish.length - 1;
                const chanceForBestFish = Math.min(0.3, fishingPower / 200); // Up to 30% chance for best fish
                
                if (Math.random() < chanceForBestFish) {
                    // Player catches one of the better fish from this location
                    const topTierRange = Math.ceil(availableFish.length * 0.3); // Top 30% of fish
                    const startIndex = Math.max(0, maxFishIndex - topTierRange);
                    const rangeSize = maxFishIndex - startIndex + 1;
                    selectedFishIndex = startIndex + Math.floor(Math.random() * rangeSize);
                } else {
                    // Standard fish selection with slight weighting toward better fish
                    const roll = Math.random();
                    if (roll < 0.5) {
                        // 50% chance for bottom 40% of fish
                        const bottomEnd = Math.max(1, Math.ceil(availableFish.length * 0.4));
                        selectedFishIndex = Math.floor(Math.random() * bottomEnd);
                    } else if (roll < 0.85) {
                        // 35% chance for middle 40% of fish
                        const midStart = Math.ceil(availableFish.length * 0.4);
                        const midEnd = Math.min(availableFish.length, Math.ceil(availableFish.length * 0.8));
                        const rangeSize = Math.max(1, midEnd - midStart);
                        selectedFishIndex = midStart + Math.floor(Math.random() * rangeSize);
                    } else {
                        // 15% chance for top 20% of fish
                        const topStart = Math.min(maxFishIndex, Math.ceil(availableFish.length * 0.8));
                        const rangeSize = maxFishIndex - topStart + 1;
                        selectedFishIndex = topStart + Math.floor(Math.random() * rangeSize);
                    }
                }
                
                // Ensure selectedFishIndex is within bounds
                selectedFishIndex = Math.max(0, Math.min(selectedFishIndex, maxFishIndex));
                if (selectedFishIndex < 0 || selectedFishIndex >= availableFish.length) {
                    console.error('Invalid fish index:', selectedFishIndex, 'Available fish:', availableFish.length);
                    selectedFishIndex = 0; // Use first fish as fallback
                }
                
                const randomFishType = availableFish[selectedFishIndex];
                const fishData = this.fishTypes[randomFishType];
                
                // Safety check: if fishData is undefined, use a default fish
                if (!fishData || !randomFishType) {
                    console.error('Invalid fish type selected:', randomFishType, 'Available:', availableFish);
                    // Use first available fish as fallback
                    const fallbackFish = availableFish[0];
                    const fallbackData = this.fishTypes[fallbackFish];
                    if (!fallbackData) {
                        console.error('No valid fish data found!');
                        return;
                    }
                    // Use fallback fish
                    const defaultWeight = fallbackData.minWeight + Math.random() * (fallbackData.maxWeight - fallbackData.minWeight);
                    const defaultValue = Math.floor(fallbackData.value * (1 + defaultWeight / fallbackData.maxWeight));
                    const defaultExp = Math.floor(fallbackData.experience * (1 + defaultWeight / fallbackData.maxWeight));
                    
                    this.addChatMessage('you', `Caught a ${fallbackData.name} (${defaultWeight.toFixed(1)} lbs)!`);
                    this.player.totalCaught++;
                    this.player.totalWeight += defaultWeight;
                    if (defaultWeight > this.player.biggestCatch) {
                        this.player.biggestCatch = defaultWeight;
                    }
                    this.player.money += defaultValue;
                    this.player.experience += defaultExp;
                    this.updateDisplay();
                    return;
                }

                // During tournaments, fish can be MUCH bigger (up to 3x max weight)
                let weight;
                if (this.tournament && this.tournament.phase === 'active') {
                    // Tournament mode: fish can be 1x to 3x their normal max weight
                    const baseWeight = fishData.minWeight + Math.random() * (fishData.maxWeight - fishData.minWeight);
                    const tournamentMultiplier = 1.0 + Math.random() * 2.0; // 1.0x to 3.0x
                    weight = baseWeight * tournamentMultiplier;
                } else {
                    // Normal fishing: standard weight range
                    weight = fishData.minWeight + Math.random() * (fishData.maxWeight - fishData.minWeight);
                }
                
                const value = Math.floor(fishData.value * (1 + weight / fishData.maxWeight));
                const experience = Math.floor(fishData.experience * (1 + weight / fishData.maxWeight));

                // Record the catch
                const catchData = {
                    fish: fishData,
                    weight: weight,
                    value: value,
                    experience: experience,
                    location: location.name,
                    timestamp: Date.now()
                };
                
                this.player.recentCatches.push(catchData);
                
                // Keep only last 50 catches to prevent memory issues
                if (this.player.recentCatches.length > 50) {
                    this.player.recentCatches = this.player.recentCatches.slice(-50);
                }

                // Update player stats
                this.player.money += value;
                this.player.experience += experience;
                this.player.totalCaught++;
                this.player.totalWeight += weight;

                // Update biggest catch (only for normal fishing, not tournaments)
                if ((!this.tournament || this.tournament.phase !== 'active') && weight > this.player.biggestCatch) {
                    this.player.biggestCatch = weight;
                }

                // Update top 10 biggest fish (only goes up, never down)
                // BUT: Tournament catches don't count toward normal leaderboards
                if (!this.tournament || this.tournament.phase !== 'active') {
                    this.updateTop10BiggestFish(catchData);
                }

                // Determine if this is a special catch
                const isRare = fishData.rarity === 'Rare' || fishData.rarity === 'Epic' || fishData.rarity === 'Legendary' || fishData.rarity === 'Trophy';
                const isHuge = weight > fishData.maxWeight * 0.8; // 80% of max weight
                const isLegendary = fishData.rarity === 'Legendary';
                const isTrophy = fishData.rarity === 'Trophy';
                
                // Play appropriate sound
                if (isLegendary || isTrophy) {
                    this.playSound('levelUp'); // Special celebration sound
                } else if (isRare || isHuge) {
                    this.playSound('bigCatch'); // Big fish sound
                } else {
                    this.playSound('catch'); // Regular fish sound
                }

                // Check for level up
                this.checkLevelUp();

                // Update leaderboard
                this.updateLeaderboard();

                // Show visual catch animation
                this.showCatchAnimation(fishData.name, weight);

                // Show catch message with rarity color
                let messageColor = '#00ff00'; // Default green
                let messageText = `Caught ${fishData.name}! ${weight.toFixed(1)}lbs, +$${value}`;
                
                // Special handling for tournament fish
                if (this.tournament && this.tournament.phase === 'active') {
                    const normalMax = fishData.maxWeight;
                    if (weight > normalMax * 1.5) {
                        messageColor = '#ff00ff'; // Magenta for MEGA tournament fish
                        messageText = `üé£ TOURNAMENT MEGA CATCH! ${fishData.name}! ${weight.toFixed(1)}lbs (${(weight/normalMax).toFixed(1)}x normal size!), +$${value}`;
                    } else if (weight > normalMax) {
                        messageColor = '#ffff00'; // Yellow for oversized tournament fish
                        messageText = `üé£ TOURNAMENT BIG CATCH! ${fishData.name}! ${weight.toFixed(1)}lbs, +$${value}`;
                    }
                } else {
                    // Normal fishing colors
                    if (isLegendary || isTrophy) messageColor = '#ff00ff'; // Magenta
                    else if (isRare) messageColor = '#00ffff'; // Cyan
                    else if (isHuge) messageColor = '#ffff00'; // Yellow
                }
                
                this.showMessage(messageText, messageColor);
                
                // Show special banner for rare/legendary fish
                if (isRare || isHuge) {
                    this.showRareFishBanner(fishData, weight, value, isLegendary, isTrophy);
                }
                
                // Update tournament scores if in tournament
                if (this.tournament && this.tournament.phase === 'active') {
                    if (this.tournament.scores[this.player.name]) {
                        this.tournament.scores[this.player.name].totalWeight += weight;
                        this.tournament.scores[this.player.name].fishCount++;
                        if (weight > this.tournament.scores[this.player.name].biggestCatch) {
                            this.tournament.scores[this.player.name].biggestCatch = weight;
                        }
                        // Store the catch for tournament results
                        if (this.tournament.catches[this.player.name]) {
                            this.tournament.catches[this.player.name].push({
                                fish: fishData.name,
                                weight: weight,
                                value: value,
                                timestamp: Date.now()
                            });
                        }
                        // Update tournament display to show new stats
                        this.updateTournamentDisplay();
                    }
                }

                // Notify other players with special announcement for rare fish
                this.broadcastCatch(fishData, weight, value, isRare, isHuge, isLegendary, isTrophy);

                // Update mobile inventory
                const mobileRecentCatches = document.getElementById('mobile-recent-catches');
                if (mobileRecentCatches) {
                    this.renderRecentCatches(mobileRecentCatches);
                }

                this.updateDisplay();
                this.saveGameData(); // Auto-save after catching fish
            }

            checkLevelUp() {
                const expNeeded = this.player.level * 100;
                if (this.player.experience >= expNeeded) {
                    this.player.level++;
                    this.player.experience -= expNeeded;
                    
                    // Improve stats on level up
                    const statBonuses = this.improveStats();
                    
                    this.showMessage(`Level Up! Now level ${this.player.level}! ${statBonuses}`, '#ffff00');
                    this.addChatMessage('system', `${this.player.name} reached level ${this.player.level}!`);
                    this.playSound('levelUp'); // Level up celebration sound
                    
                    // Check for new location unlocks
                    this.checkLocationUnlocks();
                    
                    // Check for new tackle unlocks
                    this.checkTackleUnlocks();
                    
                    // Check for achievements
                    this.checkAchievements();
                }
            }

            improveStats() {
                const bonuses = [];
                const level = this.player.level;
                
                // Every level: +1 to all stats
                this.player.stats.accuracy = Math.min(100, this.player.stats.accuracy + 1);
                this.player.stats.luck = Math.min(100, this.player.stats.luck + 1);
                this.player.stats.patience = Math.min(100, this.player.stats.patience + 1);
                this.player.stats.strength = Math.min(100, this.player.stats.strength + 1);
                bonuses.push('+1 All Stats');
                
                // Every 2 levels: +2 Accuracy
                if (level % 2 === 0) {
                    this.player.stats.accuracy = Math.min(100, this.player.stats.accuracy + 2);
                    bonuses.push('+2 Accuracy');
                }
                
                // Every 3 levels: +3 Luck
                if (level % 3 === 0) {
                    this.player.stats.luck = Math.min(100, this.player.stats.luck + 3);
                    bonuses.push('+3 Luck');
                }
                
                // Every 4 levels: +2 Patience
                if (level % 4 === 0) {
                    this.player.stats.patience = Math.min(100, this.player.stats.patience + 2);
                    bonuses.push('+2 Patience');
                }
                
                // Every 5 levels: +4 Strength
                if (level % 5 === 0) {
                    this.player.stats.strength = Math.min(100, this.player.stats.strength + 4);
                    bonuses.push('+4 Strength');
                }
                
                return bonuses.join(', ');
            }

            checkAchievements() {
                const achievements = [
                    {
                        id: 'first_catch',
                        name: 'üê± Purr-novice Angler',
                        description: 'Catch your first fish',
                        condition: () => this.player.totalCaught >= 1,
                        unlocked: this.player.achievements.includes('first_catch')
                    },
                    {
                        id: 'big_fish',
                        name: 'üêü Big Fish Hunter',
                        description: 'Catch a fish over 10 lbs',
                        condition: () => this.player.biggestCatch >= 10,
                        unlocked: this.player.achievements.includes('big_fish')
                    },
                    {
                        id: 'level_5',
                        name: '‚≠ê Rising Purr-star',
                        description: 'Reach level 5',
                        condition: () => this.player.level >= 5,
                        unlocked: this.player.achievements.includes('level_5')
                    },
                    {
                        id: 'level_10',
                        name: 'üåü Expert Purr-angler',
                        description: 'Reach level 10',
                        condition: () => this.player.level >= 10,
                        unlocked: this.player.achievements.includes('level_10')
                    },
                    {
                        id: 'money_maker',
                        name: 'üí∞ Purr-rize Winner',
                        description: 'Earn $1000',
                        condition: () => this.player.money >= 1000,
                        unlocked: this.player.achievements.includes('money_maker')
                    },
                    {
                        id: 'fish_master',
                        name: 'üê† Fish Meow-ster',
                        description: 'Catch 100 fish',
                        condition: () => this.player.totalCaught >= 100,
                        unlocked: this.player.achievements.includes('fish_master')
                    },
                    {
                        id: 'tournament_champ',
                        name: 'üèÜ Tournament Champ-purr',
                        description: 'Win a tournament',
                        condition: () => this.player.tournamentStats && this.player.tournamentStats.wins > 0,
                        unlocked: this.player.achievements.includes('tournament_champ')
                    },
                    {
                        id: 'gear_collector',
                        name: 'üéí Tackle Collector',
                        description: 'Own 10 pieces of tackle',
                        condition: () => {
                            let count = 0;
                            Object.values(this.player.tackleUnlocks).forEach(arr => count += arr.length);
                            return count >= 10;
                        },
                        unlocked: this.player.achievements.includes('gear_collector')
                    },
                    {
                        id: 'location_explorer',
                        name: 'üó∫Ô∏è Creek Explorer',
                        description: 'Unlock all locations',
                        condition: () => this.player.locationUnlocks.length >= this.locations.length,
                        unlocked: this.player.achievements.includes('location_explorer')
                    },
                    {
                        id: 'level_20',
                        name: '‚≠ê Meow-ster Angler',
                        description: 'Reach level 20',
                        condition: () => this.player.level >= 20,
                        unlocked: this.player.achievements.includes('level_20')
                    },
                    {
                        id: 'rare_catcher',
                        name: 'üíé Rare Fish Collector',
                        description: 'Catch 20 rare fish',
                        condition: () => {
                            const rareFish = this.player.recentCatches.filter(c => 
                                c.fish.rarity === 'Rare' || c.fish.rarity === 'Epic' || c.fish.rarity === 'Legendary'
                            ).length;
                            return rareFish >= 20;
                        },
                        unlocked: this.player.achievements.includes('rare_catcher')
                    },
                    {
                        id: 'biggest_bag',
                        name: 'üé£ Biggest Fish Bag',
                        description: 'Have a top 10 bag over 50 lbs',
                        condition: () => {
                            const top10Total = this.player.top10BiggestFish.reduce((sum, c) => sum + c.weight, 0);
                            return top10Total >= 50;
                        },
                        unlocked: this.player.achievements.includes('biggest_bag')
                    },
                    {
                        id: 'legendary_catch',
                        name: '‚ú® Legendary Purr-hunter',
                        description: 'Catch a legendary fish',
                        condition: () => {
                            return this.player.recentCatches.some(c => c.fish.rarity === 'Legendary');
                        },
                        unlocked: this.player.achievements.includes('legendary_catch')
                    },
                    {
                        id: 'tournament_legend',
                        name: 'üëë Tournament Legend',
                        description: 'Win 5 tournaments',
                        condition: () => this.player.tournamentStats && this.player.tournamentStats.wins >= 5,
                        unlocked: this.player.achievements.includes('tournament_legend')
                    },
                    {
                        id: 'wealthy_angler',
                        name: 'üíµ Wealthy Angler',
                        description: 'Earn $5000',
                        condition: () => this.player.money >= 5000,
                        unlocked: this.player.achievements.includes('wealthy_angler')
                    }
                ];

                achievements.forEach(achievement => {
                    if (!achievement.unlocked && achievement.condition()) {
                        this.player.achievements.push(achievement.id);
                        this.showMessage(`Achievement Unlocked: ${achievement.name}!`, '#ffd700');
                        this.addChatMessage('system', `${this.player.name} unlocked: ${achievement.name}!`);
                        this.updateAchievementsDisplay();
                    }
                });
            }

            updateAchievementsDisplay() {
                const achievementsContainer = document.getElementById('achievements');
                const mobileAchievementsContainer = document.getElementById('mobile-achievements');
                const achievements = [
                    { id: 'first_catch', name: 'üé£ Novice Angler', description: 'Catch your first fish' },
                    { id: 'big_fish', name: 'üêü Big Fish Hunter', description: 'Catch a fish over 10 lbs' },
                    { id: 'level_5', name: '‚≠ê Rising Star', description: 'Reach level 5' },
                    { id: 'level_10', name: 'üåü Expert Angler', description: 'Reach level 10' },
                    { id: 'money_maker', name: 'üí∞ Money Maker', description: 'Earn $1000' },
                    { id: 'fish_master', name: 'üê† Fish Master', description: 'Catch 100 fish' },
                    { id: 'tournament_champ', name: 'üèÜ Tournament Champion', description: 'Win a tournament' },
                    { id: 'gear_collector', name: 'üéí Gear Collector', description: 'Own 10 pieces of tackle' },
                    { id: 'location_explorer', name: 'üó∫Ô∏è Location Explorer', description: 'Unlock all locations' },
                    { id: 'level_20', name: '‚≠ê Master Angler', description: 'Reach level 20' },
                    { id: 'rare_catcher', name: 'üíé Rare Fish Collector', description: 'Catch 20 rare fish' },
                    { id: 'biggest_bag', name: 'üé£ Biggest Bag', description: 'Have a top 10 bag over 50 lbs' },
                    { id: 'legendary_catch', name: '‚ú® Legendary Hunter', description: 'Catch a legendary fish' },
                    { id: 'tournament_legend', name: 'üëë Tournament Legend', description: 'Win 5 tournaments' },
                    { id: 'wealthy_angler', name: 'üíµ Wealthy Angler', description: 'Earn $5000' }
                ];

                const achievementHTML = achievements.map(achievement => {
                    const unlocked = this.player.achievements.includes(achievement.id);
                    return `<div class="achievement-item ${unlocked ? '' : 'locked'}" title="${achievement.description}">${achievement.name}</div>`;
                }).join('');

                if (achievementsContainer) achievementsContainer.innerHTML = achievementHTML;
                if (mobileAchievementsContainer) mobileAchievementsContainer.innerHTML = achievementHTML;
            }

            checkLocationUnlocks() {
                let newUnlocks = [];
                this.locations.forEach((location, index) => {
                    if (!this.player.locationUnlocks.includes(index) && this.player.level >= location.unlockLevel) {
                        this.player.locationUnlocks.push(index);
                        newUnlocks.push(location.name);
                    }
                });
                
                if (newUnlocks.length > 0) {
                    this.showCongratulationsPopup('location', newUnlocks);
                    this.showMessage(`New locations unlocked: ${newUnlocks.join(', ')}!`, '#00ffff');
                    this.addChatMessage('system', `New locations unlocked: ${newUnlocks.join(', ')}!`);
                    this.updateLocationButtons(); // Refresh dropdown to show unlocked locations
                }
            }

            checkTackleUnlocks() {
                let newUnlocks = [];
                
                // Check rod unlocks
                this.tackle.rods.forEach((rod, index) => {
                    if (!this.player.tackleUnlocks.rods.includes(index) && this.player.level >= rod.unlockLevel) {
                        this.player.tackleUnlocks.rods.push(index);
                        newUnlocks.push(rod.name);
                    }
                });
                
                // Check reel unlocks
                this.tackle.reels.forEach((reel, index) => {
                    if (!this.player.tackleUnlocks.reels.includes(index) && this.player.level >= reel.unlockLevel) {
                        this.player.tackleUnlocks.reels.push(index);
                        newUnlocks.push(reel.name);
                    }
                });
                
                // Check line unlocks
                this.tackle.lines.forEach((line, index) => {
                    if (!this.player.tackleUnlocks.lines.includes(index) && this.player.level >= line.unlockLevel) {
                        this.player.tackleUnlocks.lines.push(index);
                        newUnlocks.push(line.name);
                    }
                });
                
                // Check hook unlocks
                this.tackle.hooks.forEach((hook, index) => {
                    if (!this.player.tackleUnlocks.hooks.includes(index) && this.player.level >= hook.unlockLevel) {
                        this.player.tackleUnlocks.hooks.push(index);
                        newUnlocks.push(hook.name);
                    }
                });
                
                // Check bait unlocks
                this.tackle.baits.forEach((bait, index) => {
                    if (!this.player.tackleUnlocks.baits.includes(index) && this.player.level >= bait.unlockLevel) {
                        this.player.tackleUnlocks.baits.push(index);
                        newUnlocks.push(bait.name);
                    }
                });
                
                if (newUnlocks.length > 0) {
                    this.showCongratulationsPopup('tackle', newUnlocks);
                    this.showMessage(`New tackle unlocked: ${newUnlocks.join(', ')}!`, '#ff00ff');
                    this.addChatMessage('system', `New tackle unlocked: ${newUnlocks.join(', ')}!`);
                }
                
                this.saveGameData(); // Auto-save after unlocking new content
            }

            changeLocation(index) {
                // Convert string to number if needed
                index = parseInt(index);
                
                if (isNaN(index) || index < 0 || index >= this.locations.length) {
                    this.showMessage('Invalid location!', '#ff0000');
                    return;
                }
                
                const location = this.locations[index];
                
                // Check if location is unlocked
                if (!this.player.locationUnlocks.includes(index)) {
                    this.showMessage(`Location locked! Reach level ${location.unlockLevel} to unlock.`, '#ff0000');
                    return;
                }
                
                if (this.player.money < location.cost) {
                    this.showMessage('Not enough money!', '#ff0000');
                    return;
                }

                this.currentLocation = index;
                this.player.money -= location.cost;
                
                // Update location buttons
                document.querySelectorAll('.location-btn').forEach((btn, i) => {
                    btn.classList.toggle('active', i === index);
                });

                this.updateDisplay();
                this.addChatMessage('system', `${this.player.name} moved to ${location.name}`);
                this.saveGameData(); // Auto-save after changing location
            }

            simulateMultiplayer() {
                // Simulate other players with unique AI names
                const aiNames = ['Tommy the Stray', 'Sly Sylvester', 'Felix the Feline', 'Whiskers McFluff', 'Captain Claw', 'Mittens the Master', 'Purr-fect Pete', 'Tabby the Tank'];
                
                // Add 3-6 random AI players (all cats!)
                const numPlayers = Math.floor(Math.random() * 4) + 3;
                for (let i = 0; i < numPlayers; i++) {
                    // Generate unique cat avatar for each AI player
                    const catSeed = `cat-ai-${aiNames[i]}-${i}`;
                    const catAvatar = `https://robohash.org/${catSeed}?set=set4&size=200x200`;
                    
                    this.otherPlayers.push({
                        name: aiNames[i], // Use unique AI names
                        level: Math.floor(Math.random() * 10) + 1,
                        fishing: false,
                        catches: Math.floor(Math.random() * 50),
                        isCasting: false,
                        biggestCatch: Math.random() * 15, // Random biggest catch 0-15 lbs
                        recentCatches: this.generateSimulatedCatches(Math.floor(Math.random() * 20) + 5), // 5-25 catches
                        isSimulated: true, // Mark as AI player
                        character: catAvatar // Assign cat avatar
                    });
                }

                // Simulate other players fishing (only AI players) - staggered timing
                // Start each AI player with a random delay to stagger their actions
                this.otherPlayers.forEach((player, index) => {
                    if (player.isSimulated) {
                        // Each AI player starts fishing at a different time
                        const initialDelay = index * 1000 + Math.random() * 2000; // Stagger: 1-3s apart per player
                        setTimeout(() => {
                            // Start the first cast for this AI player
                            if (Math.random() < 0.5) {
                                this.simulateOtherPlayerFishing(index);
                            }
                        }, initialDelay);
                    }
                });
                
                // Continuous simulation with random intervals
                setInterval(() => {
                    this.otherPlayers.forEach((player, index) => {
                        // Only simulate AI players, not real players
                        if (player.isSimulated && !player.isCasting && Math.random() < 0.15) {
                            // Random delay before casting (0-3 seconds)
                            const castDelay = Math.random() * 3000;
                            setTimeout(() => {
                                if (this.otherPlayers[index] && !this.otherPlayers[index].isCasting) {
                                    this.simulateOtherPlayerFishing(index);
                                }
                            }, castDelay);
                        }
                    });
                }, 4000 + Math.random() * 4000); // Check every 4-8 seconds

                // Update leaderboard periodically
                setInterval(() => {
                    this.updateLeaderboard();
                }, 5000); // Update every 5 seconds

                // Simulate other players catching fish
                setInterval(() => {
                    if (Math.random() < 0.2) {
                        const randomPlayer = this.otherPlayers[Math.floor(Math.random() * this.otherPlayers.length)];
                        const fishTypes = Object.keys(this.fishTypes);
                        const randomFish = fishTypes[Math.floor(Math.random() * fishTypes.length)];
                        const fishData = this.fishTypes[randomFish];
                        
                        // Add humor based on the cat's personality
                        const exclamations = ['üê± Meow!', 'üé£ Purrfect!', 'üò∏ Nice one!', 'üêü Fishy!', 'üí™ Get it!'];
                        const exclamation = exclamations[Math.floor(Math.random() * exclamations.length)];
                        this.addChatMessage('other', `${randomPlayer.name} caught a ${fishData.name}! ${exclamation}`);
                    }
                }, 5000 + Math.random() * 10000);

                this.updateOnlinePlayers();
            }

            simulateOtherPlayerFishing(playerIndex) {
                const player = this.otherPlayers[playerIndex];
                player.isCasting = true;
                player.fishing = true;
                
                // Add fishing line for this player
                this.addFishingLine(playerIndex + 1, true);
                
                // Update fisherman visual
                const fishermen = document.querySelectorAll('.fisherman');
                if (fishermen[playerIndex + 1]) {
                    fishermen[playerIndex + 1].classList.add('fishing');
                }
                
                // Simulate fishing duration - randomized between 2-5 seconds
                const fishingDuration = 2000 + Math.random() * 3000;
                setTimeout(() => {
                    if (!this.otherPlayers[playerIndex]) return; // Player might have left
                    
                    player.isCasting = false;
                    player.fishing = false;
                    
                    // Remove fishing line and splash - use player name for reliable removal
                    const lake = document.getElementById('fishing-lake');
                    const mobileLake = document.getElementById('mobile-fishing-lake');
                    const activeLake = window.innerWidth <= 768 ? mobileLake : lake;
                    
                    if (activeLake) {
                        const lines = activeLake.querySelectorAll('.fishing-line');
                        lines.forEach(line => {
                            // Match by player index or name
                            if (line.dataset.playerIndex == (playerIndex + 1).toString() || 
                                line.dataset.playerName === player.name) {
                                // Remove associated splash
                                const splashId = line.dataset.splashId;
                                if (splashId) {
                                    const splash = document.getElementById(splashId);
                                    if (splash) splash.remove();
                                }
                                line.remove();
                            }
                        });
                        
                        // Clean up any remaining splashes
                        const splashes = activeLake.querySelectorAll('.hook-splash');
                        splashes.forEach(splash => splash.remove());
                    }
                    
                    // Update fisherman visual
                    const fishermen = document.querySelectorAll('.fisherman, .mobile-fisherman');
                    if (fishermen[playerIndex + 1]) {
                        fishermen[playerIndex + 1].classList.remove('fishing');
                    }
                    
                    // Random chance to catch fish
                    if (Math.random() < 0.6) {
                        const randomFishType = Math.floor(Math.random() * this.fishTypes.length);
                        const fishData = this.fishTypes[randomFishType];
                        
                        const weight = fishData.minWeight + Math.random() * (fishData.maxWeight - fishData.minWeight);
                        const value = Math.floor(fishData.value * (1 + weight / fishData.maxWeight));
                        
                        // Add catch to player's recent catches
                        const catchData = {
                            fish: fishData,
                            weight: weight,
                            value: value,
                            experience: Math.floor(fishData.experience * (1 + weight / fishData.maxWeight)),
                            location: this.locations[Math.floor(Math.random() * this.locations.length)].name,
                            timestamp: Date.now()
                        };
                        
                        player.recentCatches.push(catchData);
                        
                        // Keep only last 50 catches
                        if (player.recentCatches.length > 50) {
                            player.recentCatches = player.recentCatches.slice(-50);
                        }
                        
                        // Update biggest catch
                        if (weight > player.biggestCatch) {
                            player.biggestCatch = weight;
                        }
                        
                        // Only show chat message for simulated (AI) players, not real players
                        if (player.isSimulated) {
                            // Add funny reactions for bot cats
                            const reactions = ['üê± Meow!', 'üé£ Purrfect catch!', 'üò∏ Look at that!', 'üêü Fishy business!', 'üí™ Pawsome!'];
                            const reaction = reactions[Math.floor(Math.random() * reactions.length)];
                            this.addChatMessage('other', `${player.name} caught a ${fishData.name} (${weight.toFixed(1)} lbs)! ${reaction}`);
                        }
                    }
                }, 2000 + Math.random() * 3000);
            }

            updateOnlinePlayers() {
                const container = document.getElementById('online-players');
                container.innerHTML = '';
                
                // Add current player
                const playerItem = document.createElement('div');
                playerItem.className = 'player-item';
                playerItem.innerHTML = `${this.player.name} (You) - Level ${this.player.level}`;
                container.appendChild(playerItem);

                // Add other players
                this.otherPlayers.forEach(player => {
                    const item = document.createElement('div');
                    item.className = `player-item ${player.fishing ? 'fishing' : ''}`;
                    item.innerHTML = `${player.name} - Level ${player.level} ${player.fishing ? '(Fishing)' : ''}`;
                    container.appendChild(item);
                });
            }

            broadcastCatch(fishData, weight, value, isRare = false, isHuge = false, isLegendary = false, isTrophy = false) {
                const fishName = fishData.name;
                const rarity = fishData.rarity;
                const isNotable = isRare || isHuge || isLegendary || isTrophy;
                
                // Only broadcast notable catches (rare, huge, legendary, trophy) or tournament catches
                // Regular catches outside tournaments are kept private to reduce chat spam
                if (this.socket && this.connected && (isNotable || (this.tournament && this.tournament.active))) {
                    this.socket.emit('catch-fish', {
                        fish: fishData,
                        weight: weight,
                        value: value,
                        isRare: isRare,
                        isHuge: isHuge,
                        isLegendary: isLegendary,
                        isTrophy: isTrophy,
                        tournamentId: this.tournament && this.tournament.active ? this.tournament.tournamentId : null
                    });
                }
                
                // Always show personal notification for your own catches
                // Create special announcement for rare fish
                if (isLegendary || isTrophy) {
                    this.addChatMessage('legendary', `üèÜ LEGENDARY CATCH! ${this.player.name} caught a ${fishName}! ${weight.toFixed(1)}lbs, +$${value} üèÜ`);
                    this.showGlobalAnnouncement(`üèÜ LEGENDARY CATCH! ${this.player.name} caught a ${fishName}! ${weight.toFixed(1)}lbs üèÜ`, '#ff00ff');
                } else if (isRare) {
                    this.addChatMessage('rare', `üíé RARE CATCH! ${this.player.name} caught a ${fishName}! ${weight.toFixed(1)}lbs, +$${value} üíé`);
                    this.showGlobalAnnouncement(`üíé RARE CATCH! ${this.player.name} caught a ${fishName}! ${weight.toFixed(1)}lbs üíé`, '#00ffff');
                } else if (isHuge) {
                    this.addChatMessage('huge', `üêü HUGE FISH! ${this.player.name} caught a massive ${fishName}! ${weight.toFixed(1)}lbs, +$${value} üêü`);
                    this.showGlobalAnnouncement(`üêü HUGE FISH! ${this.player.name} caught a massive ${fishName}! ${weight.toFixed(1)}lbs üêü`, '#ffff00');
                } else {
                    // Regular catch - only show personal message, not broadcast to others
                    this.addChatMessage('own', `You caught a ${fishName}! ${weight.toFixed(1)}lbs, +$${value}`);
                }
            }

            showRareFishBanner(fishData, weight, value, isLegendary, isTrophy) {
                const banner = document.createElement('div');
                banner.className = 'rare-fish-banner';
                
                let bannerClass = 'rare';
                let icon = 'üíé';
                let title = 'RARE CATCH!';
                
                if (isLegendary) {
                    bannerClass = 'legendary';
                    icon = 'üèÜ';
                    title = 'LEGENDARY CATCH!';
                } else if (isTrophy) {
                    bannerClass = 'trophy';
                    icon = 'üèÖ';
                    title = 'TROPHY CATCH!';
                }
                
                banner.innerHTML = `
                    <div class="banner-content ${bannerClass}">
                        <div class="banner-icon">${icon}</div>
                        <div class="banner-text">
                            <h2>${title}</h2>
                            <p>${fishData.name} - ${weight.toFixed(1)}lbs</p>
                            <p>+$${value} | ${fishData.rarity}</p>
                        </div>
                        <div class="banner-icon">${icon}</div>
                    </div>
                `;
                
                // Add CSS for the banner
                const style = document.createElement('style');
                style.textContent = `
                    .rare-fish-banner {
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        z-index: 10001;
                        animation: bannerSlideIn 0.8s ease-out;
                    }
                    
                    .banner-content {
                        background: linear-gradient(135deg, #001100, #003300);
                        border: 4px solid;
                        border-radius: 20px;
                        padding: 30px 50px;
                        text-align: center;
                        box-shadow: 0 0 40px;
                        display: flex;
                        align-items: center;
                        gap: 20px;
                        min-width: 400px;
                    }
                    
                    .banner-content.legendary {
                        border-color: #ff00ff;
                        box-shadow: 0 0 40px rgba(255, 0, 255, 0.8);
                    }
                    
                    .banner-content.rare {
                        border-color: #64b5f6;
                        box-shadow: 0 0 40px rgba(0, 255, 255, 0.8);
                    }
                    
                    .banner-content.trophy {
                        border-color: #ffff00;
                        box-shadow: 0 0 40px rgba(255, 255, 0, 0.8);
                    }
                    
                    .banner-icon {
                        font-size: 48px;
                        animation: bounce 1s infinite;
                    }
                    
                    .banner-text h2 {
                        margin: 0 0 10px 0;
                        font-size: 28px;
                        text-shadow: 0 0 10px;
                    }
                    
                    .banner-text p {
                        margin: 5px 0;
                        font-size: 18px;
                    }
                    
                    .banner-content.legendary h2 {
                        color: #ff00ff;
                    }
                    
                    .banner-content.rare h2 {
                        color: #64b5f6;
                    }
                    
                    .banner-content.trophy h2 {
                        color: #ffff00;
                    }
                    
                    @keyframes bannerSlideIn {
                        from { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
                        to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                    }
                    
                    @keyframes bounce {
                        0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
                        40% { transform: translateY(-10px); }
                        60% { transform: translateY(-5px); }
                    }
                `;
                
                document.head.appendChild(style);
                document.body.appendChild(banner);
                
                // Auto-remove after 5 seconds
                setTimeout(() => {
                    if (banner.parentElement) {
                        banner.style.animation = 'bannerSlideIn 0.5s ease-in reverse';
                        setTimeout(() => {
                            banner.remove();
                            style.remove();
                        }, 500);
                    }
                }, 5000);
            }

            showGlobalAnnouncement(message, color) {
                const announcement = document.createElement('div');
                announcement.className = 'global-announcement';
                announcement.innerHTML = `
                    <div class="announcement-content" style="color: ${color}; border-color: ${color}; box-shadow: 0 0 20px ${color}40;">
                        ${message}
                    </div>
                `;
                
                // Add CSS for the announcement
                const style = document.createElement('style');
                style.textContent = `
                    .global-announcement {
                        position: fixed;
                        top: 20px;
                        left: 50%;
                        transform: translateX(-50%);
                        z-index: 10000;
                        animation: announcementSlideDown 0.6s ease-out;
                    }
                    
                    .announcement-content {
                        background: linear-gradient(135deg, #001100, #003300);
                        border: 3px solid;
                        border-radius: 10px;
                        padding: 15px 30px;
                        text-align: center;
                        font-size: 18px;
                        font-weight: bold;
                        text-shadow: 0 0 10px;
                        max-width: 90vw;
                        word-wrap: break-word;
                        overflow-wrap: break-word;
                    }
                    
                    @media (max-width: 768px) {
                        .announcement-content {
                            font-size: 14px;
                            padding: 12px 20px;
                            white-space: normal;
                            line-height: 1.4;
                        }
                    }
                    
                    @keyframes announcementSlideDown {
                        from { transform: translateX(-50%) translateY(-100px); opacity: 0; }
                        to { transform: translateX(-50%) translateY(0); opacity: 1; }
                    }
                `;
                
                document.head.appendChild(style);
                document.body.appendChild(announcement);
                
                // Auto-remove after 4 seconds
                setTimeout(() => {
                    if (announcement.parentElement) {
                        announcement.style.animation = 'announcementSlideDown 0.4s ease-in reverse';
                        setTimeout(() => {
                            announcement.remove();
                            style.remove();
                        }, 400);
                    }
                }, 4000);
            }

            addChatMessage(type, message) {
                const chatArea = document.getElementById('chat-area');
                const mobileChatArea = document.getElementById('mobile-chat-area');
                const messageDiv = document.createElement('div');
                messageDiv.className = `chat-message ${type}`;
                messageDiv.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
                
                if (chatArea) {
                    chatArea.appendChild(messageDiv.cloneNode(true));
                    chatArea.scrollTop = chatArea.scrollHeight;
                }
                
                if (mobileChatArea) {
                    mobileChatArea.appendChild(messageDiv);
                    mobileChatArea.scrollTop = mobileChatArea.scrollHeight;
                }
            }

            sendMessage(message) {
                this.addChatMessage('own', message);
                // Send to server for multiplayer
                if (this.socket && this.connected) {
                    this.socket.emit('chat-message', message);
                }
            }

            toggleTournament() {
                if (!this.tournament) {
                    this.startTournament();
                } else {
                    this.leaveTournament();
                }
            }

            startTournament() {
                this.tournament = {
                    active: true,
                    phase: 'joining',
                    participants: [this.player.name, ...this.otherPlayers.slice(0, 3).map(p => p.name)],
                    startTime: Date.now(),
                    duration: 5 * 60 * 1000, // 5 minutes
                    joinPeriod: 60 * 1000, // 60 seconds to join
                    scores: {},
                    tournamentId: Date.now().toString(),
                    catches: {} // Store individual catches for tournament
                };

                this.tournament.participants.forEach(name => {
                    this.tournament.scores[name] = {
                        totalWeight: 0,
                        fishCount: 0,
                        biggestCatch: 0
                    };
                    this.tournament.catches[name] = []; // Initialize catches array
                });

                this.updateTournamentDisplay();
                this.showGlobalAnnouncement('üê± KITTY CREEK TOURNAMENT STARTING! üé£', '#ffff00');
                this.addChatMessage('system', 'üê± TOURNAMENT STARTING! 60 seconds to join!');
                
                // Broadcast tournament start to all players
                if (this.socket && this.connected) {
                    this.socket.emit('tournament-start', {
                        tournamentId: this.tournament.tournamentId,
                        participants: this.tournament.participants,
                        elapsedTime: Date.now() - this.tournament.startTime
                    });
                }
                
                // Start countdown
                this.startTournamentCountdown();
            }

            startTournamentCountdown() {
                let countdown = 60;
                this.tournament.countdownInterval = setInterval(() => {
                    countdown--;
                    
                    // Update display with countdown
                    this.updateTournamentDisplay();
                    
                    if (countdown > 0 && countdown <= 10) {
                        // Show countdown for last 10 seconds
                        this.showGlobalAnnouncement(`üê± TOURNAMENT STARTS IN ${countdown} SECONDS! üé£`, '#ff00ff');
                        this.addChatMessage('system', `Tournament starts in ${countdown} seconds!`);
                        
                        // Broadcast countdown to all players
                        if (this.socket && this.connected) {
                            this.socket.emit('tournament-countdown', { seconds: countdown });
                        }
                    }
                    
                    if (countdown <= 0) {
                        clearInterval(this.tournament.countdownInterval);
                        this.startTournamentFishing();
                    }
                }, 1000);
            }

            startTournamentFishing() {
                this.tournament.phase = 'active';
                this.tournament.startTime = Date.now();
                this.updateTournamentDisplay();
                this.showGlobalAnnouncement('üé£ TOURNAMENT FISHING HAS BEGUN! üé£', '#00ff00');
                this.addChatMessage('system', 'üé£ TOURNAMENT FISHING HAS BEGUN! 5 minutes to catch the biggest fish!');
                this.addChatMessage('system', '‚öñÔ∏è Tournament Mode: Everyone has equal catch chances (equipment/stats disabled)!');
                this.addChatMessage('system', 'üêü TOURNAMENT FISH: Fish can be up to 3x bigger than normal! MEGA catches possible!');
                
                // Broadcast tournament start to all players
                if (this.socket && this.connected) {
                    this.socket.emit('tournament-active', {
                        tournamentId: this.tournament.tournamentId
                    });
                }
                
                // End tournament after duration
                setTimeout(() => {
                    this.endTournament();
                }, this.tournament.duration);
            }

            endTournament() {
                this.tournament.phase = 'ended';
                this.tournament.active = false;
                
                // Clear update intervals
                if (this.tournament.updateInterval) {
                    clearTimeout(this.tournament.updateInterval);
                }
                if (this.tournament.countdownInterval) {
                    clearInterval(this.tournament.countdownInterval);
                }
                
                // Calculate winner
                let winner = null;
                let highestWeight = 0;
                
                Object.entries(this.tournament.scores).forEach(([name, score]) => {
                    if (score.totalWeight > highestWeight) {
                        highestWeight = score.totalWeight;
                        winner = name;
                    }
                });
                
                this.addChatMessage('system', `Tournament ended! Winner: ${winner} with ${highestWeight.toFixed(2)} lbs!`);
                
                // Award prize money to winner (only if playing against other real players)
                const realPlayerCount = this.tournament.participants.filter(name => 
                    !this.otherPlayers.find(p => p.name === name && p.isSimulated)
                ).length;
                
                if (winner && winner === this.player.name && realPlayerCount > 1) {
                    const prizeMoney = 500;
                    this.player.money += prizeMoney;
                    this.addChatMessage('system', `üèÜ Congratulations! You won $${prizeMoney} prize money!`);
                    this.showMessage(`üèÜ Tournament Win: +$${prizeMoney}!`, '#ffd700');
                    this.saveGameData();
                } else if (winner && winner === this.player.name && realPlayerCount === 1) {
                    this.addChatMessage('system', 'üí° No prize money - you were playing solo! Need other players for prizes.');
                }
                
                this.addChatMessage('system', 'üé£ Returning to normal fishing mode - your equipment and stats are active again!');
                
                // Broadcast tournament end to all players
                if (this.socket && this.connected) {
                    this.socket.emit('tournament-end', {
                        tournamentId: this.tournament.tournamentId,
                        winner: winner,
                        scores: this.tournament.scores,
                        catches: this.tournament.catches,
                        prizeAmount: realPlayerCount > 1 ? 500 : 0
                    });
                }
                
                // Show tournament results
                this.showTournamentResults();
                
                // Clear tournament after showing results
                setTimeout(() => {
                    this.tournament = null;
                    this.updateTournamentDisplay();
                }, 10000);
            }

            showTournamentResults() {
                // Calculate biggest bags (top 10 fish) for each player
                const playersWithBags = Object.entries(this.tournament.catches).map(([name, catches]) => {
                    const top10Fish = [...catches]
                        .sort((a, b) => b.weight - a.weight)
                        .slice(0, 10);
                    
                    const bagWeight = top10Fish.reduce((total, catchData) => total + catchData.weight, 0);
                    
                    return {
                        name: name,
                        bagWeight: bagWeight,
                        top10Fish: top10Fish,
                        biggestFish: this.tournament.scores[name].biggestCatch
                    };
                }).filter(player => player.bagWeight > 0);

                // Sort by bag weight
                const biggestBags = playersWithBags
                    .sort((a, b) => b.bagWeight - a.bagWeight)
                    .slice(0, 3);

                // Sort by biggest single fish
                const topFish = playersWithBags
                    .sort((a, b) => b.biggestFish - a.biggestFish)
                    .slice(0, 3);

                // Show results
                this.showGlobalAnnouncement('üèÜ TOURNAMENT RESULTS üèÜ', '#ff00ff');
                this.addChatMessage('system', '==================== TOURNAMENT RESULTS ====================');
                
                // Biggest Bags (Top 10 Total Weight)
                this.addChatMessage('system', 'üèÜ BIGGEST BAGS (Top 10 Fish Total Weight):');
                if (biggestBags.length > 0) {
                    biggestBags.forEach((player, index) => {
                        const rank = index + 1;
                        const medal = rank === 1 ? 'ü•á' : rank === 2 ? 'ü•à' : 'ü•â';
                        this.addChatMessage('system', `${medal} ${rank}. ${player.name}: ${player.bagWeight.toFixed(2)} lbs (${player.top10Fish.length} fish)`);
                    });
                } else {
                    this.addChatMessage('system', 'No catches recorded');
                }
                
                this.addChatMessage('system', '');
                
                // Top Fish Overall
                this.addChatMessage('system', 'üêü TOP FISH OVERALL:');
                if (topFish.length > 0) {
                    topFish.forEach((player, index) => {
                        const rank = index + 1;
                        const medal = rank === 1 ? 'ü•á' : rank === 2 ? 'ü•à' : 'ü•â';
                        this.addChatMessage('system', `${medal} ${rank}. ${player.name}: ${player.biggestFish.toFixed(2)} lbs`);
                    });
                } else {
                    this.addChatMessage('system', 'No catches recorded');
                }
                
                this.addChatMessage('system', '============================================================');
            }

            leaveTournament() {
                this.tournament = null;
                this.updateTournamentDisplay();
                this.addChatMessage('system', 'Tournament ended.');
            }

            updateTournamentDisplay() {
                const container = document.getElementById('tournament-info');
                const mobileContainer = document.getElementById('mobile-tournament-stats');
                
                if (!this.tournament) {
                    const message = `
                        <div style="color: #888;">No Active Tournament</div>
                        <div style="font-size: 9px; color: #666; margin-top: 5px;">Join a tournament to compete!</div>
                    `;
                    if (container) container.innerHTML = `<h4>No Active Tournament</h4><div class="tournament-timer">Join a tournament to compete!</div>`;
                    if (mobileContainer) mobileContainer.innerHTML = message;
                    
                    // Hide mobile tournament banner
                    const mobileBanner = document.getElementById('mobile-tournament-banner');
                    if (mobileBanner) {
                        mobileBanner.style.display = 'none';
                    }
                    return;
                }

                // Show countdown during joining phase
                if (this.tournament.phase === 'joining') {
                    const countdownStart = this.tournament.startTime;
                    const countdownElapsed = Date.now() - countdownStart;
                    const countdown = Math.max(0, 60 - Math.floor(countdownElapsed / 1000));
                    
                    const desktopHtml = `
                        <h4>üê± TOURNAMENT STARTING</h4>
                        <div class="tournament-timer" style="font-size: 18px; font-weight: bold; color: #ffff00;">
                            Starts in: ${countdown} seconds
                        </div>
                        <div style="margin-top: 10px;">Participants: ${this.tournament.participants.length}</div>
                        <div style="margin-top: 5px; font-size: 12px; color: #64b5f6;">Get ready to fish!</div>
                    `;
                    
                    const mobileHtml = `
                        <div style="color: #ffff00; font-weight: bold; font-size: 12px;">üê± TOURNAMENT STARTING</div>
                        <div style="font-size: 16px; font-weight: bold; color: #ffff00; margin-top: 8px; padding: 8px; background: rgba(255,255,0,0.15); border-radius: 4px; text-align: center;">
                            ‚è±Ô∏è STARTS IN ${countdown}s
                        </div>
                        <div style="font-size: 10px; color: #aaa; margin-top: 8px;">üë• ${this.tournament.participants.length} participants ready</div>
                    `;
                    
                    if (container) container.innerHTML = desktopHtml;
                    if (mobileContainer) mobileContainer.innerHTML = mobileHtml;
                    
                    // Hide mobile tournament banner during countdown (show when active)
                    const mobileBanner = document.getElementById('mobile-tournament-banner');
                    if (mobileBanner) {
                        mobileBanner.style.display = 'none';
                    }
                    return;
                }

                // Show active tournament stats
                if (this.tournament.phase === 'active') {
                    const timeLeft = Math.max(0, this.tournament.duration - (Date.now() - this.tournament.startTime));
                    const minutes = Math.floor(timeLeft / 60000);
                    const seconds = Math.floor((timeLeft % 60000) / 1000);

                    // Find biggest fish caught so far
                    let biggestFish = 0;
                    let biggestFishPlayer = 'None';
                    Object.entries(this.tournament.scores).forEach(([name, score]) => {
                        if (score.biggestCatch > biggestFish) {
                            biggestFish = score.biggestCatch;
                            biggestFishPlayer = name;
                        }
                    });

                    // Calculate total fish caught
                    let totalFish = 0;
                    Object.values(this.tournament.scores).forEach(score => {
                        totalFish += score.fishCount;
                    });

                    const desktopHtml = `
                        <h4>üê± TOURNAMENT ACTIVE</h4>
                        <div class="tournament-timer" style="font-size: 16px; font-weight: bold; color: #00ff00;">
                            Time: ${minutes}:${seconds.toString().padStart(2, '0')}
                        </div>
                        <div style="margin-top: 10px;">
                            <div style="font-size: 12px; color: #ffff00;">üêü Biggest Fish:</div>
                            <div style="font-size: 11px; color: #64b5f6; margin-left: 10px;">
                                ${biggestFishPlayer}: ${biggestFish.toFixed(1)} lbs
                            </div>
                        </div>
                        <div style="margin-top: 8px;">
                            <div style="font-size: 12px; color: #ffff00;">üë• Participants:</div>
                            <div style="font-size: 11px; color: #64b5f6; margin-left: 10px;">
                                ${this.tournament.participants.length} players | ${totalFish} fish caught
                            </div>
                        </div>
                    `;
                    
                    const mobileHtml = `
                        <div style="color: #00ff00; font-weight: bold; font-size: 12px;">üê± TOURNAMENT ACTIVE</div>
                        <div style="font-size: 14px; font-weight: bold; color: #ffff00; margin-top: 8px; padding: 5px; background: rgba(0,255,0,0.1); border-radius: 4px; text-align: center;">
                            ‚è±Ô∏è ${minutes}:${seconds.toString().padStart(2, '0')} LEFT
                        </div>
                        <div style="font-size: 10px; color: #aaa; margin-top: 8px;">üêü Biggest: ${biggestFishPlayer} (${biggestFish.toFixed(1)} lbs)</div>
                        <div style="font-size: 10px; color: #aaa; margin-top: 3px;">üë• ${this.tournament.participants.length} players | ${totalFish} fish</div>
                    `;
                    
                    if (container) container.innerHTML = desktopHtml;
                    if (mobileContainer) mobileContainer.innerHTML = mobileHtml;
                    
                    // Show and update mobile tournament banner
                    const mobileBanner = document.getElementById('mobile-tournament-banner');
                    const mobileTimer = document.getElementById('mobile-tournament-timer');
                    if (mobileBanner && mobileTimer) {
                        mobileBanner.style.display = 'block';
                        mobileTimer.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    }
                    
                    // Update every second during active phase
                    if (this.tournament.updateInterval) {
                        clearInterval(this.tournament.updateInterval);
                    }
                    this.tournament.updateInterval = setTimeout(() => {
                        if (this.tournament && this.tournament.phase === 'active') {
                            this.updateTournamentDisplay();
                        }
                    }, 1000);
                    return;
                }

                // Show ended tournament
                if (this.tournament.phase === 'ended') {
                    container.innerHTML = `
                        <h4>üèÜ TOURNAMENT ENDED</h4>
                        <div class="tournament-timer">Check results below!</div>
                    `;
                }
            }

            openHelp() {
                const modal = document.getElementById('help-modal');
                if (modal) modal.style.display = 'block';
            }

            closeHelp() {
                const modal = document.getElementById('help-modal');
                if (modal) modal.style.display = 'none';
            }

            openShop() {
                document.getElementById('tackle-shop-modal').style.display = 'block';
                this.switchShopTab('rods'); // Start with rods tab
            }

            closeShop() {
                document.getElementById('tackle-shop-modal').style.display = 'none';
            }

            switchShopTab(tabName) {
                // Update tab buttons (only shop tabs)
                document.querySelectorAll('#tackle-shop-modal .tab-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.tab === tabName);
                });

                // Update content
                this.renderShopContent(tabName);
            }

            renderShopContent(tabName) {
                const content = document.getElementById('shop-content');
                
                // Only handle tackle shop tabs
                const validTabs = ['rods', 'reels', 'lines', 'hooks', 'baits'];
                if (!validTabs.includes(tabName)) {
                    return; // Not a tackle shop tab, ignore
                }
                
                const tackle = this.tackle[tabName];
                
                content.innerHTML = '';
                
                // Safety check for tackle array
                if (!tackle || !Array.isArray(tackle)) {
                    content.innerHTML = '<p style="color: #ff0000;">Error loading tackle items. Please refresh the page.</p>';
                    console.error('Tackle not found for tab:', tabName, 'Available:', Object.keys(this.tackle));
                    return;
                }
                
                tackle.forEach((item, index) => {
                    const isUnlocked = this.player.tackleUnlocks[tabName].includes(index);
                    const isOwned = this.player.gear[tabName.toLowerCase()] === item.name;
                    const canAfford = this.player.money >= item.cost;
                    
                    const itemDiv = document.createElement('div');
                    itemDiv.className = `tackle-item ${isOwned ? 'equipped' : ''} ${!isUnlocked ? 'locked' : ''}`;
                    
                    let statsText = '';
                    if (tabName === 'rods') {
                        statsText = `+${item.catchBonus}% catch, ${item.strength} strength`;
                    } else if (tabName === 'reels') {
                        statsText = `+${item.speedBonus}% speed, ${item.smoothness} smoothness`;
                    } else if (tabName === 'lines') {
                        statsText = `${item.strength} strength, ${item.visibility} visibility`;
                    } else if (tabName === 'hooks') {
                        statsText = `+${item.catchBonus}% catch, size ${item.size}`;
                    } else if (tabName === 'baits') {
                        statsText = `+${item.catchBonus}% catch, ${item.durability} durability`;
                    }
                    
                    itemDiv.innerHTML = `
                        <div class="tackle-info">
                            <div class="tackle-name">${item.name}</div>
                            <div class="tackle-stats">${statsText}</div>
                            <div class="tackle-description">${item.description}</div>
                        </div>
                        <div class="tackle-actions">
                            ${!isUnlocked ? 
                                `<div style="color: #666; font-size: 12px;">Locked - Level ${item.unlockLevel}</div>` :
                                isOwned ? 
                                    `<div style="color: #ffff00; font-size: 12px;">EQUIPPED</div>` :
                                    canAfford ?
                                        `<button class="tackle-btn buy" data-action="buy" data-category="${tabName}" data-index="${index}">BUY $${item.cost}</button>` :
                                        `<div style="color: #ff6666; font-size: 12px;">Need $${item.cost}</div>`
                            }
                            ${isOwned && !isUnlocked ? '' : isOwned ? '' : isUnlocked && this.player.gear[tabName.toLowerCase()] !== item.name ? 
                                `<button class="tackle-btn equip" data-action="equip" data-category="${tabName}" data-index="${index}">EQUIP</button>` : ''
                            }
                        </div>
                    `;
                    
                    content.appendChild(itemDiv);
                });
            }

            buyTackle(category, index) {
                const item = this.tackle[category][index];
                
                if (this.player.money < item.cost) {
                    this.showMessage('Not enough money!', '#ff0000');
                    return;
                }
                
                this.player.money -= item.cost;
                this.player.gear[category.toLowerCase()] = item.name;
                
                this.showMessage(`Bought ${item.name}!`, '#00ff00');
                this.addChatMessage('system', `${this.player.name} bought ${item.name}!`);
                
                this.updateDisplay();
                this.renderShopContent(category);
                this.saveGameData();
            }

            equipTackle(category, index) {
                const item = this.tackle[category][index];
                this.player.gear[category.toLowerCase()] = item.name;
                
                this.showMessage(`Equipped ${item.name}!`, '#00ff00');
                this.addChatMessage('system', `${this.player.name} equipped ${item.name}!`);
                
                this.updateDisplay();
                this.renderShopContent(category);
                this.saveGameData();
            }

            openInventory() {
                document.getElementById('inventory-modal').style.display = 'block';
                // Refresh gear display to ensure current values are shown
                const currentTab = document.querySelector('.inventory-tabs .tab-btn.active')?.dataset.tab || 'recent';
                this.switchInventoryTab(currentTab);
            }

            closeInventory() {
                document.getElementById('inventory-modal').style.display = 'none';
            }

            switchInventoryTab(tabName) {
                // Update tab buttons
                document.querySelectorAll('.inventory-tabs .tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.dataset.tab === tabName) {
                        btn.classList.add('active');
                    }
                });

                // Render content
                this.renderInventoryContent(tabName);
            }

            renderInventoryContent(tabName) {
                const content = document.getElementById('inventory-content');
                
                switch(tabName) {
                    case 'recent':
                        this.renderRecentCatches(content);
                        break;
                    case 'top10':
                    case 'biggest':
                        this.renderBiggestFish(content);
                        break;
                    case 'gear':
                        this.renderEquippedGear(content);
                        break;
                    case 'stats':
                        this.renderStatistics(content);
                        break;
                    default:
                        // Default to recent catches if unknown tab
                        this.renderRecentCatches(content);
                        break;
                }
            }

            renderRecentCatches(container) {
                if (this.player.recentCatches.length === 0) {
                    container.innerHTML = '<div class="no-data">No fish caught yet!</div>';
                    return;
                }

                const html = this.player.recentCatches.slice(-10).reverse().map(catchData => `
                    <div class="catch-item">
                        <div class="fish-name">${catchData.fish.name}</div>
                        <div class="fish-details">
                            <span class="weight">${catchData.weight.toFixed(1)} lbs</span>
                            <span class="value">$${catchData.value}</span>
                            <span class="location">${catchData.location}</span>
                            <span class="time">${new Date(catchData.timestamp).toLocaleTimeString()}</span>
                        </div>
                    </div>
                `).join('');

                container.innerHTML = html;
            }

            renderBiggestFish(container) {
                const biggestFish = this.player.recentCatches
                    .sort((a, b) => b.weight - a.weight)
                    .slice(0, 10);

                if (biggestFish.length === 0) {
                    container.innerHTML = '<div class="no-data">No fish caught yet!</div>';
                    return;
                }

                const html = biggestFish.map((catchData, index) => `
                    <div class="catch-item">
                        <div class="rank">#${index + 1}</div>
                        <div class="fish-name">${catchData.fish.name}</div>
                        <div class="fish-details">
                            <span class="weight">${catchData.weight.toFixed(1)} lbs</span>
                            <span class="value">$${catchData.value}</span>
                            <span class="location">${catchData.location}</span>
                        </div>
                    </div>
                `).join('');

                container.innerHTML = html;
            }

            renderStatistics(container) {
                const stats = {
                    totalFish: this.player.totalCaught,
                    totalWeight: this.player.totalWeight.toFixed(1),
                    biggestCatch: this.player.biggestCatch.toFixed(1),
                    totalMoney: this.player.money,
                    level: this.player.level,
                    experience: this.player.experience,
                    tournamentsPlayed: this.player.tournamentStats.tournamentsPlayed,
                    tournamentsWon: this.player.tournamentStats.tournamentsWon
                };

                const html = `
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">Total Fish</div>
                            <div class="stat-value">${stats.totalFish}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Total Weight</div>
                            <div class="stat-value">${stats.totalWeight} lbs</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Biggest Catch</div>
                            <div class="stat-value">${stats.biggestCatch} lbs</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Total Money</div>
                            <div class="stat-value">$${stats.totalMoney}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Level</div>
                            <div class="stat-value">${stats.level}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Experience</div>
                            <div class="stat-value">${stats.experience}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Tournaments Played</div>
                            <div class="stat-value">${stats.tournamentsPlayed}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Tournaments Won</div>
                            <div class="stat-value">${stats.tournamentsWon}</div>
                        </div>
                    </div>
                `;

                container.innerHTML = html;
            }

            renderEquippedGear(container) {
                // Get actual equipped gear - check both singular and plural keys for compatibility
                const rod = this.player.gear?.rods || this.player.gear?.rod || 'None';
                const reel = this.player.gear?.reels || this.player.gear?.reel || 'None';
                const line = this.player.gear?.lines || this.player.gear?.line || 'None';
                const hook = this.player.gear?.hooks || this.player.gear?.hook || 'None';
                const bait = this.player.gear?.baits || this.player.gear?.bait || 'None';
                
                const html = `
                    <div style="padding: 20px;">
                        <div style="margin-bottom: 15px; padding: 12px; background: rgba(20, 30, 50, 0.6); border-radius: 8px; border-left: 4px solid rgba(100, 200, 255, 0.5);">
                            <div style="font-weight: bold; color: #64b5f6; margin-bottom: 5px;">üé£ Rod</div>
                            <div style="color: #ffffff; font-size: 14px;">${rod}</div>
                        </div>
                        <div style="margin-bottom: 15px; padding: 12px; background: rgba(20, 30, 50, 0.6); border-radius: 8px; border-left: 4px solid rgba(100, 200, 255, 0.5);">
                            <div style="font-weight: bold; color: #64b5f6; margin-bottom: 5px;">üé£ Reel</div>
                            <div style="color: #ffffff; font-size: 14px;">${reel}</div>
                        </div>
                        <div style="margin-bottom: 15px; padding: 12px; background: rgba(20, 30, 50, 0.6); border-radius: 8px; border-left: 4px solid rgba(100, 200, 255, 0.5);">
                            <div style="font-weight: bold; color: #64b5f6; margin-bottom: 5px;">ü™ù Line</div>
                            <div style="color: #ffffff; font-size: 14px;">${line}</div>
                        </div>
                        <div style="margin-bottom: 15px; padding: 12px; background: rgba(20, 30, 50, 0.6); border-radius: 8px; border-left: 4px solid rgba(100, 200, 255, 0.5);">
                            <div style="font-weight: bold; color: #64b5f6; margin-bottom: 5px;">ü™ù Hook</div>
                            <div style="color: #ffffff; font-size: 14px;">${hook}</div>
                        </div>
                        <div style="padding: 12px; background: rgba(20, 30, 50, 0.6); border-radius: 8px; border-left: 4px solid rgba(100, 200, 255, 0.5);">
                            <div style="font-weight: bold; color: #64b5f6; margin-bottom: 5px;">üêõ Bait</div>
                            <div style="color: #ffffff; font-size: 14px;">${bait}</div>
                        </div>
                    </div>
                `;
                
                container.innerHTML = html;
            }

            showMessage(text, color) {
                const messageEl = document.getElementById('catch-text');
                const messageContainer = document.getElementById('catch-message');
                
                if (!messageEl || !messageContainer) {
                    console.error('Catch message elements not found!', { messageEl, messageContainer });
                    return;
                }
                
                messageEl.textContent = text;
                messageEl.style.color = color;
                
                // Force visibility with !important for mobile
                messageContainer.style.display = 'block';
                messageContainer.style.visibility = 'visible';
                messageContainer.style.opacity = '1';
                messageContainer.classList.add('show');
                
                // Remove the show class after 3 seconds
                setTimeout(() => {
                    messageContainer.classList.remove('show');
                    setTimeout(() => {
                        messageContainer.style.display = 'none';
                    }, 500); // Small delay to allow fade out
                }, 3000);
            }

            showChatBanner(message) {
                const banner = document.getElementById('chat-banner');
                if (!banner) return;
                
                banner.textContent = message;
                banner.classList.add('show');
                
                // Hide after 5 seconds
                setTimeout(() => {
                    banner.classList.remove('show');
                }, 5000);
            }


            showCatchAnimation(fishName, weight) {
                const fishermanRow = document.getElementById('fisherman-row');
                const playerFisher = document.getElementById('player-fisher');
                
                if (!playerFisher) return;
                
                const fishIcon = document.createElement('div');
                fishIcon.className = 'fish-catch-animation';
                fishIcon.textContent = 'üêü';
                fishIcon.style.position = 'absolute';
                fishIcon.style.left = (playerFisher.getBoundingClientRect().left - fishermanRow.getBoundingClientRect().left) + 'px';
                fishIcon.style.top = (playerFisher.getBoundingClientRect().top - fishermanRow.getBoundingClientRect().top) + 'px';
                fishIcon.style.fontSize = '24px';
                fishIcon.style.zIndex = '1000';
                fishIcon.style.pointerEvents = 'none';
                
                fishermanRow.appendChild(fishIcon);
                
                // Animate the fish icon
                setTimeout(() => {
                    fishIcon.style.transition = 'all 1s ease-out';
                    fishIcon.style.transform = 'translateY(-50px) scale(1.5)';
                    fishIcon.style.opacity = '0';
                    
                    setTimeout(() => {
                        fishIcon.remove();
                    }, 1000);
                }, 50);
            }

            updateDisplay() {
                document.getElementById('player-name').textContent = this.player.name;
                document.getElementById('player-level').textContent = this.player.level;
                document.getElementById('player-money').textContent = this.player.money;
                document.getElementById('fish-caught').textContent = this.player.totalCaught;
                document.getElementById('total-weight').textContent = this.player.totalWeight.toFixed(1);

                // Update experience display
                const expNeeded = this.player.level * 100;
                document.getElementById('player-exp').textContent = this.player.experience;
                document.getElementById('next-level-exp').textContent = expNeeded;

                // Update player stats
                document.getElementById('stat-accuracy').textContent = this.player.stats.accuracy;
                document.getElementById('stat-luck').textContent = this.player.stats.luck;
                document.getElementById('stat-patience').textContent = this.player.stats.patience;
                document.getElementById('stat-strength').textContent = this.player.stats.strength;

                // Update mobile layout elements
                const mobilePlayerName = document.getElementById('mobile-player-name');
                const mobilePlayerLevel = document.getElementById('mobile-player-level');
                const mobilePlayerMoney = document.getElementById('mobile-player-money');
                const mobilePlayerExp = document.getElementById('mobile-player-exp');
                const mobileNextExp = document.getElementById('mobile-next-exp');
                const mobileFishCount = document.getElementById('mobile-fish-count');
                const mobileTotalWeight = document.getElementById('mobile-total-weight');
                const mobileStatAccuracy = document.getElementById('mobile-stat-accuracy');
                const mobileStatLuck = document.getElementById('mobile-stat-luck');
                const mobileStatPatience = document.getElementById('mobile-stat-patience');
                const mobileStatStrength = document.getElementById('mobile-stat-strength');

                if (mobilePlayerName) mobilePlayerName.textContent = this.player.name;
                if (mobilePlayerLevel) mobilePlayerLevel.textContent = this.player.level;
                if (mobilePlayerMoney) mobilePlayerMoney.textContent = this.player.money;
                if (mobilePlayerExp) mobilePlayerExp.textContent = this.player.experience;
                if (mobileNextExp) mobileNextExp.textContent = expNeeded;
                if (mobileFishCount) mobileFishCount.textContent = this.player.totalCaught;
                if (mobileTotalWeight) mobileTotalWeight.textContent = this.player.totalWeight.toFixed(1);
                if (mobileStatAccuracy) mobileStatAccuracy.textContent = this.player.stats.accuracy;
                if (mobileStatLuck) mobileStatLuck.textContent = this.player.stats.luck;
                if (mobileStatPatience) mobileStatPatience.textContent = this.player.stats.patience;
                if (mobileStatStrength) mobileStatStrength.textContent = this.player.stats.strength;
                
                // Update mobile sound button icon
                const mobileSoundBtn = document.getElementById('mobile-sound-btn');
                if (mobileSoundBtn) {
                    mobileSoundBtn.textContent = this.soundEnabled ? 'üîä' : 'üîá';
                }
                
                // Update character display (image)
                const mobileCharacterDisplayImg = document.getElementById('mobile-character-display-img');
                if (mobileCharacterDisplayImg && this.player.character) {
                    mobileCharacterDisplayImg.src = this.player.character;
                    mobileCharacterDisplayImg.style.display = 'block';
                }
                
                // Update mobile inventory
                this.updateMobileInventory();

                // Update location dropdown (both desktop and mobile)
                this.updateLocationButtons();

                this.updateOnlinePlayers();
                this.updateTournamentDisplay();
            }

            updateMobileInventory() {
                // Update mobile equipped gear
                const mobileEquippedGear = document.getElementById('mobile-equipped-gear');
                if (mobileEquippedGear) {
                    // Get actual equipped gear - check both singular and plural keys for compatibility
                    const rod = this.player.gear?.rods || this.player.gear?.rod || 'None';
                    const reel = this.player.gear?.reels || this.player.gear?.reel || 'None';
                    const line = this.player.gear?.lines || this.player.gear?.line || 'None';
                    const hook = this.player.gear?.hooks || this.player.gear?.hook || 'None';
                    const bait = this.player.gear?.baits || this.player.gear?.bait || 'None';
                    
                    mobileEquippedGear.innerHTML = `
                        <div style="margin-bottom: 8px;"><strong>üé£ Rod:</strong> ${rod}</div>
                        <div style="margin-bottom: 8px;"><strong>üé£ Reel:</strong> ${reel}</div>
                        <div style="margin-bottom: 8px;"><strong>ü™ù Line:</strong> ${line}</div>
                        <div style="margin-bottom: 8px;"><strong>ü™ù Hook:</strong> ${hook}</div>
                        <div><strong>üêõ Bait:</strong> ${bait}</div>
                    `;
                }
                
                // Update mobile recent catches (last 5)
                const mobileRecentCatches = document.getElementById('mobile-recent-catches');
                if (mobileRecentCatches) {
                    if (this.player.recentCatches.length === 0) {
                        mobileRecentCatches.innerHTML = '<div style="color: #888; padding: 10px;">No fish caught yet!</div>';
                    } else {
                        const recentCatches = this.player.recentCatches.slice(-5).reverse();
                        mobileRecentCatches.innerHTML = recentCatches.map(catchData => `
                            <div style="padding: 8px; margin-bottom: 5px; background: rgba(20, 30, 50, 0.6); border-radius: 6px; border-left: 3px solid rgba(100, 200, 255, 0.5);">
                                <div style="font-weight: bold; color: #64b5f6;">${catchData.fish.name}</div>
                                <div style="font-size: 9px; color: #aaa; margin-top: 3px;">
                                    ${catchData.weight.toFixed(1)} lbs ‚Ä¢ $${catchData.value} ‚Ä¢ ${catchData.location}
                                </div>
                            </div>
                        `).join('');
                    }
                }
            }

            updateLocationButtons() {
                const select = document.getElementById('location-select');
                const mobileSelect = document.getElementById('mobile-location-select');
                
                if (select) {
                    select.innerHTML = '';
                    
                    this.locations.forEach((location, index) => {
                        const option = document.createElement('option');
                        option.value = index;
                        option.textContent = location.name;
                        
                        // Check if location is unlocked
                        if (!this.player.locationUnlocks.includes(index)) {
                            option.disabled = true;
                            option.textContent += ` (Locked - Level ${location.unlockLevel})`;
                        }
                        
                        // Check if it's the current location
                        if (index === this.currentLocation) {
                            option.selected = true;
                        }
                        
                        select.appendChild(option);
                    });
                }

                // Update mobile location dropdown
                if (mobileSelect) {
                    mobileSelect.innerHTML = '';
                    
                    this.locations.forEach((location, index) => {
                        const option = document.createElement('option');
                        option.value = index;
                        option.textContent = location.name;
                        
                        // Check if location is unlocked
                        if (!this.player.locationUnlocks.includes(index)) {
                            option.disabled = true;
                            option.textContent += ` (Locked - Level ${location.unlockLevel})`;
                        }
                        
                        // Check if it's the current location
                        if (index === this.currentLocation) {
                            option.selected = true;
                        }
                        
                        mobileSelect.appendChild(option);
                    });
                }
            }

            saveGameData() {
                const gameData = {
                    player: this.player,
                    currentLocation: this.currentLocation,
                    timestamp: Date.now(),
                    version: '1.0' // For future compatibility
                };
                
                try {
                    const dataString = JSON.stringify(gameData);
                    const dataSize = Math.round(dataString.length / 1024 * 100) / 100; // KB
                    
                    // Save main game data
                    localStorage.setItem('fishingHoleGame', dataString);
                    
                    // Create a backup save
                    localStorage.setItem('fishingHoleGame_backup', dataString);
                    
                    // Update status display
                    this.updateGameStatus(dataSize);
                    
                    console.log('Game data saved successfully');
                    
                    // Save to server if connected
                    if (this.socket && this.connected) {
                        this.socket.emit('save-game', this.player);
                    }
                    
                    // Show save confirmation occasionally
                    if (Math.random() < 0.1) { // 10% chance
                        this.addChatMessage('system', 'Progress saved!');
                    }
                } catch (error) {
                    console.error('Failed to save game data:', error);
                    this.addChatMessage('system', 'Warning: Could not save progress!');
                    this.updateGameStatus(0, 'Error');
                }
            }

            updateGameStatus(dataSize, status = 'Active') {
                const lastSaveTime = new Date().toLocaleTimeString();
                document.getElementById('last-save-time').textContent = lastSaveTime;
                document.getElementById('data-size').textContent = `${dataSize} KB`;
                document.getElementById('auto-save-status').textContent = status;
            }

            generateSimulatedCatches(count) {
                const catches = [];
                for (let i = 0; i < count; i++) {
                    const randomFish = this.fishTypes[Math.floor(Math.random() * this.fishTypes.length)];
                    const weight = randomFish.minWeight + Math.random() * (randomFish.maxWeight - randomFish.minWeight);
                    const value = Math.floor(randomFish.value * (1 + weight / randomFish.maxWeight));
                    
                    catches.push({
                        fish: randomFish,
                        weight: weight,
                        value: value,
                        experience: Math.floor(randomFish.experience * (1 + weight / randomFish.maxWeight)),
                        location: this.locations[Math.floor(Math.random() * this.locations.length)].name,
                        timestamp: Date.now() - Math.random() * 86400000 // Random time in last 24 hours
                    });
                }
                return catches.sort((a, b) => b.timestamp - a.timestamp); // Sort by newest first
            }

            updateLeaderboard() {
                // Update biggest fish leaderboard
                this.updateBiggestFishLeaderboard();
                
                // Update biggest bags leaderboard
                this.updateBiggestBagsLeaderboard();
            }

            async updateBiggestFishLeaderboard() {
                // Fetch leaderboard from server
                let serverPlayers = [];
                try {
                    const response = await fetch(`${this.serverUrl}/api/leaderboard`);
                    serverPlayers = await response.json();
                } catch (error) {
                    console.error('Failed to fetch leaderboard:', error);
                }

                // Combine with local player
                const realPlayers = [
                    {
                        name: this.player.name,
                        biggestFish: this.player.biggestCatch,
                        recentCatches: this.player.recentCatches
                    },
                    ...serverPlayers.map(p => ({
                        name: p.name,
                        biggestFish: Number(p.biggest_catch) || 0,
                        recentCatches: []
                    }))
                ].filter((p, index, self) => 
                    index === self.findIndex(pl => pl.name === p.name)
                );

                // Sort by biggest fish
                const biggestFishLeaders = realPlayers
                    .filter(player => player.biggestFish > 0)
                    .sort((a, b) => b.biggestFish - a.biggestFish)
                    .slice(0, 3);

                // Update display
                const container = document.getElementById('biggest-fish-leaderboard');
                const mobileContainer = document.getElementById('mobile-biggest-fish-leaderboard');
                
                const leaderboardHTML = biggestFishLeaders.length === 0 
                    ? '<div class="leaderboard-item">No fish caught yet</div>'
                    : biggestFishLeaders.map((player, index) => {
                        const weight = Number(player.biggestFish) || 0;
                        return `
                        <div class="leaderboard-item">
                            <span class="rank">#${index + 1}</span>
                            <span class="player-name">${player.name}</span>
                            <span class="weight">${weight.toFixed(1)} lbs</span>
                        </div>
                    `;
                    }).join('');

                if (container) container.innerHTML = leaderboardHTML;
                if (mobileContainer) mobileContainer.innerHTML = leaderboardHTML;
            }

            updateTop10BiggestFish(catchData) {
                // Initialize if needed
                if (!this.player.top10BiggestFish) {
                    this.player.top10BiggestFish = [];
                }

                // Add the new catch
                this.player.top10BiggestFish.push(catchData);

                // Sort by weight (biggest first) and keep only top 10
                this.player.top10BiggestFish.sort((a, b) => b.weight - a.weight);
                this.player.top10BiggestFish = this.player.top10BiggestFish.slice(0, 10);
            }

            async updateBiggestBagsLeaderboard() {
                // Fetch leaderboard from server
                let serverPlayers = [];
                try {
                    const response = await fetch(`${this.serverUrl}/api/leaderboard`);
                    serverPlayers = await response.json();
                } catch (error) {
                    console.error('Failed to fetch leaderboard:', error);
                }

                // Combine with local player
                const realPlayers = [
                    {
                        name: this.player.name,
                        top10BiggestFish: this.player.top10BiggestFish || []
                    },
                    ...serverPlayers.map(p => ({
                        name: p.name,
                        top10BiggestFish: p.top10_biggest_fish || []
                    }))
                ].filter((p, index, self) => 
                    index === self.findIndex(pl => pl.name === p.name)
                );

                // Calculate top 10 BIGGEST fish weight for each player
                const playersWithBags = realPlayers.map(player => {
                    // Use the persistent top10BiggestFish array (never goes down)
                    const top10Fish = player.top10BiggestFish || [];
                    
                    const bagWeight = top10Fish.reduce((total, catchData) => total + (catchData.weight || 0), 0);
                    
                    return {
                        name: player.name,
                        bagWeight: bagWeight,
                        fishCount: top10Fish.length,
                        top10Fish: top10Fish // Store for display
                    };
                }).filter(player => player.bagWeight > 0 && player.fishCount >= 1);

                // Sort by bag weight (total of top 10 biggest fish)
                const biggestBagsLeaders = playersWithBags
                    .sort((a, b) => b.bagWeight - a.bagWeight)
                    .slice(0, 3);

                // Update display
                const container = document.getElementById('biggest-bags-leaderboard');
                const mobileContainer = document.getElementById('mobile-biggest-bags-leaderboard');
                
                const leaderboardHTML = biggestBagsLeaders.length === 0
                    ? '<div class="leaderboard-item">No fish caught yet</div>'
                    : biggestBagsLeaders.map((player, index) => `
                        <div class="leaderboard-item">
                            <span class="rank">#${index + 1}</span>
                            <span class="player-name">${player.name}</span>
                            <span class="weight">${player.bagWeight.toFixed(1)} lbs</span>
                        </div>
                    `).join('');

                if (container) container.innerHTML = leaderboardHTML;
                if (mobileContainer) mobileContainer.innerHTML = leaderboardHTML;
            }

            // Auto-save every 30 seconds
            startAutoSave() {
                setInterval(() => {
                    this.saveGameData();
                }, 30000); // 30 seconds
            }

            manualSave() {
                this.saveGameData();
                this.showMessage('Game saved successfully!', '#00ff00');
                this.addChatMessage('system', 'Game progress saved!');
            }

            exportGameData() {
                const gameData = {
                    player: this.player,
                    currentLocation: this.currentLocation,
                    timestamp: Date.now(),
                    version: '1.0'
                };
                
                const dataStr = JSON.stringify(gameData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `fishing-hole-save-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                this.addChatMessage('system', 'Game data exported!');
            }

            importGameData(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const gameData = JSON.parse(e.target.result);
                        
                        if (gameData.player && gameData.version) {
                            this.player = { ...this.player, ...gameData.player };
                            this.currentLocation = gameData.currentLocation || 0;
                            
                            this.updateDisplay();
                            this.updateAchievementsDisplay();
                            this.saveGameData();
                            
                            this.showMessage('Game data imported successfully!', '#00ff00');
                            this.addChatMessage('system', 'Game data imported!');
                        } else {
                            this.showMessage('Invalid game data file!', '#ff0000');
                        }
                    } catch (error) {
                        this.showMessage('Error importing game data!', '#ff0000');
                        console.error('Import error:', error);
                    }
                };
                reader.readAsText(file);
            }

            loadGameData() {
                try {
                    const savedData = localStorage.getItem('fishingHoleGame');
                    if (savedData) {
                        const gameData = JSON.parse(savedData);
                        
                        // Load player data with proper defaults for new features
                        if (gameData.player) {
                            // Merge saved data with defaults to ensure new features are initialized
                            this.player = {
                                ...this.player,
                                ...gameData.player,
                                // Ensure character is preserved
                                character: gameData.player.character || 'üë®',
                                // CRITICAL: Preserve gear from saved data
                                gear: {
                                    rod: 'Basic Rod',
                                    reel: 'Basic Reel',
                                    line: 'Monofilament',
                                    hook: 'Basic Hook',
                                    bait: 'Basic Bait',
                                    ...gameData.player.gear // Saved gear takes precedence
                                },
                                // Ensure new features have defaults if not in saved data
                                stats: {
                                    accuracy: 50,
                                    luck: 50,
                                    patience: 50,
                                    strength: 50,
                                    ...gameData.player.stats
                                },
                                achievements: gameData.player.achievements || [],
                                recentCatches: gameData.player.recentCatches || [],
                                top10BiggestFish: gameData.player.top10BiggestFish || [],
                                seasonalCatches: {
                                    spring: { caught: 0, biggest: 0 },
                                    summer: { caught: 0, biggest: 0 },
                                    fall: { caught: 0, biggest: 0 },
                                    winter: { caught: 0, biggest: 0 },
                                    ...gameData.player.seasonalCatches
                                },
                                tournamentStats: {
                                    tournamentsPlayed: 0,
                                    tournamentsWon: 0,
                                    biggestTournamentFish: 0,
                                    biggestTournamentBag: 0,
                                    totalTournamentWeight: 0,
                                    totalTournamentFish: 0,
                                    ...gameData.player.tournamentStats
                                }
                            };
                            
                            // Debug: Log loaded gear
                            console.log('Loaded gear from save:', this.player.gear);
                        }
                        
                        // Load current location
                        if (gameData.currentLocation !== undefined) {
                            this.currentLocation = gameData.currentLocation;
                        }
                        
                        console.log('Game data loaded successfully');
                        this.addChatMessage('system', `Welcome back, ${this.player.name}! Your progress has been loaded.`);
                        
                        // Show loaded stats
                        this.addChatMessage('system', `Level ${this.player.level} | ${this.player.totalCaught} fish caught | $${this.player.money} earned`);
                        
                        // Initialize top10BiggestFish if empty (migrate from recentCatches)
                        if (!this.player.top10BiggestFish || this.player.top10BiggestFish.length === 0) {
                            this.player.top10BiggestFish = [];
                            // Migrate existing catches to top10BiggestFish
                            if (this.player.recentCatches && this.player.recentCatches.length > 0) {
                                this.player.recentCatches.forEach(catchData => {
                                    this.updateTop10BiggestFish(catchData);
                                });
                            }
                        } else {
                            // Ensure it's sorted correctly
                            this.player.top10BiggestFish.sort((a, b) => b.weight - a.weight);
                            this.player.top10BiggestFish = this.player.top10BiggestFish.slice(0, 10);
                        }
                        
                        // Check for any unlocks that should have happened
                        this.checkLocationUnlocks();
                        this.checkTackleUnlocks();
                        this.updateLocationButtons();
                    } else {
                        console.log('No saved game data found, starting fresh');
                        this.addChatMessage('system', 'Welcome to Kitty Creek Fishing Club! üê±üé£ Start your purrfect fishing adventure!');
                    }
                } catch (error) {
                    console.error('Failed to load game data:', error);
                    this.addChatMessage('system', 'Welcome to Kitty Creek Fishing Club! üê±üé£ Start your purrfect fishing adventure!');
                }
            }

            resetCharacter() {
                if (!confirm('Are you sure you want to reset your character? This will delete all your progress, stats, catches, and achievements. This cannot be undone!')) {
                    return;
                }

                // Clear saved data
                localStorage.removeItem('fishingHoleGame');
                
                // Reset player to defaults (keeping name and character)
                const savedName = this.player.name;
                const savedCharacter = this.player.character;
                
                this.player = {
                    name: savedName,
                    character: savedCharacter,
                    level: 1,
                    money: 100,
                    experience: 0,
                    totalCaught: 0,
                    totalWeight: 0,
                    biggestCatch: 0,
                    locationUnlocks: [0, 1],
                    tackleUnlocks: {
                        rods: [0],
                        reels: [0],
                        lines: [0],
                        hooks: [0],
                        baits: [0]
                    },
                    gear: {
                        rod: 'Basic Rod',
                        reel: 'Basic Reel',
                        line: 'Monofilament',
                        hook: 'Basic Hook',
                        bait: 'Basic Bait'
                    },
                    stats: {
                        accuracy: 50,
                        luck: 50,
                        patience: 50,
                        strength: 50
                    },
                    achievements: [],
                    recentCatches: [],
                    top10BiggestFish: [],
                    seasonalCatches: {
                        spring: { caught: 0, biggest: 0 },
                        summer: { caught: 0, biggest: 0 },
                        fall: { caught: 0, biggest: 0 },
                        winter: { caught: 0, biggest: 0 }
                    },
                    tournamentStats: {
                        tournamentsPlayed: 0,
                        tournamentsWon: 0,
                        biggestTournamentFish: 0,
                        biggestTournamentBag: 0,
                        totalTournamentWeight: 0,
                        totalTournamentFish: 0
                    }
                };
                
                this.currentLocation = 0;
                this.updateDisplay();
                this.updateLocationButtons();
                this.updateAchievementsDisplay();
                this.updateLeaderboard();
                this.positionPlayers();
                this.addChatMessage('system', 'Character reset! Starting fresh...');
                this.saveGameData();
            }

            changeCharacter() {
                // Show character selector modal/overlay
                const loginScreen = document.getElementById('login-screen');
                if (loginScreen) {
                    // Hide the login button and show character selector only
                    const loginBtn = document.getElementById('login-btn');
                    const nameInput = document.getElementById('player-name-input');
                    if (loginBtn) loginBtn.style.display = 'none';
                    if (nameInput) nameInput.style.display = 'none';
                    
                    // Show login screen as character selector
                    loginScreen.classList.remove('hidden');
                    
                    // Update button to say "SELECT CHARACTER" instead of login
                    const charSelectBtn = document.createElement('button');
                    charSelectBtn.className = 'login-btn';
                    charSelectBtn.id = 'char-select-btn';
                    charSelectBtn.textContent = 'SELECT CHARACTER';
                    charSelectBtn.onclick = () => {
                        const selectedCatUrl = window.selectedCat || this.player.character;
                        this.player.character = selectedCatUrl;
                        this.player.avatarOptions = { type: 'cat', url: selectedCatUrl };
                        this.saveGameData();
                        loginScreen.classList.add('hidden');
                        this.positionPlayers();
                        this.updateDisplay();
                        this.addChatMessage('system', 'Character updated!');
                        
                        // Restore login button
                        if (loginBtn) loginBtn.style.display = 'block';
                        if (nameInput) nameInput.style.display = 'block';
                        charSelectBtn.remove();
                    };
                    
                    // Replace or add the button
                    const existingBtn = document.getElementById('char-select-btn');
                    if (existingBtn) {
                        existingBtn.replaceWith(charSelectBtn);
                    } else {
                        loginScreen.appendChild(charSelectBtn);
                    }
                }
            }
        }

        // Start the game
        const game = new FishingHoleMultiplayer();
    </script>
</body>
</html>
